# Episode 07: "Deep Dive" üíæ

> *"Static memory is a cage. Dynamic memory is freedom ‚Äî and responsibility."*

## üìö –¢–µ–æ—Ä–∏—è: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å –≤ C

### 1. –°—Ç–µ–∫ vs –ö—É—á–∞ (Stack vs Heap)

**–°—Ç–µ–∫ (Stack)**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä (~8MB)
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–º–∏—Ä–∞—é—Ç –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

```c
void function() {
    int local = 42;  // –í—ã–¥–µ–ª–µ–Ω–æ –Ω–∞ —Å—Ç–µ–∫–µ
    // local –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
}
```

**–ö—É—á–∞ (Heap)**:
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (`malloc`/`free`)
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°)
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Å—Ç–µ–∫–∞
- –ñ–∏–≤—ë—Ç –¥–æ —è–≤–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è

```c
void function() {
    int *p = malloc(sizeof(int));  // –í—ã–¥–µ–ª–µ–Ω–æ –≤ –∫—É—á–µ
    *p = 42;
    // –ü–∞–º—è—Ç—å –ù–ï –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
    free(p);  // –ù–∞–¥–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –≤—Ä—É—á–Ω—É—é
}
```

---

### 2. –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏: `malloc()`

```c
#include <stdlib.h>

// malloc - memory allocation
void *malloc(size_t size);

// –ü—Ä–∏–º–µ—Ä
int *p = malloc(sizeof(int));  // –í—ã–¥–µ–ª–∏—Ç—å 4 –±–∞–π—Ç–∞ (–æ–±—ã—á–Ω–æ)
if (p == NULL) {
    fprintf(stderr, "Memory allocation failed!\n");
    return 1;
}
*p = 42;

free(p);  // –û—Å–≤–æ–±–æ–¥–∏—Ç—å
```

**–í–∞–∂–Ω–æ**:
- `malloc()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `void*` (–Ω—É–∂–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤ —Å—Ç–∞—Ä–æ–º C)
- `malloc()` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å `NULL` ‚Äî –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ!
- –ü–∞–º—è—Ç—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (—Å–æ–¥–µ—Ä–∂–∏—Ç –º—É—Å–æ—Ä)

---

### 3. –ú–∞—Å—Å–∏–≤—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

```c
int n;
printf("Enter array size: ");
scanf("%d", &n);

// –í—ã–¥–µ–ª–∏—Ç—å –º–∞—Å—Å–∏–≤ –∏–∑ n —ç–ª–µ–º–µ–Ω—Ç–æ–≤
int *arr = malloc(n * sizeof(int));
if (!arr) {
    perror("malloc failed");
    return 1;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –º–∞—Å—Å–∏–≤
for (int i = 0; i < n; i++) {
    arr[i] = i * 10;
}

// –û—Å–≤–æ–±–æ–¥–∏—Ç—å
free(arr);
```

---

### 4. –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è

**`calloc()` ‚Äî –≤—ã–¥–µ–ª–∏—Ç—å –∏ –æ–±–Ω—É–ª–∏—Ç—å**:
```c
// calloc(–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ä–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞)
int *arr = calloc(10, sizeof(int));  // 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤—Å–µ = 0
free(arr);
```

**`realloc()` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä**:
```c
int *arr = malloc(10 * sizeof(int));

// –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
arr = realloc(arr, 20 * sizeof(int));
if (!arr) {
    // –û—à–∏–±–∫–∞! –°—Ç–∞—Ä—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–Ω!
}

free(arr);
```

**‚ö†Ô∏è –û–ø–∞—Å–Ω–æ—Å—Ç—å `realloc()`**:
```c
// ‚ùå –ü–õ–û–•–û
arr = realloc(arr, new_size);  // –ï—Å–ª–∏ –≤–µ—Ä–Ω—ë—Ç NULL, arr –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è!

// ‚úÖ –•–û–†–û–®–û
int *temp = realloc(arr, new_size);
if (temp) {
    arr = temp;
} else {
    // arr –µ—â—ë –≤–∞–ª–∏–¥–µ–Ω, –º–æ–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å
    free(arr);
}
```

---

### 5. –°—Ç—Ä–æ–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –¥–ª–∏–Ω—ã

```c
// –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç—Ä–æ–∫—É –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –¥–ª–∏–Ω—ã
char *read_line() {
    int capacity = 10;
    int length = 0;
    char *buffer = malloc(capacity);
    
    int c;
    while ((c = getchar()) != '\n' && c != EOF) {
        if (length + 1 >= capacity) {
            capacity *= 2;
            char *temp = realloc(buffer, capacity);
            if (!temp) {
                free(buffer);
                return NULL;
            }
            buffer = temp;
        }
        buffer[length++] = c;
    }
    buffer[length] = '\0';
    
    return buffer;  // –í—ã–∑—ã–≤–∞—é—â–∏–π –¥–æ–ª–∂–µ–Ω free()!
}
```

---

### 6. –î–≤—É–º–µ—Ä–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã

**–ú–µ—Ç–æ–¥ 1: –ú–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π**:
```c
int rows = 3, cols = 4;

// –í—ã–¥–µ–ª–∏—Ç—å –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π
int **matrix = malloc(rows * sizeof(int*));

// –í—ã–¥–µ–ª–∏—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É
for (int i = 0; i < rows; i++) {
    matrix[i] = malloc(cols * sizeof(int));
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
matrix[1][2] = 42;

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ (–≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!)
for (int i = 0; i < rows; i++) {
    free(matrix[i]);
}
free(matrix);
```

**–ú–µ—Ç–æ–¥ 2: –û–¥–∏–Ω –±–ª–æ–∫ –ø–∞–º—è—Ç–∏** (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ):
```c
int *matrix = malloc(rows * cols * sizeof(int));

// –î–æ—Å—Ç—É–ø –∫–∞–∫ matrix[i][j]:
#define INDEX(i, j) ((i) * cols + (j))
matrix[INDEX(1, 2)] = 42;

// –ò–ª–∏ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é
int* get_element(int *matrix, int cols, int i, int j) {
    return &matrix[i * cols + j];
}

free(matrix);  // –û–¥–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ!
```

---

### 7. –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (Memory Leaks)

**–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏** ‚Äî –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞.

```c
// ‚ùå –£—Ç–µ—á–∫–∞
void leak() {
    int *p = malloc(100 * sizeof(int));
    // –ó–∞–±—ã–ª–∏ free(p)!
}  // p –∏—Å—á–µ–∑–∞–µ—Ç, –Ω–æ –ø–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞!

// ‚ùå –ü–æ—Ç–µ—Ä—è —É–∫–∞–∑–∞—Ç–µ–ª—è
int *p = malloc(100);
p = malloc(200);  // –°—Ç–∞—Ä—ã–π –±–ª–æ–∫ –ø–æ—Ç–µ—Ä—è–Ω!

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
int *p = malloc(100);
free(p);
p = malloc(200);
free(p);
```

---

### 8. –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

```c
// ‚ùå Double free
int *p = malloc(100);
free(p);
free(p);  // –ö–†–ê–®!

// ‚ùå Use after free
int *p = malloc(100);
free(p);
*p = 42;  // –ö–†–ê–®!

// ‚ùå –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –Ω–µ-malloc –ø–∞–º—è—Ç–∏
int x = 42;
int *p = &x;
free(p);  // –ö–†–ê–®!

// ‚ùå –ó–∞–±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å NULL
int *p = malloc(1000000000000);  // –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å NULL!
*p = 42;  // –ö–†–ê–®!

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
int *p = malloc(size);
if (p == NULL) {
    return 1;
}
*p = 42;
free(p);
p = NULL;  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
```

---

## üéØ –ú–∏—Å—Å–∏—è: "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫"

### –õ–µ–≥–µ–Ω–¥–∞

–§–∞–π–ª—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ MOONLIGHT –∏–º–µ—é—Ç **–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä** –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- **–ó–∞–≥–æ–ª–æ–≤–æ–∫** —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- **–ë–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö** —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤
- **–ò–Ω–¥–µ–∫—Å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤. –ù—É–∂–µ–Ω **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫**, –∫–æ—Ç–æ—Ä—ã–π:
1. –ß–∏—Ç–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫
2. –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –ø–æ–¥ –¥–∞–Ω–Ω—ã–µ
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–ª–æ–∫–∏
4. –°—Ç—Ä–æ–∏—Ç –∏–Ω–¥–µ–∫—Å
5. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É

---

### –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ `archive.dat`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```
[HEADER]
  - magic (4 –±–∞–π—Ç–∞): "MOON"
  - version (uint16_t): –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
  - block_count (uint16_t): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
  
[BLOCKS] (block_count —à—Ç—É–∫)
  - type (uint8_t): —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
  - size (uint32_t): —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
  - data (size –±–∞–π—Ç): —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  
[INDEX] (block_count –∑–∞–ø–∏—Å–µ–π)
  - offset (uint32_t): —Å–º–µ—â–µ–Ω–∏–µ –±–ª–æ–∫–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞
  - type (uint8_t): –¥—É–±–ª–∏–∫–∞—Ç —Ç–∏–ø–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```

**–¢–∏–ø—ã –±–ª–æ–∫–æ–≤**:
- `0x01` ‚Äî TEXT (—Å—Ç—Ä–æ–∫–∞)
- `0x02` ‚Äî BINARY (–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `0x03` ‚Äî COMPRESSED (—Å–∂–∞—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤ —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ –Ω–µ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º)

---

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: —Ñ–∞–π–ª `archive.dat`

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
```
=== DYNAMIC LOADER ===
Archive: archive.dat
Version: 1
Blocks: 5

Loading blocks...
[1/5] TEXT (42 bytes) at 0x0010
[2/5] BINARY (1024 bytes) at 0x0040
[3/5] TEXT (15 bytes) at 0x0440
[4/5] COMPRESSED (500 bytes) at 0x0450
[5/5] TEXT (8 bytes) at 0x0640

Index built successfully.

Block 1 (TEXT): "This is a secret message..."
Block 2 (BINARY): [binary data, 1024 bytes]
Block 3 (TEXT): "V. was here."
Block 4 (COMPRESSED): [compressed, 500 bytes]
Block 5 (TEXT): "END"

Total memory allocated: 1589 bytes
Memory freed successfully.
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å –ø–æ–¥ –º–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤
2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π –±–ª–æ–∫, –≤—ã–¥–µ–ª—è—è –ø–∞–º—è—Ç—å –ø–æ–¥ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
3. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å (–º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π/—Å–º–µ—â–µ–Ω–∏–π)
4. –í—ã–≤–µ—Å—Ç–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–ª–æ–∫–æ–≤
5. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –≤—Å—é –ø–∞–º—è—Ç—å

---

## üìù –ó–∞–¥–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct {
    char magic[4];
    uint16_t version;
    uint16_t block_count;
} Header;

typedef struct {
    uint8_t type;
    uint32_t size;
    uint8_t *data;  // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å!
} Block;

typedef struct {
    uint32_t offset;
    uint8_t type;
} IndexEntry;
```

### Starter Code

–§–∞–π–ª `starter.c`:

```c
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>

#define TYPE_TEXT       0x01
#define TYPE_BINARY     0x02
#define TYPE_COMPRESSED 0x03

// TODO: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Header, Block, IndexEntry

// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏

// –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
Header* read_header(FILE *f) {
    // –≤–∞—à –∫–æ–¥
}

// –ü—Ä–æ—á–∏—Ç–∞—Ç—å –±–ª–æ–∫ (—Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –ø–æ–¥ data!)
Block* read_block(FILE *f) {
    // –≤–∞—à –∫–æ–¥
}

// –í—ã–≤–µ—Å—Ç–∏ –±–ª–æ–∫
void print_block(Block *block, int index) {
    // –≤–∞—à –∫–æ–¥
}

// –û—Å–≤–æ–±–æ–¥–∏—Ç—å –±–ª–æ–∫
void free_block(Block *block) {
    // –≤–∞—à –∫–æ–¥
}

int main(int argc, char *argv[]) {
    // TODO:
    // 1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
    // 2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
    // 3. –í—ã–¥–µ–ª–∏—Ç—å –º–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤ (malloc)
    // 4. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∂–¥—ã–π –±–ª–æ–∫
    // 5. –í—ã–≤–µ—Å—Ç–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    // 6. –û—Å–≤–æ–±–æ–¥–∏—Ç—å –≤—Å—é –ø–∞–º—è—Ç—å
    
    return 0;
}
```

---

### –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ö–∞–∫ –≤—ã–¥–µ–ª–∏—Ç—å –º–∞—Å—Å–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä?</summary>

```c
Block *blocks = malloc(block_count * sizeof(Block));
if (!blocks) {
    perror("malloc failed");
    return 1;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
for (int i = 0; i < block_count; i++) {
    blocks[i] = read_block(file);
}

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
for (int i = 0; i < block_count; i++) {
    free_block(&blocks[i]);
}
free(blocks);
```
</details>

<details>
<summary>–ö–∞–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –±–ª–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞?</summary>

```c
Block* read_block(FILE *f) {
    Block *b = malloc(sizeof(Block));
    
    fread(&b->type, 1, 1, f);
    fread(&b->size, sizeof(uint32_t), 1, f);
    
    // –í—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å –ø–æ–¥ –¥–∞–Ω–Ω—ã–µ
    b->data = malloc(b->size);
    if (!b->data) {
        free(b);
        return NULL;
    }
    
    fread(b->data, 1, b->size, f);
    
    return b;
}
```
</details>

<details>
<summary>–ö–∞–∫ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –≤—Å–µ?</summary>

```c
// –°–Ω–∞—á–∞–ª–∞ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
for (int i = 0; i < block_count; i++) {
    free(blocks[i].data);  // –î–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞
}
free(blocks);  // –ú–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤
free(header);  // –ó–∞–≥–æ–ª–æ–≤–æ–∫
```
</details>

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
make
make test
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞**:
- –ü–∞–º—è—Ç—å –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –í—Å–µ –±–ª–æ–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- TEXT –±–ª–æ–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏
- –í—Å—è –ø–∞–º—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
- –ù–µ—Ç —É—Ç–µ—á–µ–∫ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å valgrind/leaks)

---

## üéÅ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏—Å—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- **–ù–∞–≤—ã–∫**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: `dynamic_loader` ‚Äî –∑–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- **–§—É–Ω–¥–∞–º–µ–Ω—Ç**: –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Episode 08 (–ø–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫)

---

## üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [‚Üê Episode 06: Pointer Game](../episode-06-pointer-game/README.md)
- [‚Üí Episode 08: Fragmentation](../episode-08-fragmentation/README.md)
- [üìã Season 2: Memory & Pointers](../README.md)
- [üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞](../../README.md)

---

> *"With great power comes great responsibility. Manage your memory wisely."* ‚Äî V.
