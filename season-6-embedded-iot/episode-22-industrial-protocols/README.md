# Episode 22: "Industrial Protocols" üîê
## Season 6: Embedded & IoT | Episode 22/42

> *"–ö–∞–∂–¥–∞—è –¥–≤–µ—Ä—å ‚Äî —ç—Ç–æ –≤—Ä–∞—Ç–∞. –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª ‚Äî —ç—Ç–æ –∫–ª—é—á."*

---

## üìã Briefing

**–û—Ç:** The Architect  
**–ö–æ–º—É:** Agent [–í–ê–®_–ü–û–ó–´–í–ù–û–ô]  
**–¢–µ–º–∞:** –ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–ª–∞–±–æ—Ç–æ—á–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í–´–°–û–ö–ò–ô

**–°–∏—Ç—É–∞—Ü–∏—è:**

–í–∏–∫—Ç–æ—Ä –ø–µ—Ä–µ–¥–∞–ª –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: —Å–µ—Ä–≤–µ—Ä—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –Ω–µ —Ç–æ–ª—å–∫–æ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é. –§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –°–ö–£–î (–°–∏—Å—Ç–µ–º–∞ –ö–æ–Ω—Ç—Ä–æ–ª—è –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –î–æ—Å—Ç—É–ø–æ–º).

–ß—Ç–æ–±—ã –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä, –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã:
- **Wiegand** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª–µ–π –∫–∞—Ä—Ç –¥–æ—Å—Ç—É–ø–∞
- **Modbus** ‚Äî –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º

**–í–∞—à–∞ –∑–∞–¥–∞—á–∞:**
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ Wiegand (26-bit –∏ 34-bit)
2. –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç Modbus RTU –¥–ª—è –æ–ø—Ä–æ—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
3. –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å RFID-–∫–∞—Ä—Ç—É –¥–ª—è –æ–±—Ö–æ–¥–∞ —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞

---

## üéØ –¶–µ–ª–∏ —ç–ø–∏–∑–æ–¥–∞

–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å:
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ (Wiegand, Modbus)
- ‚úÖ –ü–∞—Ä—Å–∏—Ç—å –±–∏—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å CRC16 –¥–ª—è Modbus
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å serial –ø–æ—Ä—Ç–∞–º–∏ (RS-485/RS-232)
- ‚úÖ –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å RFID-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

---

## üìö –¢–µ–æ—Ä–∏—è

### 1. –ü—Ä–æ—Ç–æ–∫–æ–ª Wiegand

**Wiegand** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª–µ–º –∫–∞—Ä—Ç –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º –°–ö–£–î.

#### –§–æ—Ä–º–∞—Ç Wiegand-26

```
26 –±–∏—Ç = 1 –±–∏—Ç —á—ë—Ç–Ω–æ—Å—Ç–∏ + 8 –±–∏—Ç FC (Facility Code) + 16 –±–∏—Ç ID + 1 –±–∏—Ç —á—ë—Ç–Ω–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä: 0 12345678 1234567890123456 1
         ‚îÇ    ‚îÇ              ‚îÇ      ‚îÇ
         P0  FC(8)        Card ID  P1
         
P0 = —á—ë—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–≤—ã—Ö 13 –±–∏—Ç (even parity)
P1 = —á—ë—Ç–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 13 –±–∏—Ç (odd parity)
```

#### Wiegand-34 (Extended)

```
34 –±–∏—Ç–∞ = 1 + 16 –±–∏—Ç FC + 16 –±–∏—Ç ID + 1
```

**–§–∏–∑–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞:**
- –î–≤–∞ –ø—Ä–æ–≤–æ–¥–∞: Data0 –∏ Data1
- –õ–æ–≥–∏—á–µ—Å–∫–∏–π 0: –∏–º–ø—É–ª—å—Å –Ω–∞ Data0
- –õ–æ–≥–∏—á–µ—Å–∫–∞—è 1: –∏–º–ø—É–ª—å—Å –Ω–∞ Data1
- –î–ª–∏–Ω–∞ –∏–º–ø—É–ª—å—Å–∞: 50 –º–∫—Å, –∏–Ω—Ç–µ—Ä–≤–∞–ª: 2 –º—Å

#### –ö–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞ Wiegand-26:

```c
#include <stdint.h>
#include <stdbool.h>

typedef struct {
    uint8_t facility_code;  // 8 –±–∏—Ç
    uint16_t card_id;       // 16 –±–∏—Ç
    bool valid;             // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ç–Ω–æ—Å—Ç–∏
} WiegandCard;

// –ü–∞—Ä—Å–∏–Ω–≥ Wiegand-26
WiegandCard parse_wiegand26(uint32_t raw_data) {
    WiegandCard card = {0};
    
    // –ò–∑–≤–ª–µ—á—å –±–∏—Ç—ã
    uint8_t p0 = (raw_data >> 25) & 0x01;  // –°—Ç–∞—Ä—à–∏–π –±–∏—Ç
    uint8_t fc = (raw_data >> 17) & 0xFF;  // 8 –±–∏—Ç FC
    uint16_t id = (raw_data >> 1) & 0xFFFF; // 16 –±–∏—Ç ID
    uint8_t p1 = raw_data & 0x01;           // –ú–ª–∞–¥—à–∏–π –±–∏—Ç
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ç–Ω–æ—Å—Ç–∏ P0 (even parity –¥–ª—è –ø–µ—Ä–≤—ã—Ö 13 –±–∏—Ç)
    uint32_t first_half = (raw_data >> 13) & 0x1FFF;
    int count0 = __builtin_popcount(first_half);
    bool p0_valid = ((count0 % 2) == 0);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ P1 (odd parity –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 13 –±–∏—Ç)
    uint32_t second_half = raw_data & 0x1FFF;
    int count1 = __builtin_popcount(second_half);
    bool p1_valid = ((count1 % 2) == 1);
    
    card.facility_code = fc;
    card.card_id = id;
    card.valid = p0_valid && p1_valid;
    
    return card;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Wiegand-26
uint32_t generate_wiegand26(uint8_t fc, uint16_t card_id) {
    uint32_t data = 0;
    
    // –°–æ–±—Ä–∞—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –±–∏—Ç—ã (–±–µ–∑ —á—ë—Ç–Ω–æ—Å—Ç–∏)
    data = ((uint32_t)fc << 17) | ((uint32_t)card_id << 1);
    
    // –í—ã—á–∏—Å–ª–∏—Ç—å P0 (even parity)
    uint32_t first_half = (data >> 13) & 0x1FFF;
    int count0 = __builtin_popcount(first_half);
    uint8_t p0 = (count0 % 2 == 0) ? 0 : 1;
    
    // –í—ã—á–∏—Å–ª–∏—Ç—å P1 (odd parity)
    uint32_t second_half = data & 0x1FFF;
    int count1 = __builtin_popcount(second_half);
    uint8_t p1 = (count1 % 2 == 1) ? 1 : 0;
    
    // –î–æ–±–∞–≤–∏—Ç—å –±–∏—Ç—ã —á—ë—Ç–Ω–æ—Å—Ç–∏
    data |= ((uint32_t)p0 << 25);
    data |= p1;
    
    return data;
}
```

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** Wiegand ‚Äî —ç—Ç–æ "—à—Ç—Ä–∏—Ö-–∫–æ–¥" –Ω–∞ –≤–∞—à–µ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏.

---

### 2. –ü—Ä–æ—Ç–æ–∫–æ–ª Modbus RTU

**Modbus** ‚Äî –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å–≤—è–∑–∏ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–¥–∞—Ç—á–∏–∫–∏, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, actuators).

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Modbus RTU

```
[Slave ID][Function][Data][CRC16 Low][CRC16 High]
   1 byte    1 byte   N bytes  1 byte    1 byte

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (Read Holding Registers):
01 03 00 00 00 0A C5 CD
‚îÇ  ‚îÇ  ‚îÇ     ‚îÇ     ‚îî‚îÄ CRC16
‚îÇ  ‚îÇ  ‚îÇ     ‚îî‚îÄ Count (10 registers)
‚îÇ  ‚îÇ  ‚îî‚îÄ Start Address (0x0000)
‚îÇ  ‚îî‚îÄ Function Code (0x03 = Read Holding Registers)
‚îî‚îÄ Slave ID (0x01)
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Modbus:

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|----------|
| 0x01 | Read Coils | –ß—Ç–µ–Ω–∏–µ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã—Ö –≤—ã—Ö–æ–¥–æ–≤ |
| 0x03 | Read Holding Registers | –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è |
| 0x05 | Write Single Coil | –ó–∞–ø–∏—Å—å –æ–¥–Ω–æ–≥–æ –¥–∏—Å–∫—Ä–µ—Ç–∞ |
| 0x06 | Write Single Register | –ó–∞–ø–∏—Å—å –æ–¥–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞ |
| 0x10 | Write Multiple Registers | –ó–∞–ø–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ |

#### CRC16 –¥–ª—è Modbus:

```c
#include <stdint.h>

// Modbus CRC16 (–ø–æ–ª–∏–Ω–æ–º 0xA001)
uint16_t modbus_crc16(const uint8_t *data, size_t len) {
    uint16_t crc = 0xFFFF;
    
    for (size_t i = 0; i < len; i++) {
        crc ^= (uint16_t)data[i];
        
        for (int j = 0; j < 8; j++) {
            if (crc & 0x0001) {
                crc = (crc >> 1) ^ 0xA001;
            } else {
                crc >>= 1;
            }
        }
    }
    
    return crc;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ CRC
bool modbus_check_crc(const uint8_t *frame, size_t len) {
    if (len < 4) return false;
    
    uint16_t received_crc = frame[len-2] | (frame[len-1] << 8);
    uint16_t calculated_crc = modbus_crc16(frame, len - 2);
    
    return received_crc == calculated_crc;
}
```

#### –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ Modbus:

```c
typedef struct {
    uint8_t slave_id;
    uint8_t function;
    uint16_t start_addr;
    uint16_t count;
} ModbusRequest;

// –°–æ–∑–¥–∞—Ç—å Modbus RTU –∑–∞–ø—Ä–æ—Å
int modbus_read_holding_registers(uint8_t *buf, uint8_t slave_id, 
                                   uint16_t addr, uint16_t count) {
    buf[0] = slave_id;
    buf[1] = 0x03;  // Read Holding Registers
    buf[2] = (addr >> 8) & 0xFF;
    buf[3] = addr & 0xFF;
    buf[4] = (count >> 8) & 0xFF;
    buf[5] = count & 0xFF;
    
    // –î–æ–±–∞–≤–∏—Ç—å CRC
    uint16_t crc = modbus_crc16(buf, 6);
    buf[6] = crc & 0xFF;
    buf[7] = (crc >> 8) & 0xFF;
    
    return 8;  // –î–ª–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞
}
```

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** Modbus ‚Äî —ç—Ç–æ "—è–∑—ã–∫ –æ–±—â–µ–Ω–∏—è" —Å –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –∫–∞–∫ HTTP –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤.

---

### 3. –°–ö–£–î (–°–∏—Å—Ç–µ–º—ã –ö–æ–Ω—Ç—Ä–æ–ª—è –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –î–æ—Å—Ç—É–ø–æ–º)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°–ö–£–î:**

```
[RFID Card] ‚Üí [Reader] --Wiegand--> [Controller] --Modbus/RS485--> [Server]
                                         ‚Üì
                                    [Door Lock]
                                    [Alarm]
```

**–¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞—Ç–∞–∫:**
1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã** ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç –∏ —ç–º—É–ª—è—Ü–∏—è Wiegand
2. **–ü–µ—Ä–µ–±–æ—Ä –∫–æ–¥–æ–≤** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω—ã—Ö Facility Code + Card ID
3. **Modbus injection** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞–ø—Ä—è–º—É—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É
4. **Relay attack** ‚Äî —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ —Å –≤–∞–ª–∏–¥–Ω–æ–π –∫–∞—Ä—Ç—ã

---

## üõ† –ü—Ä–∞–∫—Ç–∏–∫–∞

### –ó–∞–¥–∞–Ω–∏–µ 1: –ü–∞—Ä—Å–µ—Ä Wiegand (‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ)

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `parse_wiegand26()` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ 26-–±–∏—Ç–Ω–æ–≥–æ –∫–æ–¥–∞
- `generate_wiegand26()` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ç–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `artifacts/wiegand_parser.c`

**–¢–µ—Å—Ç:**
```bash
make wiegand
./wiegand 0x1A2B3C4  # –ü–∞—Ä—Å–∏—Ç –∫–æ–¥
./wiegand --gen 123 45678  # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç FC=123, ID=45678
```

---

### –ó–∞–¥–∞–Ω–∏–µ 2: Modbus Client (‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ)

–†–µ–∞–ª–∏–∑—É–π—Ç–µ:
- `modbus_crc16()` ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ CRC
- `modbus_read_holding_registers()` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- `modbus_parse_response()` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞

**–§–∞–π–ª:** `artifacts/modbus_client.c`

**–¢–µ—Å—Ç:**
```bash
make modbus
./modbus_client /dev/ttyUSB0 1 0 10  # Slave 1, addr 0, count 10
```

---

### –ó–∞–¥–∞–Ω–∏–µ 3: RFID Emulator (‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ)

–°–æ–∑–¥–∞–π—Ç–µ —ç–º—É–ª—è—Ç–æ—Ä RFID-–∫–∞—Ä—Ç—ã:
- –ß—Ç–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–∞—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Wiegand-–∫–æ–¥–æ–≤
- –í—ã–≤–æ–¥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –≥–æ—Ç–æ–≤–æ–º –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏

**–§–∞–π–ª:** `artifacts/rfid_emulator.c`

**–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ `valid_cards.txt`:**
```
123,45678
123,45679
200,12345
```

**–ó–∞–ø—É—Å–∫:**
```bash
./rfid_emulator valid_cards.txt
# –í—ã–≤–æ–¥–∏—Ç –≤—Å–µ Wiegand-–∫–æ–¥—ã –≤ hex
```

---

### üéØ Challenge –∑–∞–¥–∞—á–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Modbus Scanner:**
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∞ RS-485 (slave ID 1-247)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞–º
- –ö–∞—Ä—Ç–∞ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏

---

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ö–∞–∫ –≤—ã—á–∏—Å–ª–∏—Ç—å parity bit?</summary>

```c
// Even parity: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —á—ë—Ç–Ω–æ–µ
int ones = __builtin_popcount(data);
uint8_t parity = (ones % 2 == 0) ? 0 : 1;

// Odd parity: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –Ω–µ—á—ë—Ç–Ω–æ–µ
uint8_t parity = (ones % 2 == 1) ? 1 : 0;
```
</details>

<details>
<summary>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å serial –ø–æ—Ä—Ç–æ–º –≤ Linux?</summary>

```c
#include <fcntl.h>
#include <termios.h>
#include <unistd.h>

int fd = open("/dev/ttyUSB0", O_RDWR | O_NOCTTY);
struct termios options;
tcgetattr(fd, &options);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞: 9600 baud, 8N1
cfsetispeed(&options, B9600);
cfsetospeed(&options, B9600);
options.c_cflag |= (CLOCAL | CREAD);
options.c_cflag &= ~PARENB;  // No parity
options.c_cflag &= ~CSTOPB;  // 1 stop bit
options.c_cflag &= ~CSIZE;
options.c_cflag |= CS8;      // 8 data bits

tcsetattr(fd, TCSANOW, &options);
```
</details>

<details>
<summary>–ö–∞–∫ –æ—Ç–ª–∞–¥–∏—Ç—å Modbus –±–µ–∑ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è?</summary>

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ serial –ø–æ—Ä—Ç—ã**:
```bash
# Linux
socat -d -d pty,raw,echo=0 pty,raw,echo=0
# –°–æ–∑–¥–∞—Å—Ç /dev/pts/X –∏ /dev/pts/Y

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
./modbus_master /dev/pts/X &
cat /dev/pts/Y | hexdump -C
```
</details>

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] Wiegand-26 –ø–∞—Ä—Å–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Wiegand —Å –≤–∞–ª–∏–¥–Ω–æ–π —á—ë—Ç–Ω–æ—Å—Ç—å—é
- [ ] Modbus CRC16 —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Modbus –∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] RFID —ç–º—É–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–¥—ã
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`make test`)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Wiegand Protocol Specification](https://en.wikipedia.org/wiki/Wiegand_interface)
- [Modbus RTU Specification](https://www.modbus.org/specs.php)
- [–°–ö–£–î: –æ—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](https://www.integriti.com/access-control/)

---

## üé¨ –°—é–∂–µ—Ç

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –í–∏–∫—Ç–æ—Ä–∞:

```
–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –∫–ª—é—á–∏ –æ—Ç –≤—Å–µ—Ö –¥–≤–µ—Ä–µ–π.
–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –∫–∞–º–µ—Ä—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –ù–∞–º –Ω—É–∂–Ω—ã –≥–ª–∞–∑–∞ –≤–Ω—É—Ç—Ä–∏.

–ì–æ—Ç–æ–≤—å—Å—è –∫ Episode 23: IP Cameras.

‚Äî V.
```

---

**–°–ª–µ–¥—É—é—â–∏–π —ç–ø–∏–∑–æ–¥:** [Episode 23: IP Cameras ‚Üí](../episode-23-ip-cameras/)

**–ù–∞–∑–∞–¥:** [‚Üê Episode 21: Arduino & GPIO](../episode-21-arduino-gpio/)

---

*MOONLIGHT Protocol: Industrial infiltration in progress... üîê*