# Episode 17: "Market Microstructure" üìä
## Season 5, Episode 1

> *"In markets, the truth is always in the details. The devil ‚Äî in the spread."*

---

## üé¨ BRIEFING

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  –õ–û–ö–ê–¶–ò–Ø: Manhattan, Financial District, –ù—å—é-–ô–æ—Ä–∫, –°–®–ê  ‚ïë
‚ïë  –í–†–ï–ú–Ø:   19:00 (EST), —Å—Ä–µ–¥–∞, 18 –¥–µ–∫–∞–±—Ä—è                ‚ïë
‚ïë  –°–¢–ê–¢–£–°:  üü° FINANCIAL DATA INTERCEPTED                  ‚ïë
‚ïë  GPS:     40.7074¬∞N, 74.0113¬∞W (Wall Street)            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**18 –¥–µ–∫–∞–±—Ä—è, 18:00. –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –ú–æ—Å–∫–≤–∞.**

–í—Å—Ç—Ä–µ—á–∞ —Å V. –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í —Ä—É–∫–∞—Ö ‚Äî –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π USB –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å, —Ç—è–∂–µ–ª—ã–π –æ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**18:30.** –í—ã —Å–∞–¥–∏—Ç–µ—Å—å –≤ —Ç–∞–∫—Å–∏ Uber. –ê—ç—Ä–æ–ø–æ—Ä—Ç –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ. –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Ä–µ–π—Å –≤ –ù—å—é-–ô–æ—Ä–∫.

> *"–ê–Ω–∞–ª–∏–∑ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ç–∞–º, –≥–¥–µ –≤—Å—ë –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –ù–∞ –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç. –ë–∏–ª–µ—Ç –æ–ø–ª–∞—á–µ–Ω. –ö–≤–∞—Ä—Ç–∏—Ä–∞ –∞—Ä–µ–Ω–¥–æ–≤–∞–Ω–∞. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—é. ‚Äî V."*

**–†–µ–π—Å Aeroflot SU100:** –ú–æ—Å–∫–≤–∞ (SVO) ‚Üí –ù—å—é-–ô–æ—Ä–∫ (JFK)  
**–í—Ä–µ–º—è –≤ –ø—É—Ç–∏:** 10 —á–∞—Å–æ–≤  
**–ü–æ—Å–∞–¥–∫–∞:** 18 –¥–µ–∫–∞–±—Ä—è, 16:30 EST (01:30 MSK +1 –¥–µ–Ω—å)

---

**16:45 EST. John F. Kennedy International Airport.**

–¢–∞–º–æ–∂–Ω—è –ø—Ä–æ–π–¥–µ–Ω–∞. Yellow Cab –≤–µ–∑—ë—Ç –≤–∞—Å –Ω–∞ Manhattan.

**17:30 EST. Manhattan, Financial District.**

–ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ 42-–º —ç—Ç–∞–∂–µ –Ω–µ–±–æ—Å–∫—Ä—ë–±–∞ —Å –≤–∏–¥–æ–º –Ω–∞ –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç. –û–≥–Ω–∏ –≥–æ—Ä–æ–¥–∞. –ë–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–∞—Å –Ω–∞–∑–∞–¥ (16:00), –Ω–æ –≥–æ—Ä–æ–¥ –Ω–µ —Å–ø–∏—Ç.

**18:00 EST (01:00 MSK). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** 40.7074¬∞N, 74.0113¬∞W

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  USB DRIVE: MOONLIGHT_FINANCIAL             ‚îÇ
‚îÇ  ENCRYPTED: AES-256                         ‚îÇ
‚îÇ  SIZE: 2.7 GB                               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  PASSWORD: "Black-Scholes forever"          ‚îÇ
‚îÇ  (–æ—Ç—Å—ã–ª–∫–∞ –∫ —Ñ–∏–Ω–∞–ª—É Season 4)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**19:00 EST. –ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ Manhattan.**

–ó–∞ –æ–∫–Ω–æ–º ‚Äî –æ–≥–Ω–∏ –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç. –°—Ç–∞—Ç—É—è –°–≤–æ–±–æ–¥—ã –≤–¥–∞–ª–∏. –®—É–º –≥–æ—Ä–æ–¥–∞ –Ω–µ –∑–∞—Ç–∏—Ö–∞–µ—Ç –¥–∞–∂–µ –Ω–æ—á—å—é.

–í—ã –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ USB. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª—ã:

```
üìÅ MOONLIGHT_FINANCIAL/
‚îú‚îÄ‚îÄ NYSE_6months.csv           [OHLCV] 892 MB ‚Äî 6 –º–µ—Å—è—Ü–µ–≤ —Ç–æ—Ä–≥–æ–≤
‚îú‚îÄ‚îÄ NASDAQ_6months.csv         [OHLCV] 1.2 GB ‚Äî –¥–∞–Ω–Ω—ã–µ NASDAQ  
‚îú‚îÄ‚îÄ order_book_snapshots.dat   [BINARY] 450 MB ‚Äî —Å–Ω–∏–º–∫–∏ —Å—Ç–∞–∫–∞–Ω–∞
‚îú‚îÄ‚îÄ suspicious_tickers.txt     [TEXT] 14 KB ‚Äî 47 –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–∫—Ü–∏–π
‚îî‚îÄ‚îÄ analysis_notes.txt         [TEXT] "They manipulate. Prove it. ‚Äî V."
```

–í—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ `suspicious_tickers.txt`:

```
TICKER,REASON,PRIORITY
ACME,Abnormal spread 0.5% (norm 0.01%),HIGH
BCOM,Volume spike x10 at 23:00-01:00,CRITICAL
DTEK,Order book spoofing detected,HIGH
...
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

–ù–æ—Ä–º–∞–ª—å–Ω—ã–π bid-ask spread –Ω–∞ NYSE/NASDAQ ‚Äî **0.01-0.05%** –¥–ª—è –ª–∏–∫–≤–∏–¥–Ω—ã—Ö –∞–∫—Ü–∏–π. –ó–¥–µ—Å—å ‚Äî **0.5%** (–≤ 10-50 —Ä–∞–∑ –≤—ã—à–µ!). –≠—Ç–æ –ª–∏–±–æ –æ—à–∏–±–∫–∞... –ª–∏–±–æ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è.

**V. –æ—Å—Ç–∞–≤–∏–ª –∑–∞–ø–∏—Å–∫—É:**

> *"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫ —á–µ—Ä–µ–∑ HFT –±–æ—Ç—ã. –û–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø—Ä–µ–¥—ã, –º–∞–Ω–∏–ø—É–ª–∏—Ä—É—é—Ç –æ–±—ä–µ–º–æ–º, —Å–ø—É—Ñ—è—Ç order book. $10 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –æ—Ç–º—ã—Ç—ã –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤. –ù–∞–π–¥–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –º–∏–∫—Ä–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –í—Ä–µ–º—è ‚Äî 5 —á–∞—Å–æ–≤ –¥–æ —Å–º–µ–Ω—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ (00:00). –£–¥–∞—á–∏."*

**–ß–∞—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 19:00. –î–æ 00:00 ‚Äî 5 —á–∞—Å–æ–≤.**

**–í–∞—à–∞ –º–∏—Å—Å–∏—è:**
1. –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ OHLCV –¥–∞–Ω–Ω—ã—Ö (Open, High, Low, Close, Volume)
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å bid-ask spread (—Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ–∫—É–ø–∫–æ–π –∏ –ø—Ä–æ–¥–∞–∂–µ–π)
3. –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å market depth (–≥–ª—É–±–∏–Ω—É —Ä—ã–Ω–∫–∞)
4. –ù–∞–π—Ç–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π

**–ù–∞—á–∏–Ω–∞–µ–º.**

---

## üéØ –¶–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è

### –¢–µ–æ—Ä–∏—è (–ø–æ –®–∏–ª–ª–µ—Ä—É)
- **Market Microstructure:** –∫–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ü–µ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Order Book:** —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏—Ä–∂–µ–≤–æ–≥–æ —Å—Ç–∞–∫–∞–Ω–∞
- **Bid-Ask Spread:** —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏
- **Liquidity:** –≥–ª—É–±–∏–Ω–∞ —Ä—ã–Ω–∫–∞, –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (slippage)
- **Market Data:** tick-by-tick –¥–∞–Ω–Ω—ã–µ, –∞–≥—Ä–µ–≥–∞—Ü–∏—è

### –ü—Ä–∞–∫—Ç–∏–∫–∞
- –ü–∞—Ä—Å–∏–Ω–≥ CSV/JSON —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ order book –∏–∑ tick data
- –†–∞—Å—á–µ—Ç spread, volume, volatility
- ASCII –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è market depth

---

## üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### 1. OHLCV Data

**OHLCV** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–≤–µ—á–µ–π (candlesticks):

```
Timestamp,   Open,  High,  Low,   Close, Volume
2025-09-30, 150.00, 152.50, 149.80, 151.20, 1000000
```

- **Open:** —Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–µ—Ä–∏–æ–¥–∞
- **High:** –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
- **Low:** –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞  
- **Close:** —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
- **Volume:** –æ–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤

**–ü–∞—Ä—Å–∏–Ω–≥ –≤ C:**
```c
typedef struct {
    time_t timestamp;
    double open;
    double high;
    double low;
    double close;
    long volume;
} OHLCV;

int parse_ohlcv(const char *line, OHLCV *candle) {
    return sscanf(line, "%ld,%lf,%lf,%lf,%lf,%ld",
                  &candle->timestamp,
                  &candle->open,
                  &candle->high,
                  &candle->low,
                  &candle->close,
                  &candle->volume);
}
```

### 2. Bid-Ask Spread

**Order Book (—Å—Ç–∞–∫–∞–Ω):**

```
ASKS (–ü—Ä–æ–¥–∞–∂–∞)          BIDS (–ü–æ–∫—É–ø–∫–∞)
Price    Volume          Price    Volume
------   -------         ------   -------
$101.50    500    ‚Üê      $100.50   1000
$101.00    300           $100.00   1500
$100.75    200           $99.50     800
```

**Best Bid:** $100.50 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏)  
**Best Ask:** $100.75 (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏)  
**Spread:** $100.75 - $100.50 = **$0.25**

**–ü—Ä–æ—Ü–µ–Ω—Ç spread:** (0.25 / 100.625) * 100 = **0.25%**

```c
double calculate_spread(double best_bid, double best_ask) {
    return best_ask - best_bid;
}

double spread_percentage(double best_bid, double best_ask) {
    double mid_price = (best_bid + best_ask) / 2.0;
    return (calculate_spread(best_bid, best_ask) / mid_price) * 100.0;
}
```

### 3. Market Depth (–≥–ª—É–±–∏–Ω–∞ —Ä—ã–Ω–∫–∞)

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–∫–∞–Ω–∞:**
```
Depth Level | Buy Volume | Price   | Sell Volume
------------|------------|---------|-------------
     3      |     800    | $99.50  |
     2      |    1500    | $100.00 |
     1      |    1000    | $100.50 | ‚Üê Best Bid
     0      |            | ------- |
    -1      |            | $100.75 | ‚Üê Best Ask   200
    -2      |            | $101.00 |              300
    -3      |            | $101.50 |              500
```

### 4. Volatility (–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)

**Historical Volatility:**
```c
double calculate_volatility(double *returns, int n) {
    double mean = 0.0;
    for (int i = 0; i < n; i++) {
        mean += returns[i];
    }
    mean /= n;
    
    double variance = 0.0;
    for (int i = 0; i < n; i++) {
        variance += (returns[i] - mean) * (returns[i] - mean);
    }
    variance /= (n - 1);
    
    return sqrt(variance);
}
```

---

## üíª –ó–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: OHLCV Parser ‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ

–ü–∞—Ä—Å–∏–Ω–≥ CSV —Ñ–∞–π–ª–∞ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```c
// TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
int load_ohlcv_file(const char *filename, OHLCV **candles, int *count);
void print_ohlcv(OHLCV *candle);
void calculate_statistics(OHLCV *candles, int count);
```

**–§–∞–π–ª:** `market_data.csv`

### –ó–∞–¥–∞–Ω–∏–µ 2: Spread Analyzer ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ

–ê–Ω–∞–ª–∏–∑ bid-ask spread:

```c
typedef struct {
    double price;
    long volume;
} OrderLevel;

typedef struct {
    OrderLevel *bids;
    OrderLevel *asks;
    int bid_count;
    int ask_count;
} OrderBook;

// TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
double get_best_bid(OrderBook *book);
double get_best_ask(OrderBook *book);
double calculate_spread(OrderBook *book);
void print_orderbook(OrderBook *book, int depth);
```

### –ó–∞–¥–∞–Ω–∏–µ 3: Market Depth Visualization ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ

ASCII –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–∫–∞–Ω–∞:

```c
// TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
void visualize_depth(OrderBook *book, int levels);
```

**–í—ã–≤–æ–¥:**
```
Market Depth: AAPL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
BIDS                    |  ASKS
Volume    Price         |  Price         Volume
800       $99.50  ‚ñà‚ñà‚ñà‚ñà  |
1500      $100.00 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|
1000      $100.50 ‚ñà‚ñà‚ñà‚ñà‚ñà | ‚Üê Best Bid
                        |
                        | ‚Üê Best Ask  $100.75 ‚ñà‚ñà‚ñà   200
                        |             $101.00 ‚ñà‚ñà‚ñà‚ñà  300
                        |             $101.50 ‚ñà‚ñà‚ñà‚ñà‚ñà 500
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Spread: $0.25 (0.25%)
```

### –ó–∞–¥–∞–Ω–∏–µ 4: Anomaly Detection ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

–î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:

```c
// TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
bool detect_pump_and_dump(OHLCV *candles, int count);
bool detect_wash_trading(OHLCV *candles, int count);
bool detect_spoofing(OrderBook *book);
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**
- Pump & Dump: —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –æ–±—ä–µ–º–∞ + —Ü–µ–Ω—ã, –∑–∞—Ç–µ–º –æ–±–≤–∞–ª
- Wash Trading: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–±—ä–µ–º—ã –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏
- Spoofing: –±–æ–ª—å—à–∏–µ –∑–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è

---

## üé¨ DEBRIEFING

**23:47. –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω.**

–ù–∞ —ç–∫—Ä–∞–Ω–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  MARKET MICROSTRUCTURE ANALYSIS ‚Äî –†–ï–ó–£–õ–¨–¢–ê–¢–´                      ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                   ‚ïë
‚ïë  üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:                                             ‚ïë
‚ïë  ‚Ä¢ 2,847,392 —Å–≤–µ—á–µ–π OHLCV –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤                           ‚ïë
‚ïë  ‚Ä¢ 14,523 —Å–Ω–∏–º–∫–æ–≤ order book                                     ‚ïë
‚ïë  ‚Ä¢ 47 –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–∫–µ—Ä–æ–≤                                     ‚ïë
‚ïë                                                                   ‚ïë
‚ïë  üö® –ê–Ω–æ–º–∞–ª–∏–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã:                                          ‚ïë
‚ïë  ‚Ä¢ Spread 0.5% (–Ω–æ—Ä–º–∞ 0.01%) ‚Äî 12 —Ç–∏–∫–µ—Ä–æ–≤                        ‚ïë
‚ïë  ‚Ä¢ Volume spike x10 –≤ 23:00-01:00 ‚Äî 8 —Ç–∏–∫–µ—Ä–æ–≤                    ‚ïë
‚ïë  ‚Ä¢ Order book spoofing ‚Äî 5 —Ç–∏–∫–µ—Ä–æ–≤                               ‚ïë
‚ïë  ‚Ä¢ Volatility spike +300% ‚Äî 3 —Ç–∏–∫–µ—Ä–∞                             ‚ïë
‚ïë                                                                   ‚ïë
‚ïë  üí∞ –û—Ü–µ–Ω–∫–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π:                                           ‚ïë
‚ïë  ‚Ä¢ –ü—Ä–∏–±—ã–ª—å –æ—Ç spread manipulation: ~$2.4M                        ‚ïë
‚ïë  ‚Ä¢ –ü—Ä–æ—Ñ–∏—Ç –æ—Ç spoofing: ~$1.8M                                    ‚ïë
‚ïë  ‚Ä¢ –ò–¢–û–ì–û –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤: $4.2M                                     ‚ïë
‚ïë                                                                   ‚ïë
‚ïë  ‚úÖ –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ–±—Ä–∞–Ω—ã                                        ‚ïë
‚ïë                                                                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:**

1. **ACME Corp** ‚Äî spread –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏  
   - –ù–æ—Ä–º–∞–ª—å–Ω—ã–π spread: 0.01%  
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: 0.5% (x50!)  
   - HFT –±–æ—Ç—ã —Å–æ–∑–¥–∞—é—Ç –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –Ω–µ–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

2. **BCOM Inc** ‚Äî volume manipulation  
   - –û–±—ã—á–Ω—ã–π volume: 100K –∞–∫—Ü–∏–π/–¥–µ–Ω—å  
   - –í 23:00-01:00: 1M+ –∞–∫—Ü–∏–π (x10)  
   - –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å Asian session (–Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)

3. **DTEK Ltd** ‚Äî order book spoofing  
   - –ö—Ä—É–ø–Ω—ã–µ –∑–∞—è–≤–∫–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è, –∑–∞—Ç–µ–º –æ—Ç–º–µ–Ω—è—é—Ç—Å—è  
   - –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è —Ü–µ–Ω–æ–π –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫  
   - Flash crash potential

**V. –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FROM: V. (ENCRYPTED CHANNEL)               ‚îÇ
‚îÇ  TIME: 23:52                                ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ú–∏–∫—Ä–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –≤—Ä—ë—Ç.   ‚îÇ
‚îÇ  –ù–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö—É—à–∫–∞ –∞–π—Å–±–µ—Ä–≥–∞.           ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏—Ö —Ç–æ—Ä–≥–æ–≤—ã–µ    ‚îÇ
‚îÇ  –∞–ª–≥–æ—Ä–∏—Ç–º—ã. Episode 18 –∂–¥—ë—Ç.                ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –°–ø–∏. –ó–∞–≤—Ç—Ä–∞ –±—É–¥–µ—Ç —Ç—è–∂–µ–ª—ã–π –¥–µ–Ω—å.            ‚îÇ
‚îÇ  ‚Äî V.                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í—Ä–µ–º—è: 00:00. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–º–µ–Ω–∏–ª–∏—Å—å. –ù–æ –≤—ã —É—Å–ø–µ–ª–∏.**

**–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:** üèÜ **"Market Cartographer"** ‚Äî –æ—Å–≤–æ–µ–Ω–∞ –º–∏–∫—Ä–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä—ã–Ω–∫–∞

---

**–†–ï–ó–£–õ–¨–¢–ê–¢ EPISODE 17:**
- ‚úÖ OHLCV –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Bid-ask spread –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–∞–π–¥–µ–Ω—ã
- ‚úÖ Market depth –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ $4.2M –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
- ‚úÖ –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ–±—Ä–∞–Ω—ã

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** [Episode 18: Trading Algorithms ‚Üí](../episode-18-trading-algorithms/)

---

## ü•ö Easter Eggs Episode 17

<details>
<summary>üîç –û—Ç—Å—ã–ª–∫–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã (—Å–ø–æ–π–ª–µ—Ä—ã!)</summary>

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã:
- **Benjamin Graham quote** ‚Äî —É—á–∏—Ç–µ–ª—å Warren Buffett, –∞–≤—Ç–æ—Ä "The Intelligent Investor"
- **Spread 0.5%** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ (SEC investigation —Å–ª—É—á–∞–∏)
- **23:00-01:00 volume** ‚Äî Asian session, —Ç–µ—Ö–Ω–∏–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–≤
- **Order book spoofing** ‚Äî —Ç–µ—Ö–Ω–∏–∫–∞ Navinder Sarao (Flash Crash 2010)
- **HFT bots** ‚Äî High-Frequency Trading, "Flash Boys" (Michael Lewis)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:
- **NYSE tick size** ‚Äî $0.01 (penny increment rule —Å 2001)
- **NASDAQ level 2** ‚Äî real-time order book data
- **Market depth visualization** ‚Äî –∞–Ω–∞–ª–æ–≥ Bloomberg Terminal
- **OHLCV** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Å 1600s (Amsterdam Stock Exchange)
- **Candlestick charts** ‚Äî –∏–∑–æ–±—Ä–µ—Ç–µ–Ω—ã –≤ –Ø–ø–æ–Ω–∏–∏ (1700s, Munehisa Homma)

### –ß–∏—Å–ª–∞:
- **2.7 GB data** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 6 –º–µ—Å—è—Ü–µ–≤ tick-by-tick NYSE
- **$4.2M profit** ‚Äî —Å—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ market manipulation case (SEC 2018-2020)
- **47 tickers** ‚Äî —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –∫ "47 ronin" (—è–ø–æ–Ω—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ –≤–µ—Ä–Ω–æ—Å—Ç–∏)
- **19:00 ‚Üí 00:00** ‚Äî 5 —á–∞—Å–æ–≤, –∫–∞–∫ –≤ Season 4 Episode 13

### –û—Ç—Å—ã–ª–∫–∏ –∫ Season 4:
- **"Black-Scholes forever"** ‚Äî –ø–∞—Ä–æ–ª—å —Å–æ –≤—Å—Ç—Ä–µ—á–∏ –Ω–∞ Red Square (–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)
- **Database Engine** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è OHLCV
- **Hash tables** ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–∏–∫–µ—Ä–æ–≤
- **Sorting algorithms** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ timestamp

**–§–∏–ª–æ—Å–æ—Ñ–∏—è Episode 17**: *"Markets are conversations. Learn to listen."*

</details>

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –ö—É—Ä—Å—ã (–æ—Å–Ω–æ–≤–∞ ‚Äî –®–∏–ª–ª–µ—Ä)
- [Yale: Financial Markets (Robert Shiller)](https://www.coursera.org/learn/financial-markets-global)
- [MIT: Trading and Market Microstructure](https://ocw.mit.edu/)

### –ö–Ω–∏–≥–∏
- **"Market Microstructure Theory"** ‚Äî Maureen O'Hara
- **"Trading and Exchanges"** ‚Äî Larry Harris
- **"Flash Boys"** ‚Äî Michael Lewis (–ø—Ä–æ HFT)

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [Yahoo Finance API](https://finance.yahoo.com/)
- [Alpha Vantage](https://www.alphavantage.co/)
- [IEX Cloud](https://iexcloud.io/)

---

## üèÜ –ë–æ–Ω—É—Å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

### Bonus 1: Real-time Feed Parser ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
–ü–∞—Ä—Å–∏–Ω–≥ WebSocket –ø–æ—Ç–æ–∫–∞ (—Å–∏–º—É–ª—è—Ü–∏—è) –¥–ª—è real-time –¥–∞–Ω–Ω—ã—Ö.

### Bonus 2: VWAP Calculator ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ
Volume Weighted Average Price ‚Äî —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º –æ–±—ä–µ–º–æ–≤.

### Bonus 3: Candlestick Chart ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ
ASCII –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —è–ø–æ–Ω—Å–∫–∏—Ö —Å–≤–µ—á–µ–π.

---

## üìä –ß—Ç–æ –≤—ã —É–∑–Ω–∞–ª–∏

–ü–æ—Å–ª–µ Episode 17 –≤—ã —É–º–µ–µ—Ç–µ:

- ‚úÖ –ü–∞—Ä—Å–∏—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å OHLCV –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å order book (—Å—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫)
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å spread –∏ volatility
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å market depth
- ‚úÖ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Ä—ã–Ω–∫–æ–º

---

## üîú –°–ª–µ–¥—É—é—â–∏–π —ç–ø–∏–∑–æ–¥

–í **Episode 18: Trading Algorithms** –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å:
- –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (SMA, RSI, MACD)
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- Backtesting engine –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- Order matching engine (HFT basics)

–ù–∞–π–¥–µ–Ω–Ω—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏...

---

## üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [‚Üê Season 4 Finale](../../season-4-crypto-and-algorithms/episode-16-data-structures/)
- [‚Üë Season 5 Overview](../README.md)
- [‚Üí Episode 18: Trading Algorithms](../episode-18-trading-algorithms/)
- [üìã –û–±—â–∏–π –ø–ª–∞–Ω –∫—É—Ä—Å–∞](../../CURRICULUM.md)
- [üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞](../../README.md)

---

<div align="center">

**üåô MOONLIGHT OPERATION**  
*Episode 17 of 42 ‚Ä¢ Season 5, Episode 1*

**"Markets don't lie. People lie. Algorithms don't lie. But they can be manipulated."** ‚Äî V.

```
// EPISODE 17: MARKET MICROSTRUCTURE
// STATUS: Enhanced (20% ‚Üí 80%)
// DURATION: 3-4 hours
// ARTIFACTS: market_analyzer
// EVIDENCE: $4.2M manipulations found
```

[‚Üê Season 4](../../season-4-crypto-and-algorithms/) | [Season 5](../README.md) | [Episode 18 ‚Üí](../episode-18-trading-algorithms/)

---

**Episode 17 Complete!** ‚úÖ  
OHLCV Analysis ‚Üí Spread Detection ‚Üí Market Depth ‚Üí Manipulation Evidence

**Next:** Episode 18 ‚Äî Reverse engineering —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

</div>
