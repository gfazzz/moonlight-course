/**
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * Episode 13: Crypto Basics ‚Äî –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –∑–∞–¥–∞—á–∞
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 * –ó–ê–î–ê–ß–ê: Frequency Analyzer –¥–ª—è Caesar Cipher
 * 
 * –¶–µ–ª—å: –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —á–∞—Å—Ç–æ—Ç—ã –±—É–∫–≤ –≤ —Ç–µ–∫—Å—Ç–µ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö.
 *       –≠—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –≤–∑–ª–æ–º—É Caesar cipher.
 * 
 * –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
 * 1. count_frequency() ‚Äî –ø–æ–¥—Å—á—ë—Ç —á–∞—Å—Ç–æ—Ç –±—É–∫–≤ (A-Z)
 * 2. print_histogram() ‚Äî ASCII-–≥—Ä–∞—Ñ–∏–∫ —á–∞—Å—Ç–æ—Ç
 * 3. find_most_frequent() ‚Äî –ø–æ–∏—Å–∫ —Å–∞–º–æ–π —á–∞—Å—Ç–æ–π –±—É–∫–≤—ã
 * 4. detect_caesar_shift() ‚Äî –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–¥–≤–∏–≥–∞
 * 
 * –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
 * - tests/sample_english.txt (–æ–±—ã—á–Ω—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç)
 * - tests/sample_caesar.txt (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ Caesar shift=7)
 * 
 * –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
 * ‚ïê‚ïê‚ïê FREQUENCY ANALYSIS ‚ïê‚ïê‚ïê
 * Total letters: 1523
 * 
 * E: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 12.7% (194)
 * T: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà     9.1%  (139)
 * A: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      8.2%  (125)
 * ...
 * Most frequent: E
 * 
 * –ö–æ–º–ø–∏–ª—è—Ü–∏—è:
 * $ gcc -Wall -Wextra -std=c11 frequency_analyzer.c -o frequency_analyzer
 * 
 * –ó–∞–ø—É—Å–∫:
 * $ ./frequency_analyzer tests/sample_english.txt
 * $ ./frequency_analyzer tests/sample_caesar.txt
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

/**
 * –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—ã –±—É–∫–≤ A-Z –≤ —Ç–µ–∫—Å—Ç–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä)
 * 
 * @param text –í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç
 * @param freq –ú–∞—Å—Å–∏–≤ [26] –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç (freq[0] = A, freq[1] = B, ...)
 * @param total –£–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±—É–∫–≤
 */
void count_frequency(const char *text, int freq[26], int *total) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥—Å—á—ë—Ç —á–∞—Å—Ç–æ—Ç
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å freq[] –Ω—É–ª—è–º–∏
    // 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ text:
    //    - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä toupper()
    //    - –ï—Å–ª–∏ –±—É–∫–≤–∞ A-Z: freq[c - 'A']++
    //    - –£–≤–µ–ª–∏—á–∏—Ç—å *total
}

/**
 * –ü–µ—á–∞—Ç–∞–µ—Ç ASCII-–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —á–∞—Å—Ç–æ—Ç –±—É–∫–≤
 * 
 * @param freq –ú–∞—Å—Å–∏–≤ —á–∞—Å—Ç–æ—Ç [26]
 * @param total –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤
 * 
 * –ü—Ä–∏–º–µ—Ä:
 * E: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 12.7% (194)
 * T: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà     9.1%  (139)
 */
void print_histogram(int freq[26], int total) {
    printf("\n‚ïê‚ïê‚ïê FREQUENCY ANALYSIS ‚ïê‚ïê‚ïê\n");
    printf("Total letters: %d\n\n", total);
    
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—á–∞—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
    // –î–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã A-Z:
    // 1. –ï—Å–ª–∏ freq[i] > 0:
    //    - –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç: 100.0 * freq[i] / total
    //    - –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å bar: ‚ñà (–ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É)
    //    - –í—ã–≤–µ—Å—Ç–∏: –±—É–∫–≤–∞: bar –ø—Ä–æ—Ü–µ–Ω—Ç (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
    // 
    // Hint: ‚ñà = Unicode U+2588, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å printf("‚ñà")
}

/**
 * –ù–∞—Ö–æ–¥–∏—Ç —Å–∞–º—É—é —á–∞—Å—Ç—É—é –±—É–∫–≤—É –≤ –º–∞—Å—Å–∏–≤–µ —á–∞—Å—Ç–æ—Ç
 * 
 * @param freq –ú–∞—Å—Å–∏–≤ —á–∞—Å—Ç–æ—Ç [26]
 * @return –°–∞–º–∞—è —á–∞—Å—Ç–∞—è –±—É–∫–≤–∞ ('A'..'Z')
 */
char find_most_frequent(int freq[26]) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –º–∞–∫—Å–∏–º—É–º–∞
    // 1. –ù–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å max_idx —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º freq[max_idx]
    // 2. –í–µ—Ä–Ω—É—Ç—å 'A' + max_idx
    
    return 'E';  // Placeholder
}

/**
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç Caesar shift, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è —á—Ç–æ
 * —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –±—É–∫–≤–∞ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ç–µ–∫—Å—Ç–µ ‚Äî 'E'
 * 
 * @param freq –ú–∞—Å—Å–∏–≤ —á–∞—Å—Ç–æ—Ç [26]
 * @return –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π shift (0-25)
 * 
 * –õ–æ–≥–∏–∫–∞:
 * –ï—Å–ª–∏ –≤ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–µ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –±—É–∫–≤–∞ 'K', –∞ –≤ plaintext –æ–±—ã—á–Ω–æ 'E',
 * —Ç–æ shift = (K - E + 26) % 26 = (10 - 4 + 26) % 26 = 6
 */
int detect_caesar_shift(int freq[26]) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ shift
    // 1. –ù–∞–π—Ç–∏ —Å–∞–º—É—é —á–∞—Å—Ç—É—é –±—É–∫–≤—É –≤ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–µ
    // 2. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ —ç—Ç–æ 'E' (4) –≤ plaintext
    // 3. –í—ã—á–∏—Å–ª–∏—Ç—å shift = (most_frequent - 4 + 26) % 26
    
    return 0;  // Placeholder
}

/**
 * –ß–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ —Å—Ç—Ä–æ–∫—É
 */
char* read_file(const char *filename) {
    FILE *f = fopen(filename, "r");
    if (!f) {
        perror("fopen");
        return NULL;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
    fseek(f, 0, SEEK_END);
    long size = ftell(f);
    fseek(f, 0, SEEK_SET);
    
    // –í—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å
    char *content = malloc(size + 1);
    if (!content) {
        fclose(f);
        return NULL;
    }
    
    // –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª
    fread(content, 1, size, f);
    content[size] = '\0';
    
    fclose(f);
    return content;
}

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, "Usage: %s <text_file>\n", argv[0]);
        fprintf(stderr, "Example: %s tests/sample_english.txt\n", argv[0]);
        return 1;
    }
    
    // –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª
    char *text = read_file(argv[1]);
    if (!text) {
        return 1;
    }
    
    // –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —á–∞—Å—Ç–æ—Ç—ã
    int freq[26] = {0};
    int total = 0;
    count_frequency(text, freq, &total);
    
    // –í—ã–≤–µ—Å—Ç–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É
    print_histogram(freq, total);
    
    // –ù–∞–π—Ç–∏ —Å–∞–º—É—é —á–∞—Å—Ç—É—é –±—É–∫–≤—É
    char most_freq = find_most_frequent(freq);
    printf("\nMost frequent letter: %c (%.1f%%)\n", 
           most_freq, 100.0 * freq[most_freq - 'A'] / total);
    
    // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å shift (–µ—Å–ª–∏ —ç—Ç–æ Caesar cipher)
    int shift = detect_caesar_shift(freq);
    printf("Detected Caesar shift: %d\n", shift);
    
    if (shift > 0) {
        printf("\nüí° Hint: Try decrypting with shift=%d\n", shift);
    }
    
    free(text);
    return 0;
}

