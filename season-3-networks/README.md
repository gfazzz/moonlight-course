# Season 3: Networks 🌐

> *"Everything is connected. You just need to find the thread."*

---

## 📖 Сюжет

```
╔══════════════════════════════════════════════════════════╗
║  ЛОКАЦИЯ: Москва, Россия                                 ║
║  ПЕРИОД:  1-2 октября (Season 2 завершён)               ║
║  СТАТУС:  🔴 NETWORK INFILTRATION REQUIRED               ║
╚══════════════════════════════════════════════════════════╝
```

**Память изучена. Утечки устранены. Но это был лишь первый уровень.**

След операции MOONLIGHT уходит в **сеть**. V. оставил зашифрованные сообщения в сетевом трафике, спрятал координаты серверов в IP-адресах, и запустил секретные узлы по всему интернету.

### Временная линия Season 3:

```
04:27 ────────→ 07:15 ────────→ 14:42 ────────→ 22:35 ────────→ 06:47
  │               │               │               │               │
Ep 09          Ep 09          Ep 10          Ep 11          Ep 12
Новое          Паттерн        TCP            Перехват       Финал
сообщение      найден         соединение     успешен        Season 3
от V.          (31337)        установлено    (10.0.0.1)     завершён
```

**Что вам предстоит:**
- 🌐 **Понять** IP-адресацию и структуру сетей
- 🔌 **Подключиться** к секретному серверу V.
- 📡 **Перехватить** зашифрованный трафик агентов
- 🔐 **Расшифровать** TCP-потоки и извлечь послание

Каждый пакет — зацепка. Каждое соединение — след. **Научитесь читать сеть.**

---

## 🎯 Цель сезона

Освоить сетевое программирование на C — от основ TCP/IP до перехвата и анализа трафика:

- ✅ Понимать сетевые протоколы на низком уровне (IP, TCP, UDP)
- ✅ Создавать клиент-серверные приложения с сокетами
- ✅ Анализировать сетевой трафик (packet sniffing)
- ✅ Перехватывать и расшифровывать коммуникации
- ✅ Работать с raw sockets и реконструкцией сессий

**Результат**: Вы станете мастером сетей, способным видеть и понимать любой сетевой трафик.

## 🎬 Эпизоды

### 📍 Episode 09: "Network Basics" 🌐
```
┌──────────────────────────────────────────────┐
│ 📅 04:27 → 07:15                             │
│ 🎯 Анализ IP-адресов                         │
│ ⏱️  ~2 часа                                   │
│ 🔥 Сложность: 🟡 Medium                      │
└──────────────────────────────────────────────┘
```

**Тема**: Основы сетей и TCP/IP

V. прислал файл `addresses.txt` с координатами серверов MOONLIGHT. Это не просто адреса — в них закодирован паттерн, указывающий на первый узел сети.

**Навыки**:
- 🌐 Модель OSI и TCP/IP stack
- 📍 IP-адресация, маски подсети (RFC 1918)
- 🔢 Порты и протоколы (TCP, UDP, ICMP)
- 📦 Структуры сетевых пакетов (`struct sockaddr_in`, `struct in_addr`)
- 🔄 Byte order conversion (`htons`, `ntohs`, `htonl`, `ntohl`)
- 🔍 Классификация IP (private/public/loopback)

**Артефакт**: `net_analyzer` — анализатор IP-адресов и портов

**Достижение**: 🎖️ **"Network Cartographer"** — понимание IP-адресации на уровне байтов

---

### 📍 Episode 10: "Socket Programming" 🔌
```
┌──────────────────────────────────────────────┐
│ 📅 09:30 → 14:42                             │
│ 🎯 TCP-подключение к серверу                 │
│ ⏱️  ~2.5 часа                                 │
│ 🔥 Сложность: 🟡 Medium                      │
└──────────────────────────────────────────────┘
```

**Тема**: Сокеты и клиент-сервер

Адрес найден: `203.0.113.42:31337`. Теперь нужно подключиться к серверу V. и пройти challenge-response аутентификацию.

**Навыки**:
- 🔌 Создание сокетов (`socket()`, `bind()`, `listen()`)
- 🤝 TCP handshake (SYN → SYN-ACK → ACK)
- 📡 Функции `connect()`, `accept()`, `send()`, `recv()`
- 📨 UDP-коммуникация (`sendto()`, `recvfrom()`)
- ⚡ Неблокирующие сокеты и `select()`
- 🔐 Challenge-response protocol
- ❌ Обработка ошибок (`errno`, `perror`)

**Артефакт**: `moonlight_client` — TCP клиент для связи с сервером

**Достижение**: 🎖️ **"Socket Master"** — владение TCP/IP на уровне кода

---

### 📍 Episode 11: "Packet Analysis" 📡
```
┌──────────────────────────────────────────────┐
│ 📅 18:20 → 22:35                             │
│ 🎯 Перехват сетевого трафика                 │
│ ⏱️  ~3 часа                                   │
│ 🔥 Сложность: 🔴 Hard                        │
└──────────────────────────────────────────────┘
```

**Тема**: Перехват и анализ трафика (требуется sudo!)

Агенты противника обмениваются данными на порту 9999. Обычные сокеты не видят чужой трафик. Нужны **raw sockets**.

**Навыки**:
- 🔓 Raw sockets (`SOCK_RAW`, `IPPROTO_TCP`)
- 📦 Структуры заголовков (`struct iphdr`, `struct tcphdr`)
- 🎯 Packet sniffing (чтение всех пакетов)
- 🔍 Парсинг IP и TCP headers
- 🎨 Hex dump (offset, hex, ASCII)
- 🚦 Фильтрация по портам и адресам
- 🔐 Извлечение payload

**Артефакт**: `packet_sniffer` — перехватчик сетевых пакетов

**Достижение**: 🎖️ **"Packet Master"** — видение сети на уровне байтов

---

### 📍 Episode 12: "Encrypted Communications" 🔐 **[FINALE]**
```
┌──────────────────────────────────────────────┐
│ 📅 02:15 → 06:47                             │
│ 🎯 Реконструкция зашифрованных TCP-потоков   │
│ ⏱️  ~3.5 часа                                 │
│ 🔥 Сложность: 🔴 Hard (Finale)               │
└──────────────────────────────────────────────┘
```

**Тема**: Финальная миссия — полная интеграция Season 3

Два агента обмениваются зашифрованными сообщениями через TCP (`10.0.0.1:4433`). Нужно перехватить поток, восстановить порядок пакетов, извлечь ключ и расшифровать.

**Навыки**:
- 🔗 TCP session reconstruction
- 🔢 Сортировка пакетов по sequence numbers
- 🧩 Сборка потока данных из фрагментов
- 🔑 Извлечение ключа из протокола
- 🔐 XOR дешифровка (Episode 01!)
- 🎯 Интеграция ВСЕХ навыков Season 1-3

**Интеграция**:
- ✅ Episode 01 (XOR шифрование)
- ✅ Episode 09 (IP адресация)
- ✅ Episode 10 (TCP сокеты)
- ✅ Episode 11 (Packet sniffing)

**Артефакт**: `comm_interceptor` — полная система перехвата

**Достижение**: 🏆 **"Network Wizard"** — полное владение сетями на всех уровнях

---

## 📊 Прогресс Season 3

```
┌─────────────────────────────────────────────────────────┐
│  Episode 09: Network Basics              [████████]  100%│
│  Episode 10: Socket Programming          [████████]  100%│
│  Episode 11: Packet Analysis             [████████]  100%│
│  Episode 12: Encrypted Communications    [████████]  100%│
├─────────────────────────────────────────────────────────┤
│  🎖️  Навыки разблокированы: 4/4                         │
│  🏆 Артефакты получены: 4/4                             │
│  ⏱️  Общее время: ~11 часов                              │
└─────────────────────────────────────────────────────────┘
```

---

## 🎓 Что вы освоите

### Технические навыки:
- ✅ **TCP/IP протоколы** — понимание на уровне байтов
- ✅ **Socket API** — создание клиентов и серверов
- ✅ **Raw sockets** — перехват любого трафика
- ✅ **Packet analysis** — парсинг заголовков IP/TCP/UDP
- ✅ **Session reconstruction** — восстановление TCP-потоков
- ✅ **Network byte order** — правильная работа с `htons`/`ntohs`

### Инструменты:
- 🛠️ `net_analyzer` — анализ IP-адресов
- 🛠️ `moonlight_client` — TCP клиент
- 🛠️ `packet_sniffer` — перехватчик пакетов
- 🛠️ `comm_interceptor` — система полного перехвата

**Вы станете способны**: читать, перехватывать и анализировать любой сетевой трафик.

---

## 🛠️ Инструменты

Для прохождения Season 3 понадобятся:

```bash
# Базовые инструменты (у вас уже есть)
gcc --version
make --version

# Сетевые утилиты (встроены)
ifconfig  # или ip addr (Linux)
netstat   # или ss (Linux)
tcpdump   # для проверки перехвата

# Опционально (для тестирования)
nc (netcat)  # для создания тестовых соединений
wireshark    # GUI для анализа (не обязательно)
```

> **Важно для macOS/Linux**: Некоторые операции требуют root-прав (sudo), особенно raw sockets.

## 🎓 Последовательность прохождения

1. **Episode 09** → основы TCP/IP и адресация
2. **Episode 10** → сокеты (требует Episode 09)
3. **Episode 11** → packet sniffing (требует Episodes 09-10)
4. **Episode 12** → финальная миссия (требует все предыдущие)

Каждый эпизод строится на предыдущем. Рекомендуется проходить последовательно.

## 🥚 Easter Eggs Season 3

<details>
<summary>🔍 Отсылки и секреты по сезону</summary>

### Episode 09:
- **Port 31337** — классический "leet" хакерский порт (31337 = ELEET)
- **203.0.113.0/24** — TEST-NET-3 (RFC 5737), зарезервирован для документации
- **0x042713** — timestamp 04:27:13, отсылка к известному кибер-инциденту 2013

### Episode 10:
- **Challenge-Response** — механизм CHAP и HTTP Digest Auth
- **Hash * 31** — алгоритм Java `String.hashCode()`
- **0xE28** — timestamp 14:40, отсылка к Enigma machine (E-28 variant)

### Episode 11:
- **Raw sockets** — основа Wireshark, tcpdump, Snort
- **Port 9999** — часто используется малварами (backdoor)
- **Promiscuous mode** — термин из радиоперехвата
- **CVE-2022-5623** — timestamp 22:35 = 0x5623

### Episode 12:
- **TCP Follow Stream** — функция Wireshark
- **Sequence numbers** — изобретены в 1974 Vint Cerf и Bob Kahn
- **0x0647** — timestamp 06:47, отсылка к RFC 647 (early protocols)
- **0x42** — Answer to Everything (Hitchhiker's Guide)

**Философия Season 3**: *"Сеть — это ткань. Пакеты — нити. Протоколы — узоры. Мастер видит всю картину целиком."*

</details>

---

## 🏆 Финал Season 3

После завершения Episode 12 вы получите:

```
╔═══════════════════════════════════════════════════════╗
║                                                       ║
║  🎉 SEASON 3: NETWORKS — COMPLETE!                    ║
║                                                       ║
║  Вы освоили:                                          ║
║  ✅ IP-адресацию и сетевые структуры                  ║
║  ✅ TCP/UDP сокеты и клиент-сервер                    ║
║  ✅ Raw sockets и packet sniffing                     ║
║  ✅ TCP session reconstruction                        ║
║  ✅ Интеграцию шифрования и сетей                     ║
║                                                       ║
║  Артефакты созданы: 4/4                               ║
║  Навыки разблокированы: 4/4                           ║
║                                                       ║
║  🚀 Готовность к Season 4: 100%                       ║
║                                                       ║
╚═══════════════════════════════════════════════════════╝
```

**Следующий шаг**: Season 4 — Crypto & Algorithms ждёт вас!

---

## 🔗 Навигация между сезонами

- [← Season 2: Memory & Pointers](../season-2-memory-and-pointers/README.md)
- [→ Season 4: Crypto & Algorithms](../season-4-crypto-and-algorithms/README.md)
- [📋 Общий план курса](../CURRICULUM.md)
- [🏠 Главная страница](../README.md)

---

> *"In the network, everyone leaves traces. You've learned to read them all."* — V.

---

## ⚠️ Важные замечания

### Безопасность и легальность

**Все техники в этом сезоне предназначены ТОЛЬКО для:**
- Образовательных целей
- Тестирования собственных систем
- Авторизованного пентеста

**НИКОГДА не используйте:**
- На чужих сетях без разрешения
- Для незаконного перехвата трафика
- В нарушение законов о кибербезопасности

**Вы несёте полную ответственность** за использование полученных знаний.

### Системные требования

- **Root/sudo доступ** для raw sockets
- **Разрешение firewall** для серверных сокетов
- **Виртуальная сеть** для безопасного тестирования (рекомендуется)

### Рекомендуемая среда

Для практики создайте изолированную сеть:
```bash
# Вариант 1: Локальный loopback (127.0.0.1)
# Безопасно, но ограниченно

# Вариант 2: Docker network
docker network create moonlight-net

# Вариант 3: VirtualBox/VMware с NAT network
# Полный контроль, изолировано от основной сети
```

---

> *"In the network, everyone leaves traces. Learn to read them."* — V.
