# Season 3: Networks 🌐

> *"Everything is connected. You just need to find the thread."*

**Version:** v2.0-enhanced  
**Status:** ✅ Professional Quality 95%  
**Контрольные вопросы:** 60 (полностью интегрированы в сюжет)  
**Промежуточные задачи:** 3 (с автотестами)  
**Метафоры:** 3 (с ASCII-диаграммами)

📄 [CHANGELOG](./CHANGELOG.md) | 📊 [IMPROVEMENTS SUMMARY](./IMPROVEMENTS_SUMMARY.md)

---

## 📖 Сюжет

```
╔══════════════════════════════════════════════════════════╗
║  ЛОКАЦИЯ: Москва, Россия                                 ║
║  ПЕРИОД:  1-2 октября (Season 2 завершён)               ║
║  СТАТУС:  🔴 NETWORK INFILTRATION REQUIRED               ║
╚══════════════════════════════════════════════════════════╝
```

**Память изучена. Утечки устранены. Но это был лишь первый уровень.**

След операции MOONLIGHT уходит в **сеть**. V. оставил зашифрованные сообщения в сетевом трафике, спрятал координаты серверов в IP-адресах, и запустил секретные узлы по всему интернету.

### Временная линия Season 3:

```
СРЕДА, 1 ОКТЯБРЯ                                    ПЯТНИЦА, 3 ОКТЯБРЯ
04:00 ───→ 10:47 ───→ 19:47 ───→ 04:30 ───────────→ 08:00
  │          │          │          │                   │
Ep 09      Ep 10      Ep 11      Ep 12             ВСТРЕЧА
GPS из IP  Сервер V.  Safe house Расшифровка     Красная площадь
найден     +DDoS      раскрыт!   завершена       Viktor передаёт USB
(31337)    атака      (контр-                    Season 4 начинается
                      слежка)
```

**Ключевые события:**
- 04:27: IP `203.0.113.42` декодируется в GPS Красной площади
- 10:16: DDoS-атака агентов Z. на сервер V.
- 19:47: Перехвачены координаты safe house (взаимный sniffing!)
- 08:00: Финальная встреча с Viktor у Спасской башни

**Что вам предстоит:**
- 🌐 **Понять** IP-адресацию и структуру сетей
- 🔌 **Подключиться** к секретному серверу V.
- 📡 **Перехватить** зашифрованный трафик агентов
- 🔐 **Расшифровать** TCP-потоки и извлечь послание

Каждый пакет — зацепка. Каждое соединение — след. **Научитесь читать сеть.**

---

## 🎯 Цель сезона

Освоить сетевое программирование на C — от основ TCP/IP до перехвата и анализа трафика:

- ✅ Понимать сетевые протоколы на низком уровне (IP, TCP, UDP)
- ✅ Создавать клиент-серверные приложения с сокетами
- ✅ Анализировать сетевой трафик (packet sniffing)
- ✅ Перехватывать и расшифровывать коммуникации
- ✅ Работать с raw sockets и реконструкцией сессий

**Результат**: Вы станете мастером сетей, способным видеть и понимать любой сетевой трафик.

## 🎬 Эпизоды

### 📍 Episode 09: "Network Basics" 🌐
```
┌──────────────────────────────────────────────┐
│ 📅 04:00 → 20:00 (16 часов)                  │
│ 🎯 Анализ IP-адресов + GPS-декодирование     │
│ ⏱️  ~2.5 часа                                 │
│ 🔥 Сложность: 🟡 Medium                      │
└──────────────────────────────────────────────┘
```

**Тема**: Основы сетей и TCP/IP

V. прислал файл `addresses.txt` с координатами серверов MOONLIGHT. Это не просто адреса — IP `203.0.113.42` **декодируется в GPS координаты Красной площади** (55.7558°N 37.6173°E)!

**🎭 Метафора**: "Интернет = Город с адресами"  
IP=адрес здания, порт=квартира, private IP=закрытый район, loopback=ваш дом

**Навыки**:
- 🌐 Модель OSI и TCP/IP stack
- 📍 IP-адресация, маски подсети (RFC 1918)
- 🔢 Порты и протоколы (TCP, UDP, ICMP)
- 📦 Структуры сетевых пакетов (`struct sockaddr_in`, `struct in_addr`)
- 🔄 Byte order conversion (`htons`, `ntohs`, `htonl`, `ntohl`)
- 🔍 Классификация IP (private/public/loopback)

**Промежуточная задача**: `ip_converter.c` — конвертация IP строк, классификация, byte order

**Контрольные вопросы**: 12 (интегрированы в сюжет: "Как IP помог найти Красную площадь?")

**Артефакт**: `net_analyzer` — анализатор IP-адресов и портов

**Достижение**: 🎖️ **"Network Cartographer"** — понимание IP-адресации на уровне байтов

---

### 📍 Episode 10: "Socket Programming" 🔌
```
┌──────────────────────────────────────────────┐
│ 📅 09:30 → 23:30 (14 часов + DDoS-атака)     │
│ 🎯 TCP-подключение к серверу                 │
│ ⏱️  ~2.5 часа                                 │
│ 🔥 Сложность: 🟡 Medium                      │
│ 🔴 DEADLINE: Сервер самоуничтожится через 5ч!│
└──────────────────────────────────────────────┘
```

**Тема**: Сокеты и клиент-сервер

Адрес найден: `203.0.113.42:31337`. Теперь нужно подключиться к серверу V. и пройти challenge-response аутентификацию. **НО: в 10:16 агенты Z. запускают DDoS-атаку!** Первая попытка провалена. Нужно ждать 30 минут...

**🎭 Метафора**: "TCP = Телефонный звонок"  
socket()=взять трубку, connect()=набрать номер, send()=говорить, recv()=слушать, close()=положить трубку

**Навыки**:
- 🔌 Создание сокетов (`socket()`, `bind()`, `listen()`)
- 🤝 TCP handshake (SYN → SYN-ACK → ACK)
- 📡 Функции `connect()`, `accept()`, `send()`, `recv()`
- 📨 UDP-коммуникация (`sendto()`, `recvfrom()`)
- ⚡ Неблокирующие сокеты и `select()`
- 🔐 Challenge-response protocol
- ❌ Обработка ошибок (`errno`, `perror`)

**Промежуточная задача**: `simple_echo_client.c` — базовый TCP-клиент для echo-сервера

**Контрольные вопросы**: 15 (интегрированы в сюжет: "Почему DDoS провалил первую попытку?")

**Артефакт**: `moonlight_client` — TCP клиент для связи с сервером

**Достижение**: 🎖️ **"Socket Master"** — владение TCP/IP на уровне кода

---

### 📍 Episode 11: "Packet Analysis" 📡
```
┌──────────────────────────────────────────────┐
│ 📅 18:20 → 02:20 (8 часов)                   │
│ 🎯 Перехват сетевого трафика                 │
│ ⏱️  ~2.0 часа                                 │
│ 🔥 Сложность: 🔴 Hard (требуется sudo!)      │
│ 🚨 COUNTER-SURVEILLANCE DETECTED!            │
└──────────────────────────────────────────────┘
```

**Тема**: Перехват и анализ трафика (требуется sudo!)

Агенты Z. обмениваются данными на порту 9999. Обычные сокеты не видят чужой трафик. Нужны **raw sockets**. **НО: в 19:47 вы обнаруживаете, что агенты Z. ТОЖЕ используют packet sniffing!** Они перехватили координаты вашего safe house (55.7520°N 37.6175°E). Информационная война!

**🎭 Метафора**: "Packet Sniffing = Подслушивающее устройство"  
Кафе=сеть, столы=устройства, микрофон=raw socket, promiscuous mode=слышать все разговоры

**Навыки**:
- 🔓 Raw sockets (`SOCK_RAW`, `IPPROTO_TCP`)
- 📦 Структуры заголовков (`struct iphdr`, `struct tcphdr`)
- 🎯 Packet sniffing (чтение всех пакетов)
- 🔍 Парсинг IP и TCP headers
- 🎨 Hex dump (offset, hex, ASCII)
- 🚦 Фильтрация по портам и адресам
- 🔐 Извлечение payload

**Промежуточная задача**: `header_parser.c` — парсинг IP/TCP заголовков из binary packet

**Контрольные вопросы**: 15 (интегрированы в сюжет: "Как Z. узнали координаты safe house?")

**Артефакт**: `packet_sniffer` — перехватчик сетевых пакетов

**Достижение**: 🎖️ **"Packet Master"** — видение сети на уровне байтов

---

### 📍 Episode 12: "Encrypted Communications" 🔐 **[FINALE]**
```
┌──────────────────────────────────────────────┐
│ 📅 02:15 → 08:00 (6 часов + встреча)         │
│ 🎯 Реконструкция зашифрованных TCP-потоков   │
│ ⏱️  ~3.0 часа                                 │
│ 🔥 Сложность: 🔴 Hard (Finale)               │
│ 🏁 ФИНАЛ: Встреча с Viktor на Красной площади│
└──────────────────────────────────────────────┘
```

**Тема**: Финальная миссия — полная интеграция Season 3

Агенты Z. обмениваются зашифрованными сообщениями через TCP (`10.0.0.1:4433`). Нужно перехватить поток, восстановить порядок 8 пакетов, извлечь ключ XOR и расшифровать. **В 04:30 координаты расшифрованы: 55.7558°N 37.6173°E — те же, что из Episode 09!** В 08:00 утра вы встречаете Viktor у Спасской башни Кремля. Он передаёт USB-флешку: **"Season 4: Crypto & Algorithms"**. Season 3 завершён! 🎉

**🎭 Метафора**: "TCP Session = Разорванное письмо"  
Пакеты=кусочки письма, SEQ=номера, qsort()=сортировка, reassembly=склеивание, XOR=расшифровка

**Навыки**:
- 🔗 TCP session reconstruction
- 🔢 Сортировка пакетов по sequence numbers
- 🧩 Сборка потока данных из фрагментов
- 🔑 Извлечение ключа из протокола (KEY:0x42)
- 🔐 XOR дешифровка (Episode 01!)
- 🎯 Интеграция ВСЕХ навыков Season 1-3

**Интеграция**:
- ✅ Episode 01 (XOR шифрование)
- ✅ Episode 09 (IP адресация, GPS-координаты)
- ✅ Episode 10 (TCP сокеты, порт 4433)
- ✅ Episode 11 (Packet sniffing, raw sockets)

**Промежуточная задача**: `packet_sorter.c` — сортировка пакетов по SEQ, gap detection

**Контрольные вопросы**: 18 (интегрированы в сюжет: "Готовы ли вы к Season 4?")

**Артефакт**: `comm_interceptor` — полная система перехвата

**Достижение**: 🏆 **"Network Wizard"** — полное владение сетями на всех уровнях

---

## 📊 Прогресс Season 3 v2.0

```
┌──────────────────────────────────────────────────────────┐
│  Episode 09: Network Basics              [████████]  100%│
│  Episode 10: Socket Programming          [████████]  100%│
│  Episode 11: Packet Analysis             [████████]  100%│
│  Episode 12: Encrypted Communications    [████████]  100%│
├──────────────────────────────────────────────────────────┤
│  🎖️  Навыки разблокированы: 4/4                          │
│  🏆 Артефакты получены: 4/4 (+ 3 промежуточные задачи)   │
│  📝 Контрольные вопросы: 60/60 (интегрированы в сюжет!)  │
│  🎭 Метафоры с ASCII: 3/3                                │
│  ⏱️  Общее время: ~8-10 часов (в зависимости от темпа)   │
│  ⭐ Professional Quality: 95%                            │
└──────────────────────────────────────────────────────────┘
```

**Новое в v2.0:**
- ✅ GPS-декодирование из IP (Episode 09)
- ✅ DDoS-атака + deadline (Episode 10)
- ✅ Counter-surveillance, взаимный sniffing (Episode 11)
- ✅ Финальная встреча с Viktor на Красной площади (Episode 12)
- ✅ 3 промежуточные задачи (ip_converter, simple_echo_client, header_parser)
- ✅ 60 контрольных вопросов, 100% привязаны к сюжету миссий
- ✅ 3 визуальные метафоры с ASCII-диаграммами

---

## 🎓 Что вы освоите

### Технические навыки:
- ✅ **TCP/IP протоколы** — понимание на уровне байтов
- ✅ **Socket API** — создание клиентов и серверов
- ✅ **Raw sockets** — перехват любого трафика
- ✅ **Packet analysis** — парсинг заголовков IP/TCP/UDP
- ✅ **Session reconstruction** — восстановление TCP-потоков
- ✅ **Network byte order** — правильная работа с `htons`/`ntohs`

### Инструменты:

**Основные артефакты:**
- 🛠️ `net_analyzer` — анализ IP-адресов (Episode 09)
- 🛠️ `moonlight_client` — TCP клиент (Episode 10)
- 🛠️ `packet_sniffer` — перехватчик пакетов (Episode 11)
- 🛠️ `comm_interceptor` — система полного перехвата (Episode 12)

**Промежуточные задачи (v2.0):**
- 🔧 `ip_converter` — конвертация IP строк, классификация (Episode 09)
- 🔧 `simple_echo_client` — базовый TCP-клиент (Episode 10)
- 🔧 `header_parser` — парсинг IP/TCP заголовков (Episode 11)
- 🔧 `packet_sorter` — сортировка пакетов по SEQ (Episode 12)

**Вы станете способны**: читать, перехватывать и анализировать любой сетевой трафик.

---

## 🛠️ Инструменты

Для прохождения Season 3 понадобятся:

```bash
# Базовые инструменты (у вас уже есть)
gcc --version
make --version

# Сетевые утилиты (встроены)
ifconfig  # или ip addr (Linux)
netstat   # или ss (Linux)
tcpdump   # для проверки перехвата

# Опционально (для тестирования)
nc (netcat)  # для создания тестовых соединений
wireshark    # GUI для анализа (не обязательно)
```

> **Важно для macOS/Linux**: Некоторые операции требуют root-прав (sudo), особенно raw sockets.

## 🎓 Последовательность прохождения

1. **Episode 09** → основы TCP/IP и адресация + `ip_converter` (промежуточная задача)
2. **Episode 10** → сокеты + `simple_echo_client` → `moonlight_client` (требует Episode 09)
3. **Episode 11** → packet sniffing + `header_parser` → `packet_sniffer` (требует Episodes 09-10)
4. **Episode 12** → финальная миссия + `packet_sorter` → `comm_interceptor` (требует все предыдущие)

Каждый эпизод строится на предыдущем. Рекомендуется проходить последовательно.

**Новое в v2.0:** Промежуточные задачи помогают освоить базовые концепции перед основной миссией!

## 🥚 Easter Eggs Season 3

<details>
<summary>🔍 Отсылки и секреты по сезону</summary>

### Episode 09:
- **Port 31337** — классический "leet" хакерский порт (31337 = ELEET)
- **203.0.113.0/24** — TEST-NET-3 (RFC 5737), зарезервирован для документации
- **0x042713** — timestamp 04:27:13, отсылка к известному кибер-инциденту 2013

### Episode 10:
- **Challenge-Response** — механизм CHAP и HTTP Digest Auth
- **Hash * 31** — алгоритм Java `String.hashCode()`
- **0xE28** — timestamp 14:40, отсылка к Enigma machine (E-28 variant)

### Episode 11:
- **Raw sockets** — основа Wireshark, tcpdump, Snort
- **Port 9999** — часто используется малварами (backdoor)
- **Promiscuous mode** — термин из радиоперехвата
- **CVE-2022-5623** — timestamp 22:35 = 0x5623

### Episode 12:
- **TCP Follow Stream** — функция Wireshark
- **Sequence numbers** — изобретены в 1974 Vint Cerf и Bob Kahn
- **0x0647** — timestamp 06:47, отсылка к RFC 647 (early protocols)
- **0x42** — Answer to Everything (Hitchhiker's Guide)

**Философия Season 3**: *"Сеть — это ткань. Пакеты — нити. Протоколы — узоры. Мастер видит всю картину целиком."*

</details>

---

## 🏆 Финал Season 3

После завершения Episode 12 вы получите:

```
╔═══════════════════════════════════════════════════════╗
║                                                       ║
║  🎉 SEASON 3: NETWORKS — COMPLETE!                    ║
║                                                       ║
║  Вы освоили:                                          ║
║  ✅ IP-адресацию и сетевые структуры                  ║
║  ✅ TCP/UDP сокеты и клиент-сервер                    ║
║  ✅ Raw sockets и packet sniffing                     ║
║  ✅ TCP session reconstruction                        ║
║  ✅ Интеграцию шифрования и сетей                     ║
║                                                       ║
║  Артефакты созданы: 4/4                               ║
║  Навыки разблокированы: 4/4                           ║
║                                                       ║
║  🚀 Готовность к Season 4: 100%                       ║
║                                                       ║
╚═══════════════════════════════════════════════════════╝
```

**Следующий шаг**: Season 4 — Crypto & Algorithms ждёт вас!

### 📚 Дополнительные материалы v2.0

- 📄 [CHANGELOG.md](./CHANGELOG.md) — детальная история изменений v2.0
- 📊 [IMPROVEMENTS_SUMMARY.md](./IMPROVEMENTS_SUMMARY.md) — анализ улучшений и метрики
- 🎭 **Метафоры в каждом эпизоде**: "Город Интернет", "Телефонный звонок", "Подслушивающее устройство", "Разорванное письмо"
- 📝 **60 контрольных вопросов**: полностью интегрированы в сюжет, не абстрактные!

---

## 🔗 Навигация между сезонами

- [← Season 2: Memory & Pointers](../season-2-memory-and-pointers/README.md)
- [→ Season 4: Crypto & Algorithms](../season-4-crypto-and-algorithms/README.md)
- [📋 Общий план курса](../CURRICULUM.md)
- [🏠 Главная страница](../README.md)

---

> *"In the network, everyone leaves traces. You've learned to read them all."* — V.

---

## ⚠️ Важные замечания

### Безопасность и легальность

**Все техники в этом сезоне предназначены ТОЛЬКО для:**
- Образовательных целей
- Тестирования собственных систем
- Авторизованного пентеста

**НИКОГДА не используйте:**
- На чужих сетях без разрешения
- Для незаконного перехвата трафика
- В нарушение законов о кибербезопасности

**Вы несёте полную ответственность** за использование полученных знаний.

### Системные требования

- **Root/sudo доступ** для raw sockets
- **Разрешение firewall** для серверных сокетов
- **Виртуальная сеть** для безопасного тестирования (рекомендуется)

### Рекомендуемая среда

Для практики создайте изолированную сеть:
```bash
# Вариант 1: Локальный loopback (127.0.0.1)
# Безопасно, но ограниченно

# Вариант 2: Docker network
docker network create moonlight-net

# Вариант 3: VirtualBox/VMware с NAT network
# Полный контроль, изолировано от основной сети
```

---

> *"In the network, everyone leaves traces. Learn to read them."* — V.
