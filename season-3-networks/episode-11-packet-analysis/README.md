# Episode 11: "Packet Analysis" ๐ก

> *"Every packet tells a story. Learn to listen."*

---

## ๐ฌ BRIEFING

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะฆะะฏ: Safe House (ะฝะตะธะทะฒะตััะฝัะน ะฐะดัะตั), ะะพัะบะฒะฐ        โ
โ  ะะะะะฏ:   18:20, ััะตะดะฐ, 1 ะพะบััะฑัั                       โ
โ  ะกะขะะขะฃะก:  ๐ด COUNTER-SURVEILLANCE DETECTED!              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะฟะพะดะบะปััะตะฝะธั ะบ ัะตัะฒะตัั V., ะฒั ะฟะพะปััะธะปะธ ะดะพัััะฟ.  
ะะพะพัะดะธะฝะฐัั ัะปะตะดัััะตะณะพ ัะทะปะฐ: `10.0.0.1:4433`.

**ะะพ ะฒ 18:17 ัะธััะฐัะธั ะบะฐัะดะธะฝะฐะปัะฝะพ ะผะตะฝัะตััั.**

ะะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะพั V.:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FROM: V. (ENCRYPTED CHANNEL)               โ
โ  TIME: 18:17:42 UTC                         โ
โ  PRIORITY: ๐ด CRITICAL                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                             โ
โ  ะะพะดะบะปััะธัััั โ ััะพ ะฟะพะปะดะตะปะฐ.                โ
โ  ะะฐััะพััะฐั ะธะณัะฐ โ ะะะะะฅะะะข.                 โ
โ                                             โ
โ  ะะฐ ัะฒะพัะผ ะธะฝัะตััะตะนัะต ะธะดัั ััะฐัะธะบ.           โ
โ  ะะณะตะฝัั Z. ะพะฑะผะตะฝะธะฒะฐัััั ะดะฐะฝะฝัะผะธ ะฝะฐ 9999.    โ
โ                                             โ
โ  โ๏ธ ะะะะกะะะกะขะฌ:                              โ
โ  ะะฝะธ ะขะะะ ะธัะฟะพะปัะทััั packet sniffing!       โ
โ  ะะพะทะผะพะถะฝะพ, ะพะฝะธ ัะถะต ะทะฝะฐัั ะพ safe house.      โ
โ                                             โ
โ  ะะะะะงะ:                                    โ
โ  ะะตัะตัะฒะฐัะธัั ะธั TCP ะฟะฐะบะตัั ะฝะฐ ะฟะพััั 9999    โ
โ  ะะทะฒะปะตัั payload ะธะท ะบะฐะถะดะพะณะพ ะฟะฐะบะตัะฐ          โ
โ  ะะฐะนัะธ: ััะพ ะพะฝะธ ะทะฝะฐัั ะพ ัะตะฑะต?               โ
โ                                             โ
โ  ะัะฟะพะปัะทัะน RAW SOCKETS.                     โ
โ  ะญัะพ ะตะดะธะฝััะฒะตะฝะฝัะน ัะฟะพัะพะฑ ะฒะธะดะตัั ะะกะ.        โ
โ                                             โ
โ  โ๏ธ ะขัะตะฑััััั ROOT ะฟัะฐะฒะฐ (sudo)             โ
โ                                             โ
โ  ะัะดั ะพััะพัะพะถะตะฝ. ะัะพัะฝะธะบ ะผะพะถะตั ััะฐัั        โ
โ  ะดะพะฑััะตะน.                                   โ
โ                                             โ
โ  โ V.                                       โ
โ                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### โฑ๏ธ ะัะตะผะตะฝะฝะฐั ะปะธะฝะธั ัะพะฑััะธะน

```
18:17 โ ๐ง ะกะพะพะฑัะตะฝะธะต ะพั V.: ะฟะตัะตัะฒะฐัะธัั ััะฐัะธะบ ะฐะณะตะฝัะพะฒ Z.
        ะะพัั 9999 โ ะธั ะบะฐะฝะฐะป ะบะพะผะผัะฝะธะบะฐัะธะธ
        
18:20 โ ๐ ะะฐะฟััะบ netstat ะดะปั ะฐะฝะฐะปะธะทะฐ
        $ netstat -an | grep 9999
        
        Active Internet connections:
        TCP  127.0.0.1:9999   127.0.0.1:54321  ESTABLISHED
        TCP  127.0.0.1:54321  127.0.0.1:9999   ESTABLISHED
        
        ๐ก ะะฑะฝะฐััะถะตะฝะพ: ะะบัะธะฒะฝะฐั ะบะพะผะผัะฝะธะบะฐัะธั!
        
18:25 โ ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ packet sniffer
        ะะทััะตะฝะธะต raw sockets, struct iphdr, struct tcphdr
        
19:45 โ ๐ ะะตัะฒัะน ะทะฐะฟััะบ packet_sniffer
        $ sudo ./packet_sniffer
        
        Listening on all interfaces...
        Filtering for port 9999
        
19:46 โ ๐ก ะะะะะซะ ะะะะะข ะฟะตัะตัะฒะฐัะตะฝ!
        From: 127.0.0.1:54321 โ 127.0.0.1:9999
        Protocol: TCP, Flags: PSH ACK
        Payload (48 bytes):
        "Target confirmed. Location: Safe house."
        
19:47 โ ๐จ ะะขะะะะ ะะะะะข โ ะจะะะะะฃะฎะฉะะ ะกะะะะะะะะะ!
        From: 127.0.0.1:9999 โ 127.0.0.1:54321
        Payload (64 bytes):
        "Coordinates: 55.7520ยฐN 37.6175ยฐE"
        "Status: Under surveillance"
        "Agent count: 1"
        
        ๐ ะญะขะ ะะะะะะะะะขะซ ะะะจะะะ SAFE HOUSE!!!
        
19:48 โ โ๏ธ ะขะะะขะะ ะะะะะข:
        "Order: Continue monitoring. Do not engage."
        "Report to HQ every 30 minutes."
        
20:00 โ ๐ก ะะกะะะะะะะ:
        ะัะตัะปะตะดะพะฒะฐัะตะปะธ Z. ะขะะะ ะธัะฟะพะปัะทััั packet sniffing!
        ะะฝะธ ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจ ััะฐัะธะบ!
        "ะัะพัะฝะธะบ" ััะฐะป "ะดะพะฑััะตะน"...
        
20:15 โ ๐ SMS ะพั V.:
        "ะะฝะธ ัะปะตะดัั ะทะฐ ัะพะฑะพะน.
         ะะพ ัะตะฟะตัั ะขะซ ัะปะตะดะธัั ะทะฐ ะฝะธะผะธ.
         ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ.
         ะัะพะดะพะปะถะฐะน ะฟะตัะตัะฒะฐั."

20:18 โ ๐ฌ ะกะะะะฉะะะะ ะะข "ะะะะะะะะ" (ะะะกะะะซะขะะ!)
        
        FROM: UNKNOWN
        
        "Morpheus.
         
         ะะพัะฐ ัะฐัะบัััั ะบะฐััั.
         ะฏ โ ะะปะตะบั ะกะพะบะพะปะพะฒ. ะะพะทัะฒะฝะพะน: 'ะัะธะทัะฐะบ'.
         
         Ex-FSB, ะฃะฟัะฐะฒะปะตะฝะธะต 'K' (ะบะพะฝัััะฐะทะฒะตะดะบะฐ).
         5 ะปะตั ะธัะบะฐะป ะะธะบัะพัะฐ.
         6 ะผะตัััะตะฒ ะฝะฐะทะฐะด ะฟะพะฝัะป: ะะธะบัะพั โ ะฝะฐ ะฟัะฐะฒะธะปัะฝะพะน ััะพัะพะฝะต.
         
         ะกะตะนัะฐั ั ั ะฒะฐะผะธ.
         
         โ๏ธ ะะะะขะะงะะ:
         ะะณะตะฝั ะััะปะพะฒ (ะผะพะน ะฑัะฒัะธะน ะฝะฐัะฐะปัะฝะธะบ) ะธะดัั ะฟะพ ัะฒะพะตะผั ัะปะตะดั.
         ะฃ ะฝะตะณะพ ะดะพัััะฟ ะบ ัะธััะตะผะฐะผ ะคะกะ.
         ะะฝ ะทะฝะฐะตั ะพ safe house.
         
         ะะพะพัะดะธะฝะฐัั 55.7520ยฐN 37.6175ยฐE ะฒ ะธั ะปะพะณะฐั.
         ะญัะพ ะขะะะ ะฐะดัะตั!
         
         Packet sniffing โ ะพัะปะธัะฝะพ, ะฝะพ ะะะะะกะขะะขะะงะะ.
         ะััะปะพะฒ ะธัะฟะพะปัะทัะตั:
         - ะคะธะทะธัะตัะบะพะต ะฝะฐะฑะปัะดะตะฝะธะต (2 ะฐะณะตะฝัะฐ ั ะฟะพะดัะตะทะดะฐ)
         - ะกะพัะพะฒัะต ะฒััะบะธ (ััะธะฐะฝะณัะปััะธั)
         - ะกะะะ (ัะธััะตะผะฐ ะพะฟะตัะฐัะธะฒะฝะพ-ัะพะทััะบะฝัั ะผะตัะพะฟัะธััะธะน)
         
         ะขั ะฒ ะพะฟะฐัะฝะพััะธ.
         ะะพะฒะตัััั ะผะฝะต.
         
         โ ะะปะตะบั ะกะพะบะพะปะพะฒ ('ะัะธะทัะฐะบ')"
        
        ๐ ะะะงะะะกะขะฌ ะะะกะะะซะขะ!
        
20:20 โ ๐ฑ ะะะะะะ: ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ

        "Morpheus! ะญัะพ ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ, forensics specialist.
         ะะฐะฑะพัะฐะปะฐ ั ะะธะบัะพัะพะผ 2 ะณะพะดะฐ ะฝะฐะทะฐะด.
         
         'ะัะธะทัะฐะบ' ะฟะตัะตะดะฐะป ะผะฝะต ัะฒะพะน ะฝะพะผะตั.
         ะฃ ะผะตะฝั ะธะฝัะพัะผะฐัะธั.
         
         ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ ะะะงะะ ะบะพะพัะดะธะฝะธััะตั ะพะฟะตัะฐัะธั.
         ะะธะดะตะปะฐ ะตะณะพ ะธะผั ะฒ ะฟะตัะตัะฒะฐัะตะฝะฝัั ะปะพะณะฐั ะคะกะ.
         
         ะะฒะฐ ะฐะณะตะฝัะฐ ะฝะฐะฑะปัะดะฐัั ะทะฐ safe house:
         - ะงััะฝัะน ัะตะดะฐะฝ Lada Granta (ะฝะพะผะตั X999XX77)
         - ะะพะทะธัะธั: 100ะผ ะพั ะฟะพะดัะตะทะดะฐ
         - ะกะผะตะฝะฐ ะบะฐะถะดัะต 6 ัะฐัะพะฒ
         
         ะะ ะะซะฅะะะ ะธะท safe house!
         ะะฝะธ ะถะดัั ัะฒะพะธั ะดะตะนััะฒะธะน.
         
         ะัะฟะพะปัะทัะน VPN. ะขะพั. ะัั ััะพ ะตััั.
         ะะต ะทะฒะพะฝะธ ะฟะพ ะพะฑััะฝะพะน ัะฒัะทะธ.
         
         ะัะดั ะพััะพัะพะถะตะฝ.
         
         โ ะะฝะฝะฐ"
         
        [ะะฒะพะฝะพะบ ะทะฐะฒะตัััะฝ]
        
        โ ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ ะฟัะตะดัะฟัะตะดะธะปะฐ ะพะฑ ะพะฟะฐัะฝะพััะธ
         
20:30 โ ๐ฏ ะงะะขะะะะขะซะ ะะะะะข โ ะะะฎะงะะะะฏ ะะะคะะะะะฆะะฏ:
        
        ะั ะฟะตัะตัะฒะฐััะฒะฐะตัะต TCP ะฟะฐะบะตั ะฝะฐ ะฟะพััั 9999:
        
        From: 127.0.0.1:9999 โ 127.0.0.1:54321
        Payload (128 bytes):
        
        "Agent Krylov: En route to target location.
         ETA: 22:00 (2 hours).
         
         Orders: Surveillance only. Do not engage.
         Target is valuable. Capture alive.
         
         Safe house coordinates: 55.7520ยฐN 37.6175ยฐE
         
         Next node: 10.0.0.1:4433
         Protocol: Encrypted TCP
         Objective: Intercept encrypted stream"
        
        ๐ ะะะซะะะ ะะะะข ะกะฎะะ! ETA 22:00!
        โ ะะพะปััะตะฝั ะบะพะพัะดะธะฝะฐัั ัะปะตะดัััะตะณะพ ัะทะปะฐ
        
20:45 โ ๐ SMS ะพั ะะปะตะบัะฐ ะกะพะบะพะปะพะฒะฐ ('ะัะธะทัะฐะบ'):
        "ะะธะดะตะป ะฟะตัะตัะฒะฐั.
         ะััะปะพะฒ ะฑัะดะตั ัะตัะตะท 75 ะผะธะฝัั.
         
         ะะฐะฒะตััะฐะน ะผะธััะธั.
         ะะพัะพะฒััั ะบ ัะฒะฐะบัะฐัะธะธ.
         
         ะะธะบัะพั ะพัะณะฐะฝะธะทัะตั ะฒัััะตัั.
         ะะพะฒะตัััั ะฟัะพัะตััั.
         
         โ A.S."
        
22:35 โ โ ะะตัะตัะฒะฐั ะทะฐะฒะตัััะฝ
        ะะทะฒะปะตัะตะฝะพ: 127 ะฟะฐะบะตัะพะฒ
        ะกะบัััะพะต ัะพะพะฑัะตะฝะธะต ะดะตะบะพะดะธัะพะฒะฐะฝะพ
        Episode 11 Complete
```

ะั ะพัะบััะฒะฐะตัะต ะบะพะฝัะพะปั ะธ ะทะฐะฟััะบะฐะตัะต `netstat`:

```
Active Internet connections
Proto Local Address    Foreign Address    State
TCP   127.0.0.1:9999   127.0.0.1:54321   ESTABLISHED
TCP   127.0.0.1:54321  127.0.0.1:9999    ESTABLISHED
```

**ะงัะพ ะฒั ะฟะพะฝะธะผะฐะตัะต:**
- ะะฐ ะฟะพััั **9999** ะธะดัั ะฐะบัะธะฒะฝะฐั ะบะพะผะผัะฝะธะบะฐัะธั **ะฐะณะตะฝัะพะฒ Z.**
- ะะฑััะฝัะต ัะพะบะตัั ะฒะธะดัั ัะพะปัะบะพ ะดะฐะฝะฝัะต **ะฒะฐัะตะณะพ ะฟัะธะปะพะถะตะฝะธั**
- **Raw sockets** ะฒะธะดัั **ะฒัะต ะฟะฐะบะตัั** ะฝะฐ ัะตัะตะฒะพะผ ะธะฝัะตััะตะนัะต
- ะัะถะฝะพ **ะฟะฐััะธัั IP ะธ TCP ะทะฐะณะพะปะพะฒะบะธ** ะฒัััะฝัั
- ะะทะฒะปะตัั **payload** (ะดะฐะฝะฝัะต ะฟะพัะปะต ะทะฐะณะพะปะพะฒะบะพะฒ)
- **ะะะะขะะงะะ**: ะ ะฟะฐะบะตัะฐั ะผะพะณัั ะฑััั ะดะฐะฝะฝัะต ะพ ะะะจะะ ะผะตััะพะฟะพะปะพะถะตะฝะธะธ!
- **"ะัะพัะฝะธะบ ััะฐะฝะพะฒะธััั ะดะพะฑััะตะน"** โ ะฒะทะฐะธะผะฝะฐั ัะปะตะถะบะฐ
- **ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ ะตะดะตั ะบ safe house!** ETA 22:00 (2 ัะฐัะฐ!)

**ะะตััะพะฝะฐะถะธ Episode 11:**
- ๐ป **"ะัะธะทัะฐะบ" = ะะปะตะบั ะกะพะบะพะปะพะฒ** (20:18) โ ะะะกะะะซะขะะ! Ex-FSB, ะฃะฟัะฐะฒะปะตะฝะธะต 'K', ัะตะฟะตัั ั ะฒะฐะผะธ
- ๐ **ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ** (20:20) โ forensics specialist, ะฟัะตะดัะฟัะตะดะธะปะฐ ะพะฑ ะฐะณะตะฝัะฐั (Lada Granta X999XX77)
- โ๏ธ **ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ** (20:30) โ ะฒะฐั ะฑัะฒัะธะน ะฝะฐัะฐะปัะฝะธะบ ะะปะตะบัะฐ, ะตะดะตั ะบ safe house (ETA 22:00!)
- ๐ **Viktor** (20:15) โ ะบะพะพัะดะธะฝะธััะตั ะธะฝัะพัะผะฐัะธะพะฝะฝัั ะฒะพะนะฝั
- โ๏ธ **ะะณะตะฝัั Z.** (18:20+) โ ัะธะทะธัะตัะบะพะต ะฝะฐะฑะปัะดะตะฝะธะต + packet sniffing

ะญัะพ ะผะพะผะตะฝั ะธััะธะฝั. ะัะตะผั ััะฐัั **packet sniffer** ะธ ัะทะฝะฐัั, ััะพ ะฒัะฐะณะธ ะทะฝะฐัั ะพ ะฒะฐั.

### ๐ฏ ะะะะะงะ

ะกะพะทะดะฐัั **`packet_sniffer`** โ ะฐะฝะฐะปะธะทะฐัะพั ัะตัะตะฒัั ะฟะฐะบะตัะพะฒ:
1. โ ะกะพะทะดะฐัั raw socket (SOCK_RAW)
2. โ ะะตัะตัะฒะฐััะฒะฐัั ะฒัะต TCP ะฟะฐะบะตัั
3. โ ะะฐััะธัั IP ะทะฐะณะพะปะพะฒะพะบ (source, dest, protocol)
4. โ ะะฐััะธัั TCP ะทะฐะณะพะปะพะฒะพะบ (ports, flags, seq)
5. โ ะะทะฒะปะตะบะฐัั payload (ะดะฐะฝะฝัะต)
6. โ ะคะธะปัััะพะฒะฐัั ะฟะพ ะฟะพััั 9999
7. โ Hex dump ะฟะฐะบะตัะพะฒ
8. โ ะะฐะนัะธ ัะบัััะพะต ัะพะพะฑัะตะฝะธะต

**ะกะปะพะถะฝะพััั:** ๐ด Hard  
**ะะพะฒัะต ะฝะฐะฒัะบะธ:** Raw sockets, packet sniffing, header parsing, hex dump

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [!] ะะะะะะะะ:                               โ
โ  Raw sockets โ ะผะพัะฝัะน ะธะฝััััะผะตะฝั.            โ
โ  ะั ะฒะธะดะธัะต ะะกะ. ะัะฟะพะปัะทัะนัะต ะพัะฒะตัััะฒะตะฝะฝะพ.    โ
โ  ะขัะตะฑัะตััั sudo (root ะฟัะฐะฒะฐ).                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ THEORY BLOCK 1: Packet Sniffing โ ะบะพะฝัะตะฟัะธั ะฟะพะดัะปััะธะฒะฐะฝะธั

> *"Raw socket โ ััะพ ะฟะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ. ะขั ัะปััะธัั ะะกะ."* โ V.

### ๐ญ ะะะขะะคะะะ: Packet Sniffing = ะะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ

**ะัะตะดััะฐะฒััะต:**  
ะั ัะธะดะธัะต ะฒ ะบะฐัะต. ะะพะบััะณ ะผะฝะพะณะพ ะปัะดะตะน, ะธ ะฒัะต ะพะฝะธ ัะฐะทะณะพะฒะฐัะธะฒะฐัั. ะะฑััะฝะพ ะฒั ัะปััะธัะต ัะพะปัะบะพ ัะฒะพะตะณะพ ัะพะฑะตัะตะดะฝะธะบะฐ, ะฐ ะพััะฐะปัะฝัะต ะณะพะปะพัะฐ โ ัะพะฝะพะฒัะน ััะผ.

**ะะ:** ะัะปะธ ั ะฒะฐั ะตััั **ะฝะฐะฟัะฐะฒะปะตะฝะฝัะน ะผะธะบัะพัะพะฝ** (ะฟะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ), ะฒั ะผะพะถะตัะต:
- ะะฐัััะพะธัััั ะฝะฐ **ะปัะฑะพะน ัะฐะทะณะพะฒะพั** ะฒ ะบะฐัะต
- ะกะปััะฐัั **ะฒะตัั ัะฐะทะณะพะฒะพั** ัะตะปะธะบะพะผ
- **ะะฐะฟะธััะฒะฐัั** ะบะฐะถะดะพะต ัะปะพะฒะพ
- **ะคะธะปัััะพะฒะฐัั** ะฟะพ ะณะพะปะพัั (ะฝะฐะฟัะธะผะตั, ัะพะปัะบะพ ะผัะถัะบะธะต ะณะพะปะพัะฐ)

**ะ ัะตัะธ:**

```
ะะฑััะฝัะน TCP ัะพะบะตั (socket()):
โโ ะั โ ะกะพะฑะตัะตะดะฝะธะบ (203.0.113.42:31337)
โโ ะกะปััะธัะต ะขะะะฌะะ ะฒะฐั ัะฐะทะณะพะฒะพั
   โ ะััะณะธะต ัะฐะทะณะพะฒะพัั ะฝะต ะฒะธะดะฝั

Raw socket (SOCK_RAW):
โโ ะั โ ะะกะฏ ะกะะขะฌ
โโ ะกะปััะธัะต ะะกะ ัะฐะทะณะพะฒะพัั ะฝะฐ ะฒะฐัะตะผ ัะตะณะผะตะฝัะต ัะตัะธ!
โ   โโ 192.168.1.50 โ 8.8.8.8:53 (DNS ะทะฐะฟัะพั)
โ   โโ 192.168.1.100 โ 203.0.113.42:31337 (ะฒะฐั ััะฐัะธะบ)
โ   โโ 192.168.1.150 โ 10.0.0.1:9999 (ะฐะณะตะฝัั Z.!)
โโ โ ะะพะถะตัะต ัะธะปัััะพะฒะฐัั ะฟะพ IP/ะฟะพััั/ะฟัะพัะพะบะพะปั
```

**ASCII-ะดะธะฐะณัะฐะผะผะฐ:**

```
         ะะะคะ (ะกะะขะฌ 192.168.1.0/24)
         
  [ะกัะพะป 1]        [ะกัะพะป 2]        [ะกัะพะป 3]
  A โ B           C โ D           ะะซ โ V.
  (DNS)           (HTTPS)         (TCP:31337)
    โ               โ               โ
    โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
                    โ
            [ะะพะดัะปััะธะฒะฐััะตะต
             ััััะพะนััะฒะพ]
             (Raw socket)
                    โ
           โโโโโโโโโโดโโโโโโโโโ
           โ  ะั ัะปััะธัะต:    โ
           โ  โ A โ B        โ
           โ  โ C โ D        โ
           โ  โ ะะซ โ V.      โ
           โ  โ ะะณะตะฝัั Z.!   โ
           โโโโโโโโโโโโโโโโโโโ

ะะ! ะะณะตะฝัั Z. ัะพะถะต ะธะผะตัั ะฟะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ:
  โ ะะฝะธ ัะปััะฐั ะะะจ ััะฐัะธะบ!
  โ ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ (ะฒะทะฐะธะผะฝัะน sniffing)
```

**ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั:**

1. **Ethernet = ัะธัะพะบะพะฒะตัะฐัะตะปัะฝะฐั ััะตะดะฐ:**
   - ะัะต ะฟะฐะบะตัั ะฟะตัะตะดะฐัััั **ะฒัะตะผ** ััััะพะนััะฒะฐะผ ะฝะฐ ัะตะณะผะตะฝัะต
   - ะะฑััะฝะพ: ะฒะฐัะฐ ัะตัะตะฒะฐั ะบะฐััะฐ **ะพัะฑัะฐััะฒะฐะตั** ััะถะธะต ะฟะฐะบะตัั
   - Raw socket: ะฒั ะณะพะฒะพัะธัะต ะบะฐััะต **ะะ ะพัะฑัะฐััะฒะฐัั** โ ะฒะธะดะธัะต ะฒัั!

2. **Promiscuous mode:**
   ```c
   // ะะฑััะฝัะน ัะตะถะธะผ:
   NIC: "ะญัะพั ะฟะฐะบะตั ะฝะต ะดะปั ะผะตะฝั (dest MAC != ะผะพะน MAC) โ ะพัะฑัะพัะธัั"
   
   // Promiscuous mode:
   NIC: "ะญัะพั ะฟะฐะบะตั ะฝะต ะดะปั ะผะตะฝั โ ะะกะ ะะะะะ ะะะะะฏะขะฌ ะธ ะพัะดะฐัั ะฟัะธะปะพะถะตะฝะธั!"
   ```

3. **ะคะธะปัััะฐัะธั:**
   ```c
   // ะัะต ะฟะฐะบะตัั โ ัะธะปััั โ ัะพะปัะบะพ ะธะฝัะตัะตััััะธะต
   if (tcp->dest == htons(9999)) {  // ะะณะตะฝัั Z. ะฝะฐ ะฟะพััั 9999
       printf("ะะตัะตัะฒะฐัะตะฝะพ ัะพะพะฑัะตะฝะธะต ะฐะณะตะฝัะพะฒ!\n");
   }
   ```

**ะ ะผะธััะธะธ:**
```
18:20 โ ะะณะตะฝัั Z. ะพะฑัะฐัััั ะฝะฐ ะฟะพััั 9999
        ะะซ (192.168.1.100) ะทะฐะฟััะบะฐะตัะต packet_sniffer
        
19:15 โ ะะตัะตัะฒะฐัะตะฝ ะฟะฐะบะตั:
        Source: 192.168.1.150 (ะฐะณะตะฝั Z.)
        Dest:   10.0.0.1:9999
        Payload: "Coordinates: 55.7520ยฐN 37.6175ยฐE"
        
19:16 โ ะะซ ะฃะะะะะ ะบะพะพัะดะธะฝะฐัั safe house!
        ะะณะตะฝัั Z. ะทะฝะฐัั, ะณะดะต ะฒั!
        
ะะ:
        ะะณะตะฝัั Z. ะขะะะะ ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจ ััะฐัะธะบ!
        โ ะะทะฐะธะผะฝัะน sniffing
        โ ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ
```

**ะะฐัะธัะฐ ะพั sniffing:**
- โ **ะจะธััะพะฒะฐะฝะธะต** (TLS/SSL) โ ะดะฐะถะต ะตัะปะธ ะฟะตัะตัะฒะฐััั, ะฝะต ัะฐััะธััััั
- โ **VPN** โ ััะฝะฝะตะปั, ัะบััะฒะฐะตั ัะพะดะตัะถะธะผะพะต
- โ **ะคะธะทะธัะตัะบะฐั ะธะทะพะปััะธั** โ ะพัะดะตะปัะฝัะน ัะตะณะผะตะฝั ัะตัะธ
- โ **Plaintext** โ ะปัะฑะพะน ะผะพะถะตั ะฟัะพัะธัะฐัั (ะบะฐะบ ะฒ ะผะธััะธะธ!)

**ะะปััะตะฒัะต ะบะพะฝัะตะฟัะธะธ THEORY BLOCK 1:**
- Raw socket = ะฟะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ
- Promiscuous mode = ะฟัะธะฝะธะผะฐัั ะะกะ ะฟะฐะบะตัั
- Ethernet = ัะธัะพะบะพะฒะตัะฐัะตะปัะฝะฐั ััะตะดะฐ
- ะะทะฐะธะผะฝัะน sniffing = ะธะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ

---

## ๐ค ะะะะขะะะะฌะะซะ ะะะะะะกะซ (ะะปะพะบ 1)

ะัะพะฒะตัััะต ะฟะพะฝะธะผะฐะฝะธะต ะบะพะฝัะตะฟัะธะธ packet sniffing:

**1. ะะพัะตะผั ะฐะณะตะฝัั Z. ะฒ 19:47 ัะผะพะณะปะธ ัะทะฝะฐัั ะบะพะพัะดะธะฝะฐัั ะฒะฐัะตะณะพ safe house (55.7520ยฐN 37.6175ยฐE)?**

<details>
<summary>ะัะฒะตั</summary>

**ะะะ ะขะะะ ะธัะฟะพะปัะทััั packet sniffing!**

**ะะทะฐะธะผะฝะฐั ัะปะตะถะบะฐ:**
```
19:46 โ ะะซ ะฟะตัะตัะฒะฐััะฒะฐะตัะต ะะฅ ะฟะฐะบะตั:
        "Target confirmed. Location: Safe house."
        
19:47 โ ะะะ ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจ ะฟะฐะบะตั:
        (ะะพะทะผะพะถะฝะพ, ะฒั ัะฐะฝะตะต ะพัะฟัะฐะฒะปัะปะธ ะบะพะพัะดะธะฝะฐัั V.!)
        "Coordinates: 55.7520ยฐN 37.6175ยฐE"
        
ะะตะทัะปััะฐั:
โโ ะะซ ะทะฝะฐะตัะต: ะพะฝะธ ะทะฝะฐัั ะพ safe house
โโ ะะะ ะทะฝะฐัั: ัะพัะฝัะต ะบะพะพัะดะธะฝะฐัั!
โโ> ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ (ะบัะพ ะบะพะณะพ ะฟะตัะตะธะณัะฐะตั?)
```

**ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั:**
- Ethernet = ัะธัะพะบะพะฒะตัะฐัะตะปัะฝะฐั ััะตะดะฐ
- ะัะต ะฟะฐะบะตัั ะฒะธะดะฝั ะะกะะ ะฝะฐ ัะตะณะผะตะฝัะต ัะตัะธ
- Raw socket + promiscuous mode = ะฒะธะดะธัั ะะกะ
- ะะตะทะฐัะธััะพะฒะฐะฝะฝัะน ััะฐัะธะบ = ะพัะบัััะฐั ะบะฝะธะณะฐ!

**ะ ะผะธััะธะธ:**
- ะะณะตะฝัั Z. ะฝะฐ ัะพะผ ะถะต ัะตะณะผะตะฝัะต ัะตัะธ (ะธะปะธ ะธะผะตัั ะดะพัััะฟ ะบ ะผะฐัััััะธะทะฐัะพัั)
- ะะฝะธ ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจ ััะฐัะธะบ
- ะะพะพัะดะธะฝะฐัั ะพัะฟัะฐะฒะปะตะฝั ะฒ plaintext
- ะะตะทัะปััะฐั: safe house ัะฐัะบััั!

**ะฃัะพะบ:** "ะัะพัะฝะธะบ ะผะพะถะตั ััะฐัั ะดะพะฑััะตะน". Packet sniffing โ ะดะฒัััะพัะพะฝะฝะธะน ะธะฝััััะผะตะฝั!
</details>

**2. ะ ััะผ ัะฐะทะฝะธัะฐ ะผะตะถะดั ะพะฑััะฝัะผ ัะพะบะตัะพะผ (`socket(AF_INET, SOCK_STREAM, 0)`) ะธ raw ัะพะบะตัะพะผ ะดะปั ะฟะตัะตัะฒะฐัะฐ?**

<details>
<summary>ะัะฒะตั</summary>

**ะะฑััะฝัะน ัะพะบะตั = ัะตะปะตัะพะฝะฝะฐั ัััะฑะบะฐ. Raw ัะพะบะตั = ะฟะพะดัะปััะธะฒะฐััะตะต ััััะพะนััะฒะพ!**

**ะะฑััะฝัะน TCP ัะพะบะตั:**
```c
int sockfd = socket(AF_INET, SOCK_STREAM, 0);
connect(sockfd, ...);
send(sockfd, "Hello", 5, 0);

ะงะขะ ะะะะะขะ:
โโ ะขะพะปัะบะพ ะะะจะ ัะพะตะดะธะฝะตะฝะธะต: YOU โ SERVER
โโ ะขะพะปัะบะพ ะดะฐะฝะฝัะต ะฟัะธะปะพะถะตะฝะธั: "Hello"
โโ ะะฐะณะพะปะพะฒะบะธ ะพะฑัะฐะฑะพัะฐะฝั ัะดัะพะผ (ะฒั ะธั ะะ ะฒะธะดะธัะต!)
```

**Raw ัะพะบะตั:**
```c
int raw_fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
// Promiscuous mode (ะพะฟัะธะพะฝะฐะปัะฝะพ):
struct ifreq ifr;
ioctl(raw_fd, SIOCGIFFLAGS, &ifr);
ifr.ifr_flags |= IFF_PROMISC;
ioctl(raw_fd, SIOCSIFFLAGS, &ifr);

ะงะขะ ะะะะะขะ:
โโ ะะกะ ะฟะฐะบะตัั ะฝะฐ ะธะฝัะตััะตะนัะต!
โโ ะะบะปััะฐั ััะถะธะต: A โ B, C โ D, ะะณะตะฝัั Z. โ HQ
โโ ะะะะะซะ ะฟะฐะบะตัั ั ะทะฐะณะพะปะพะฒะบะฐะผะธ:
โ   โโ Ethernet header
โ   โโ IP header (source, dest, protocol)
โ   โโ TCP header (ports, seq, flags)
โ   โโ Payload (ะดะฐะฝะฝัะต ะฟัะธะปะพะถะตะฝะธั)
โโ ะัะถะฝะพ ะฟะฐััะธัั ัะฐะผะพะผั!
```

**ะะฝะฐะปะพะณะธั:**
```
ะะฑััะฝัะน ัะพะบะตั:
  ะั ัะฐะทะณะพะฒะฐัะธะฒะฐะตัะต ะฟะพ ัะตะปะตัะพะฝั ั V.
  ะกะปััะธัะต ะขะะะฌะะ ะตะณะพ ะณะพะปะพั.
  
Raw ัะพะบะตั:
  ะั ะฒ ะบะฐัะต ั ะฝะฐะฟัะฐะฒะปะตะฝะฝัะผ ะผะธะบัะพัะพะฝะพะผ.
  ะกะปััะธัะต ะะกะ ัะฐะทะณะพะฒะพัั ะฒะพะบััะณ!
  ะะพะถะตัะต ะฝะฐัััะพะธัััั ะฝะฐ ะปัะฑะพะน ััะพะป (ัะธะปััั ะฟะพ IP/ะฟะพััั).
```

**ะ ะผะธััะธะธ (19:46):**
```c
// ะะฑััะฝัะน ัะพะบะตั ะะ ะกะะะะะขะะะข:
socket(AF_INET, SOCK_STREAM, 0);  // ะะธะดะธั ัะพะปัะบะพ ะฒะฐัะต ัะพะตะดะธะฝะตะฝะธะต

// Raw ัะพะบะตั ะะฃะะะ:
socket(AF_INET, SOCK_RAW, IPPROTO_TCP);  // ะะธะดะธั ะฐะณะตะฝัะพะฒ Z. ะฝะฐ ะฟะพััั 9999!
```

**ะฃัะพะบ:** Raw socket = ะฟะพะปะฝัะน ะบะพะฝััะพะปั + ะฟะพะปะฝะฐั ะพัะฒะตัััะฒะตะฝะฝะพััั. ะก ะฑะพะปััะพะน ัะธะปะพะน ะฟัะธัะพะดะธั ะฑะพะปััะฐั ะพัะฒะตัััะฒะตะฝะฝะพััั!
</details>

**3. ะงัะพ ะพะทะฝะฐัะฐะตั "promiscuous mode" ะธ ะฟะพัะตะผั ะพะฝ ะบัะธัะธัะตะฝ ะดะปั ะฟะตัะตัะฒะฐัะฐ ะฟะฐะบะตัะพะฒ ะฐะณะตะฝัะพะฒ Z.?**

<details>
<summary>ะัะฒะตั</summary>

**Promiscuous mode = "ะฟัะธะฝััั ะะกะ, ะดะฐะถะต ะฝะต ะดะปั ะผะตะฝั"!**

**ะะพัะผะฐะปัะฝัะน ัะตะถะธะผ ัะตัะตะฒะพะน ะบะฐััั:**
```
ะะฐะบะตั ะฟัะธะปะตัะฐะตั:
  Dest MAC: AA:BB:CC:DD:EE:FF
  
ะกะตัะตะฒะฐั ะบะฐััะฐ ะฟัะพะฒะตััะตั:
  ะะพะน MAC: 11:22:33:44:55:66
  
  AA:BB:CC != 11:22:33 โ ะะ ะะะ ะะะะะข!
  
  โ ะะขะะะะกะะขะฌ (drop)
  โ ะัะธะปะพะถะตะฝะธะต ะะ ะะะะฃะงะะข
```

**Promiscuous mode:**
```
ะะฐะบะตั ะฟัะธะปะตัะฐะตั:
  Dest MAC: AA:BB:CC:DD:EE:FF
  
ะกะตัะตะฒะฐั ะบะฐััะฐ:
  Promiscuous mode = ON
  
  โ ะะะะะฏะขะฌ ะะฎะะะ ะะะะะข!
  โ ะะฐะถะต ะตัะปะธ dest MAC != ะผะพะน
  โ ะัะดะฐัั raw socket ะฟัะธะปะพะถะตะฝะธั
  
ะัะธะปะพะถะตะฝะธะต ะฟะพะปััะฐะตั:
  โโ ะกะฒะพะธ ะฟะฐะบะตัั (11:22:33...)
  โโ ะะฐะบะตัั ะฐะณะตะฝัะพะฒ Z. (AA:BB:CC...)
  โโ Broadcast ะฟะฐะบะตัั (FF:FF:FF...)
  โโ ะะกะ!
```

**ะะพะด ะฐะบัะธะฒะฐัะธะธ:**
```c
#include <sys/ioctl.h>
#include <net/if.h>

struct ifreq ifr;
strncpy(ifr.ifr_name, "eth0", IFNAMSIZ);

// ะะพะปััะธัั ัะตะบััะธะต ัะปะฐะณะธ:
ioctl(sockfd, SIOCGIFFLAGS, &ifr);

// ะะพะฑะฐะฒะธัั IFF_PROMISC:
ifr.ifr_flags |= IFF_PROMISC;

// ะัะธะผะตะฝะธัั:
ioctl(sockfd, SIOCSIFFLAGS, &ifr);

printf("Promiscuous mode ะฐะบัะธะฒะธัะพะฒะฐะฝ!\n");
```

**ะ ะผะธััะธะธ (19:46):**
```
ะะณะตะฝัั Z. ะพะฑัะฐัััั:
  127.0.0.1:54321 โ 127.0.0.1:9999
  Dest MAC: (ะธั ัะตัะตะฒะฐั ะบะฐััะฐ)
  
ะะตะท promiscuous mode:
  ะะฐัะฐ ะบะฐััะฐ: "ะะต ะผะพะน MAC โ drop"
  โ ะะซ ะะ ะะะะะขะ ะธั ััะฐัะธะบ!
  
ะก promiscuous mode:
  ะะฐัะฐ ะบะฐััะฐ: "ะัะธะฝััั ะะฎะะะ ะฟะฐะบะตั!"
  โ ะะซ ะะะะะขะ: "Target confirmed. Location: Safe house."
  โ ะะะะะฅะะะข ะฃะกะะะจะะ!
```

**ะะพัะตะผั ะบัะธัะธัะตะฝ:**
- ะะตะท promiscuous mode = ะฒะธะดะธัะต ะขะะะฌะะ ัะฒะพะน ััะฐัะธะบ
- ะก promiscuous mode = ะฒะธะดะธัะต ะะกะ (ะฒะบะปััะฐั ะฐะณะตะฝัะพะฒ Z.!)
- ะญัะพ ัะฐะทะฝะธัะฐ ะผะตะถะดั ัะปะตะฟะพัะพะน ะธ ะฒัะตะฒะธะดะตะฝะธะตะผ

**ะขัะตะฑะพะฒะฐะฝะธะต:** `sudo` (root rights) โ ัะพะปัะบะพ root ะผะพะถะตั ะฒะบะปััะธัั promiscuous mode!

**ะฃัะพะบ:** Promiscuous mode = ะบะปัั ะบ ะฟะพะดัะปััะธะฒะฐะฝะธั. ะะตะท ะฝะตะณะพ packet sniffer ะฑะตัะฟะพะปะตะทะตะฝ!
</details>

---

## ๐ฌ ะกะฎะะะขะะะฏ ะกะฆะะะ: ะะฐัะบัััะธะต "ะัะธะทัะฐะบะฐ" โ ะะปะตะบั ะกะพะบะพะปะพะฒ!

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะฏ:   20:18, ััะตะดะฐ, 1 ะพะบััะฑัั                       โ
โ  ะกะะะซะขะะ: ๐ป "ะะะะะะะ" ะะะกะะะซะะะะข ะะะงะะะกะขะฌ!             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะั ะฟัะพะดะพะปะถะฐะตัะต ะฟะตัะตัะฒะฐััะฒะฐัั ะฟะฐะบะตัั ะฐะณะตะฝัะพะฒ Z. ะะฐั packet sniffer ัะฐะฑะพัะฐะตั. ะะพ ะฒะดััะณ ัะตะปะตัะพะฝ ะฒะธะฑัะธััะตั.

**ะกะพะพะฑัะตะฝะธะต ะพั UNKNOWN:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FROM: UNKNOWN                               โ
โ  TIME: 20:18:47                              โ
โ  ENCRYPTION: PGP (Viktor's key)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                              โ
โ  Morpheus.                                   โ
โ                                              โ
โ  ะฏ ะฝะฐะฑะปัะดะฐั ะทะฐ ัะพะฑะพะน ั Episode 02.           โ
โ  ะะพะผะพะณะฐะป. ะัะตะดัะฟัะตะถะดะฐะป. ะะพ ะฐะฝะพะฝะธะผะฝะพ.         โ
โ                                              โ
โ  ะะพัะฐ ัะฐัะบัััั ะบะฐััั.                        โ
โ                                              โ
โ  ๐ ะะะฏ ะะะงะะะกะขะฌ:                            โ
โ                                              โ
โ  ะะผั: ะะปะตะบั ะกะพะบะพะปะพะฒ                          โ
โ  ะะพะทัะฒะฝะพะน: "ะัะธะทัะฐะบ" (Ghost)                 โ
โ  ะะพะทัะฐัั: 38 ะปะตั                             โ
โ                                              โ
โ  ะัะฒัะฐั ัะฐะฑะพัะฐ:                              โ
โ  ะคะกะ ะะพััะธะธ, ะฃะฟัะฐะฒะปะตะฝะธะต 'K'                  โ
โ  (ะบะพะฝัััะฐะทะฒะตะดะบะฐ)                             โ
โ  ะะฒะฐะฝะธะต: ะะฐะนะพั (ะฒ ะพัััะฐะฒะบะต)                  โ
โ  ะะฟัั: 12 ะปะตั ะพะฟะตัะฐัะธะฒะฝะพะน ัะฐะฑะพัั             โ
โ                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                              โ
โ  ะะกะขะะะะฏ:                                    โ
โ                                              โ
โ  2019-2024: ะัะบะฐะป ะะธะบัะพัะฐ ะะตััะพะฒะฐ            โ
โ  ะะฐะดะฐะฝะธะต ะคะกะ: ะฝะฐะนัะธ, ะทะฐัะฒะฐัะธัั, ะดะพะฟัะพัะธัั    โ
โ                                              โ
โ  5 ะปะตั ะฟะพะณะพะฝะธ. ะะตัััะบะธ ะพะฟะตัะฐัะธะน.             โ
โ  ะะธะบัะพั ะฒัะตะณะดะฐ ะฑัะป ะฝะฐ ัะฐะณ ะฒะฟะตัะตะดะธ.           โ
โ                                              โ
โ  ะะฐัั 2024 (6 ะผะตัััะตะฒ ะฝะฐะทะฐะด):                โ
โ  ะฏ ะฝะฐััะป ะตะณะพ ะดะฐะฝะฝัะต. ะัะพัะธัะฐะป ะตะณะพ ะดะตะปะฐ.      โ
โ  ะะพะฝัะป: ะพะฝ ะฝะต ะฒัะฐะณ. ะะฝ ัะฐะทะพะฑะปะฐัะฐะตั ะบะพัััะฟัะธั.โ
โ                                              โ
โ  ะะะจะะะะ:                                    โ
โ  ะะตัะตััะป ะฝะฐ ะตะณะพ ััะพัะพะฝั.                     โ
โ  ะััะตะป ะธะท ะคะกะ (ัะพัะผะฐะปัะฝะพ: "ะพัััะฐะฒะบะฐ").       โ
โ  ะขะตะฟะตัั ั โ ัะฐััั ะบะพะผะฐะฝะดั ะะธะบัะพัะฐ.           โ
โ                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                              โ
โ  โ๏ธ ะะะะขะะงะะ:                                โ
โ                                              โ
โ  ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ โ ะะะ ะะซะะจะะ ะะะงะะะฌะะะ.    โ
โ  ะฃะฟัะฐะฒะปะตะฝะธะต 'K', ะพัะดะตะป ะบะพะฝัััะฐะทะฒะตะดะบะธ.        โ
โ  ะะฝ ะะ ะะะะกะขะะ ะผะพั ะฟัะตะดะฐัะตะปัััะฒะพ.            โ
โ                                              โ
โ  ะกะตะนัะฐั ะพะฝ ะธะดัั ะฟะพ ัะฒะพะตะผั ัะปะตะดั.             โ
โ  ะฃ ะฝะตะณะพ ะดะพัััะฟ ะบ:                            โ
โ  - ะกะะะ (ัะธััะตะผะฐ ะฟัะพัะปััะบะธ)                  โ
โ  - GPS-ััะตะบะธะฝะณ ะผะพะฑะธะปัะฝัั                     โ
โ  - ะะฐะทะฐ ะดะฐะฝะฝัั ะคะกะ                           โ
โ  - ะคะธะทะธัะตัะบะพะต ะฝะฐะฑะปัะดะตะฝะธะต                     โ
โ                                              โ
โ  ะะพะพัะดะธะฝะฐัั 55.7520ยฐN 37.6175ยฐE ะฒ ะปะพะณะฐั.     โ
โ  ะญัะพ ะขะะะ safe house!                        โ
โ                                              โ
โ  ะะณะตะฝัั ะฝะฐะฑะปัะดะฐัั:                           โ
โ  - ะงััะฝัะน ัะตะดะฐะฝ Lada Granta                  โ
โ  - ะะพะผะตั: X999XX77                           โ
โ  - ะะพะทะธัะธั: 100ะผ ะพั ะฟะพะดัะตะทะดะฐ                 โ
โ  - ะกะผะตะฝะฐ: ะบะฐะถะดัะต 6 ัะฐัะพะฒ                     โ
โ                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                              โ
โ  ะงะขะ ะะะะะขะฌ:                                 โ
โ                                              โ
โ  1. ะัะพะดะพะปะถะฐะน packet sniffing                โ
โ     ะฃะทะฝะฐะน: ััะพ ะตัั ะพะฝะธ ะทะฝะฐัั?                โ
โ                                              โ
โ  2. ะะ ะะะะะะฃะ                               โ
โ     ะฏ ะพััะปะตะถะธะฒะฐั ะฟะตัะตะดะฒะธะถะตะฝะธะต ะััะปะพะฒะฐ        โ
โ     ะัะตะดัะฟัะตะถั ะตัะปะธ ะพะฝ ะฑะปะธะทะบะพ                โ
โ                                              โ
โ  3. ะะะะะะฌะกะฏ ะะะ                             โ
โ     ะฏ ั ะฒะฐะผะธ. ะะธะบัะพั ะทะฝะฐะตั.                  โ
โ     ะะพะผะฐะฝะดะฐ ัะตะฑั ะฟัะธะบัะพะตั.                   โ
โ                                              โ
โ  ะขั ะฒ ะพะฟะฐัะฝะพััะธ. ะะพ ัั ะฝะต ะพะดะธะฝ.              โ
โ                                              โ
โ  โ ะะปะตะบั ะกะพะบะพะปะพะฒ                             โ
โ    ะะพะทัะฒะฝะพะน: "ะัะธะทัะฐะบ" (Ghost)               โ
โ                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**๐ ะะะงะะะกะขะฌ ะะะกะะะซะขะ!**

ะั ัะผะพััะธัะต ะฝะฐ ัะบัะฐะฝ. ะััะฐัะบะธ ะฟะพ ะบะพะถะต.

**"ะัะธะทัะฐะบ"** โ ะฝะต ะฟัะพััะพ ะฟะพะผะพัะฝะธะบ. ะญัะพ **ะฑัะฒัะธะน ะฐะณะตะฝั ะคะกะ**, ะบะพัะพััะน ัะธัะบะพะฒะฐะป ะฒัะตะผ, ะฟะตัะตะนะดั ะฝะฐ ััะพัะพะฝั ะะธะบัะพัะฐ!

**ะงัะพ ะฒั ัะทะฝะฐะปะธ:**
- โ ะะปะตะบั ะกะพะบะพะปะพะฒ, 38 ะปะตั, ex-FSB ะฃะฟัะฐะฒะปะตะฝะธะต 'K' (ะบะพะฝัััะฐะทะฒะตะดะบะฐ)
- โ 5 ะปะตั ะธัะบะฐะป ะะธะบัะพัะฐ โ 6 ะผะตัััะตะฒ ะฝะฐะทะฐะด ะฟะตัะตััะป ะฝะฐ ะตะณะพ ััะพัะพะฝั
- โ ะััะปะพะฒ = ะตะณะพ ะะซะะจะะ ะะะงะะะฌะะะ (ะปะธัะฝะฐั ะดัะฐะผะฐ!)
- โ ะะพะพัะดะธะฝะฐัั safe house (55.7520ยฐN 37.6175ยฐE) ะฒ ะปะพะณะฐั ะคะกะ
- โ ะะณะตะฝัั ะฝะฐะฑะปัะดะฐัั: Lada Granta X999XX77, 100ะผ ะพั ะฟะพะดัะตะทะดะฐ

ะั ะฒะพะทะฒัะฐัะฐะตัะตัั ะบ packet sniffer. ะขะตะฟะตัั ะผะธััะธั ะตัั ัะตัััะทะฝะตะต. ะััะปะพะฒ ะทะฝะฐะตั, ะณะดะต ะฒั. ะัะตะผั ะฝะฐ ะธััะพะดะต.

---

## ๐ THEORY BLOCK 2: IP ะธ TCP ะทะฐะณะพะปะพะฒะบะธ โ ััััะบัััะฐ ะฟะฐะบะตัะฐ

**ะะฑััะฝัะน ัะพะบะตั** (SOCK_STREAM):
- ะะธะดะธั ัะพะปัะบะพ ะดะฐะฝะฝัะต **ะฒะฐัะตะณะพ** ะฟัะธะปะพะถะตะฝะธั
- ะฏะดัะพ ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะณะพะปะพะฒะบะธ
- ะฃะดะพะฑะฝะพ, ะฝะพ ะพะณัะฐะฝะธัะตะฝะฝะพ

**Raw ัะพะบะตั** (SOCK_RAW):
- ะะธะดะธั **ะฒัะต ะฟะฐะบะตัั** ะฝะฐ ะธะฝัะตััะตะนัะต
- ะะพะปััะฐะตัะต **ะฟะพะปะฝัะน** ะฟะฐะบะตั (ั ะทะฐะณะพะปะพะฒะบะฐะผะธ!)
- ะะพะปะฝัะน ะบะพะฝััะพะปั, ะฝะพ ะฝัะถะฝะพ ะฟะฐััะธัั ัะฐะผะพะผั

```c
#include <sys/socket.h>
#include <netinet/ip.h>
#include <netinet/tcp.h>
#include <arpa/inet.h>

// ะกะพะทะดะฐะฝะธะต raw socket ะดะปั TCP ะฟะฐะบะตัะพะฒ
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

// โ๏ธ ะขัะตะฑัะตั root!
if (sockfd < 0) {
    perror("socket (are you root?)");
    exit(1);
}
```

**ะะพัะตะผั ะฝัะถะตะฝ root?** ะะพัะพะผั ััะพ raw socket ะผะพะถะตั ะฟะตัะตัะฒะฐััะฒะฐัั **ะปัะฑะพะน** ััะฐัะธะบ (ัะณัะพะทะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ).

---

### 2. ะกัััะบัััะฐ IP ะทะฐะณะพะปะพะฒะบะฐ (IPv4)

```c
#include <netinet/ip.h>

struct iphdr {
    uint8_t  ihl:4;        // IP Header Length (ะฒ 32-bit ัะปะพะฒะฐั)
    uint8_t  version:4;    // ะะตััะธั (4 ะดะปั IPv4)
    uint8_t  tos;          // Type of Service
    uint16_t tot_len;      // Total Length (ะฒะตัั ะฟะฐะบะตั)
    uint16_t id;           // Identification
    uint16_t frag_off;     // Fragment Offset
    uint8_t  ttl;          // Time To Live
    uint8_t  protocol;     // Protocol (6=TCP, 17=UDP, 1=ICMP)
    uint16_t check;        // Header Checksum
    uint32_t saddr;        // Source Address
    uint32_t daddr;        // Destination Address
};
```

**ะะฐะถะฝะพ**:
- `ihl` โ ะดะปะธะฝะฐ ะทะฐะณะพะปะพะฒะบะฐ ะฒ **32-bit ัะปะพะฒะฐั** (ะพะฑััะฝะพ 5 = 20 ะฑะฐะนั)
- `protocol` โ ัะธะฟ ะฟัะพัะพะบะพะปะฐ (TCP=6, UDP=17)
- `saddr/daddr` โ ะฒ **network byte order** (ะฝัะถะตะฝ `ntohl()`)

---

### 3. ะกัััะบัััะฐ TCP ะทะฐะณะพะปะพะฒะบะฐ

```c
#include <netinet/tcp.h>

struct tcphdr {
    uint16_t source;       // Source port
    uint16_t dest;         // Destination port
    uint32_t seq;          // Sequence number
    uint32_t ack_seq;      // Acknowledgment number
    uint16_t res1:4;       // Reserved
    uint16_t doff:4;       // Data offset (ะดะปะธะฝะฐ ะทะฐะณะพะปะพะฒะบะฐ)
    uint16_t fin:1, syn:1, rst:1, psh:1,
             ack:1, urg:1, ece:1, cwr:1;  // Flags
    uint16_t window;       // Window size
    uint16_t check;        // Checksum
    uint16_t urg_ptr;      // Urgent pointer
};
```

**TCP Flags**:
- `SYN` โ ะฝะฐัะฐะปะพ ัะพะตะดะธะฝะตะฝะธั
- `ACK` โ ะฟะพะดัะฒะตัะถะดะตะฝะธะต
- `FIN` โ ะทะฐะบัััะธะต ัะพะตะดะธะฝะตะฝะธั
- `RST` โ ัะฑัะพั ัะพะตะดะธะฝะตะฝะธั
- `PSH` โ ะฝะตะผะตะดะปะตะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั

---

### 4. ะะฐััะธะฝะณ ะฟะฐะบะตัะฐ

```c
unsigned char buffer[65536];  // ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั IP ะฟะฐะบะตัะฐ

// ะะพะปััะธัั ะฟะฐะบะตั
ssize_t size = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// 1. ะะฐััะธัั IP ะทะฐะณะพะปะพะฒะพะบ
struct iphdr *ip = (struct iphdr*)buffer;

// ะะฐะทะผะตั IP ะทะฐะณะพะปะพะฒะบะฐ (ะฒ ะฑะฐะนัะฐั)
int ip_header_len = ip->ihl * 4;

// 2. ะะฐััะธัั TCP ะทะฐะณะพะปะพะฒะพะบ (ะฟะพัะปะต IP)
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

// ะะฐะทะผะตั TCP ะทะฐะณะพะปะพะฒะบะฐ (ะฒ ะฑะฐะนัะฐั)
int tcp_header_len = tcp->doff * 4;

// 3. Payload (ะดะฐะฝะฝัะต ะฟะพัะปะต ะทะฐะณะพะปะพะฒะบะพะฒ)
unsigned char *payload = buffer + ip_header_len + tcp_header_len;
int payload_len = ntohs(ip->tot_len) - ip_header_len - tcp_header_len;

printf("Payload: ");
for (int i = 0; i < payload_len; i++) {
    printf("%02X ", payload[i]);
}
printf("\n");
```

**ะะปััะตะฒัะต ััััะบัััั THEORY BLOCK 2:**
- `struct iphdr` โ IP ะทะฐะณะพะปะพะฒะพะบ (source, dest, protocol)
- `struct tcphdr` โ TCP ะทะฐะณะพะปะพะฒะพะบ (ports, seq, flags)
- `ip->ihl * 4` โ ัะฐะทะผะตั IP ะทะฐะณะพะปะพะฒะบะฐ ะฒ ะฑะฐะนัะฐั
- `tcp->doff * 4` โ ัะฐะทะผะตั TCP ะทะฐะณะพะปะพะฒะบะฐ ะฒ ะฑะฐะนัะฐั
- `payload` = ะฟะพัะปะต ะฒัะตั ะทะฐะณะพะปะพะฒะบะพะฒ

---

## ๐ค ะะะะขะะะะฌะะซะ ะะะะะะกะซ (ะะปะพะบ 2)

ะัะพะฒะตัััะต ะฟะพะฝะธะผะฐะฝะธะต ััััะบัััั ะฟะฐะบะตัะพะฒ:

**4. ะ ะฟะตัะตัะฒะฐัะตะฝะฝะพะผ ะฟะฐะบะตัะต ะฐะณะตะฝัะพะฒ Z. (19:46) `ip->protocol = 6`. ะงัะพ ััะพ ะพะทะฝะฐัะฐะตั ะธ ะฟะพัะตะผั ะฒะฐะถะฝะพ ะดะปั ัะธะปัััะฐัะธะธ?**

<details>
<summary>ะัะฒะตั</summary>

**`protocol = 6` ะพะทะฝะฐัะฐะตั TCP!**

**IP protocol numbers:**
```c
#include <netinet/in.h>

#define IPPROTO_ICMP   1   // ICMP (ping)
#define IPPROTO_TCP    6   // TCP (ะฝะฐะดัะถะฝัะน)
#define IPPROTO_UDP   17   // UDP (ะฝะตะฝะฐะดัะถะฝัะน)
```

**ะคะธะปัััะฐัะธั ะฒ ะบะพะดะต:**
```c
struct iphdr *ip = (struct iphdr*)buffer;

if (ip->protocol == IPPROTO_TCP) {  // 6
    printf("TCP ะฟะฐะบะตั ะพะฑะฝะฐััะถะตะฝ!\n");
    // ะะฐััะธัั TCP ะทะฐะณะพะปะพะฒะพะบ
    struct tcphdr *tcp = (struct tcphdr*)(buffer + ip->ihl * 4);
} else if (ip->protocol == IPPROTO_UDP) {  // 17
    printf("UDP ะฟะฐะบะตั\n");
} else if (ip->protocol == IPPROTO_ICMP) {  // 1
    printf("ICMP (ping) ะฟะฐะบะตั\n");
}
```

**ะ ะผะธััะธะธ (19:46):**
```
ะะตัะตัะฒะฐัะตะฝ ะฟะฐะบะตั:
  ip->protocol = 6  โ TCP!
  tcp->dest = 9999  โ ะะพัั ะฐะณะตะฝัะพะฒ Z.
  
ะคะธะปััั:
  if (ip->protocol == 6 && ntohs(tcp->dest) == 9999) {
      // ะญะขะ ะฟะฐะบะตั ะฐะณะตะฝัะพะฒ Z.!
      printf("Target confirmed. Location: Safe house.\n");
  }
```

**ะะพัะตะผั ะฒะฐะถะฝะพ:**
- Raw socket ะฟะพะปััะฐะตั ะะกะ ะฟัะพัะพะบะพะปั (TCP, UDP, ICMP, ...)
- ะะตะท ัะธะปัััะฐัะธะธ: ัััััะธ ะฟะฐะบะตัะพะฒ ะฒ ัะตะบัะฝะดั!
- ะัะถะตะฝ ัะธะปััั: `protocol == 6` โ ัะพะปัะบะพ TCP
- ะะฐัะตะผ: `port == 9999` โ ัะพะปัะบะพ ะฐะณะตะฝัั Z.

**ะฃัะพะบ:** `ip->protocol` โ ะฟะตัะฒัะน ััะพะฒะตะฝั ัะธะปัััะฐัะธะธ. ะะตะท ะฝะตะณะพ ััะพะฝะตัะต ะฒ ััะฐัะธะบะต!
</details>

**5. ะะพัะตะผั `ip->saddr` ะฝะตะปัะทั ะธัะฟะพะปัะทะพะฒะฐัั ะฝะฐะฟััะผัั ะดะปั `printf()`? ะะฐะบ ะฟัะฐะฒะธะปัะฝะพ ะบะพะฝะฒะตััะธัะพะฒะฐัั ะตะณะพ ะฒ ัััะพะบั?**

<details>
<summary>ะัะฒะตั</summary>

**`ip->saddr` โ ััะพ 32-bit ัะธัะปะพ ะฒ network byte order, ะะ ัััะพะบะฐ!**

**ะัะพะฑะปะตะผะฐ:**
```c
struct iphdr *ip = (struct iphdr*)buffer;

printf("Source IP: %d\n", ip->saddr);  // โ ะะะะะะะะะฌะะ!
// ะัะฒะพะด: Source IP: 701476106
// ะญัะพ ะะ ัะธัะฐะตะผัะน IP!
```

**ะัะฐะฒะธะปัะฝะฐั ะบะพะฝะฒะตััะฐัะธั:**
```c
#include <arpa/inet.h>

// ะจะฐะณ 1: ะกะพะทะดะฐัั struct in_addr
struct in_addr src_addr;
src_addr.s_addr = ip->saddr;  // Network byte order

// ะจะฐะณ 2: ะะพะฝะฒะตััะธัะพะฒะฐัั ะฒ ัััะพะบั
char src_ip[INET_ADDRSTRLEN];  // ะััะตั ะดะปั "xxx.xxx.xxx.xxx"
inet_ntop(AF_INET, &src_addr, src_ip, INET_ADDRSTRLEN);

// ะจะฐะณ 3: ะัะฒะตััะธ
printf("Source IP: %s\n", src_ip);  // โ "127.0.0.1"
```

**ะะปััะตัะฝะฐัะธะฒะฐ (deprecated):**
```c
// ะกัะฐััะน ัะฟะพัะพะฑ (ะะ ัะตะบะพะผะตะฝะดัะตััั):
char *src_ip = inet_ntoa(src_addr);  // โ ะัะฟะพะปัะทัะตั ััะฐัะธัะตัะบะธะน ะฑััะตั!
printf("Source IP: %s\n", src_ip);
// ะัะพะฑะปะตะผะฐ: ัะปะตะดัััะธะน ะฒัะทะพะฒ ะฟะตัะตะทะฐะฟะธัะตั ัะตะทัะปััะฐั!
```

**ะ ะผะธััะธะธ (19:47):**
```c
// ะะตัะตัะฒะฐัะตะฝะฝัะน ะฟะฐะบะตั ะพั ะฐะณะตะฝัะพะฒ Z.:
struct iphdr *ip = (struct iphdr*)buffer;

struct in_addr src, dst;
src.s_addr = ip->saddr;
dst.s_addr = ip->daddr;

char src_ip[INET_ADDRSTRLEN], dst_ip[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &src, src_ip, INET_ADDRSTRLEN);
inet_ntop(AF_INET, &dst, dst_ip, INET_ADDRSTRLEN);

printf("From: %s\n", src_ip);  // "127.0.0.1"
printf("To:   %s\n", dst_ip);  // "127.0.0.1"
```

**ะะพัะตะผั network byte order:**
- IP ะฐะดัะตัะฐ ะฟะตัะตะดะฐัััั ะฒ **big-endian** (network byte order)
- Intel ะฟัะพัะตััะพัั โ **little-endian** (host byte order)
- `inet_ntop()` ะดะตะปะฐะตั ะบะพะฝะฒะตััะฐัะธั ะฐะฒัะพะผะฐัะธัะตัะบะธ!

**ะฃัะพะบ:** ะัะตะณะดะฐ ะธัะฟะพะปัะทัะนัะต `inet_ntop()` ะดะปั IP ะฐะดัะตัะพะฒ. ะญัะพ ะฑะตะทะพะฟะฐัะฝะพ ะธ ะฟัะฐะฒะธะปัะฝะพ!
</details>

**6. ะงัะพ ะดะตะปะฐะตั ะฒััะฐะถะตะฝะธะต `buffer + ip->ihl * 4` ะธ ะฟะพัะตะผั ััะพ ะฝัะถะฝะพ ะดะปั ะดะพัััะฟะฐ ะบ TCP ะทะฐะณะพะปะพะฒะบั?**

<details>
<summary>ะัะฒะตั</summary>

**ะััะธัะปัะตั ะฟะพะทะธัะธั TCP ะทะฐะณะพะปะพะฒะบะฐ ะฟะพัะปะต IP ะทะฐะณะพะปะพะฒะบะฐ!**

**ะกัััะบัััะฐ ะฟะฐะบะตัะฐ:**
```
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
โ IP Header   โ TCP Header  โ Payload      โ
โ (20 bytes)  โ (20 bytes)  โ (variable)   โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
 โ             โ             โ
buffer        buffer+20     buffer+40
```

**ะะพะด:**
```c
unsigned char buffer[65536];
recvfrom(sockfd, buffer, sizeof(buffer), ...);

// buffer ัะบะฐะทัะฒะฐะตั ะฝะฐ ะะะงะะะ ะฟะฐะบะตัะฐ (IP ะทะฐะณะพะปะพะฒะพะบ)
struct iphdr *ip = (struct iphdr*)buffer;

// ะกะบะพะปัะบะพ ะฑะฐะนั ะทะฐะฝะธะผะฐะตั IP ะทะฐะณะพะปะพะฒะพะบ?
int ip_header_len = ip->ihl * 4;
//                         โ    โ
//                   ะฒ 32-bit  ะบะพะฝะฒะตััะฐัะธั
//                   ัะปะพะฒะฐั    ะฒ ะฑะฐะนัั
// ihl = 5 โ 5 * 4 = 20 ะฑะฐะนั (ะพะฑััะฝะพ)

// TCP ะทะฐะณะพะปะพะฒะพะบ ะะะกะะ IP:
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);
//                                    โ
//                          ะัะธัะผะตัะธะบะฐ ัะบะฐะทะฐัะตะปะตะน!
//                          buffer + 20 = ะฐะดัะตั TCP
```

**ะะพัะตะผั `ihl * 4`:**
```c
struct iphdr {
    uint8_t ihl:4;  // IP Header Length ะฒ 32-bit ะกะะะะะฅ
    ...
};

// ihl ะธะทะผะตััะตััั ะฒ ะกะะะะะฅ (4 ะฑะฐะนัะฐ):
ihl = 5  โ  5 ัะปะพะฒ  = 5 * 4 = 20 ะฑะฐะนั (ะผะธะฝะธะผะฐะปัะฝัะน IP ะทะฐะณะพะปะพะฒะพะบ)
ihl = 6  โ  6 ัะปะพะฒ  = 6 * 4 = 24 ะฑะฐะนัะฐ (ั ะพะฟัะธัะผะธ)
ihl = 15 โ 15 ัะปะพะฒ  = 15 * 4 = 60 ะฑะฐะนั (ะผะฐะบัะธะผัะผ)
```

**ะ ะผะธััะธะธ (19:46):**
```c
// ะะตัะตัะฒะฐัะตะฝะฝัะน ะฟะฐะบะตั ะพั ะฐะณะตะฝัะพะฒ Z.:
unsigned char buffer[65536];
recvfrom(raw_fd, buffer, sizeof(buffer), ...);

struct iphdr *ip = (struct iphdr*)buffer;
// ip->ihl = 5 (ััะฐะฝะดะฐััะฝัะน ะทะฐะณะพะปะพะฒะพะบ)

int ip_len = ip->ihl * 4;  // 5 * 4 = 20

struct tcphdr *tcp = (struct tcphdr*)(buffer + 20);
//                                    โ
//                          ะัะพะฟััะบะฐะตะผ IP ะทะฐะณะพะปะพะฒะพะบ
//                          ะขะตะฟะตัั tcp ัะบะฐะทัะฒะฐะตั ะฝะฐ TCP!

printf("Port: %d\n", ntohs(tcp->dest));  // 9999!
```

**ะะตะท ััะพะณะพ:**
```c
// ะะะะะะะะะฌะะ:
struct tcphdr *tcp = (struct tcphdr*)buffer;  // โ
// tcp ัะบะฐะทัะฒะฐะตั ะฝะฐ ะะะงะะะ ะฑััะตัะฐ (IP ะทะฐะณะพะปะพะฒะพะบ!)
// tcp->dest ะฟัะพัะธัะฐะตั ะะฃะกะะ ะธะท IP ะทะฐะณะพะปะพะฒะบะฐ!
```

**ะฃัะพะบ:** `buffer + ip->ihl * 4` = ะฟะตัะตัะพะด ะพั IP ะบ TCP. ะะตะท ััะพะณะพ ะฟะฐััะธะฝะณ ัะปะพะผะฐะตััั!
</details>

---

## ๐ฌ ะกะฎะะะขะะะฏ ะกะฆะะะ: ะะฒะพะฝะพะบ ะะฝะฝั ะะพะฒะฐะปัะฒะพะน โ ะัะตะดัะฟัะตะถะดะตะฝะธะต!

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะฏ:   20:20, ััะตะดะฐ, 1 ะพะบััะฑัั                       โ
โ  ะกะะะซะขะะ: ๐ฑ ะะฒะพะฝะพะบ ะพั ะะฝะฝั ะะพะฒะฐะปัะฒะพะน                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะงะตัะตะท 2 ะผะธะฝััั ะฟะพัะปะต ัะพะพะฑัะตะฝะธั Ghost ัะตะปะตัะพะฝ ัะฝะพะฒะฐ ะทะฒะพะฝะธั.

**ะะพะผะตั ะฝะตะธะทะฒะตััะฝัะน. ะะพ ะฒั ะพัะฒะตัะฐะตัะต.**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะฅะะะฏะฉะะ: +7 916 XXX-XX-XX                  โ
โ  [ะัะธะฝััั ะทะฒะพะฝะพะบ]                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

"Morpheus! ะญัะพ ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ.

ะฏ forensics specialist. ะะฐะฑะพัะฐะปะฐ ั ะะธะบัะพัะพะผ 2 ะณะพะดะฐ ะฝะฐะทะฐะด,
ะบะพะณะดะฐ ะพะฝ ะตัั ะฑัะป ะฒ ะปะตะณะฐะปัะฝะพะผ ะฑะธะทะฝะตัะต.

Ghost โ ะะปะตะบั ะกะพะบะพะปะพะฒ โ ะฟะตัะตะดะฐะป ะผะฝะต ัะฒะพะน ะฝะพะผะตั.
ะกะบะฐะทะฐะป ัั ะฒ ะพะฟะฐัะฝะพััะธ. ะฃ ะผะตะฝั ะธะฝัะพัะผะฐัะธั.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะกะะฃะจะะ ะะะะะะขะะะฌะะ:

ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ ะะะงะะ ะบะพะพัะดะธะฝะธััะตั ะพะฟะตัะฐัะธั.

ะฏ ัะพะปัะบะพ ััะพ ะฒะทะปะพะผะฐะปะฐ ัะตัะฒะตัะฝัะต ะปะพะณะธ ะคะกะ
(ะฝะต ัะฟัะฐัะธะฒะฐะน ะบะฐะบ โ ััะพ ะพะฟะฐัะฝะพ).

ะะธะดะตะปะฐ ะตะณะพ ะธะผั ะฒ ัะฟะธัะบะต ะฐะบัะธะฒะฝัั ะพะฟะตัะฐัะธะน:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะะะะฆะะฏ: "ะะะะคะะ"                         โ
โ ะะฃะะะะะะะขะะะฌ: ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ ะ.ะ.        โ
โ ะฆะะะฌ: ะะฐะดะตัะถะฐะฝะธะต ะฟะพะดะพะทัะตะฒะฐะตะผะพะณะพ            โ
โ ะกะขะะขะฃะก: ะะบัะธะฒะฝะฐ                            โ
โ ะะะะะะะขะะข: ะััะพะบะธะน                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะงะขะ ะฏ ะะะะฎ:

ะะฒะฐ ะฐะณะตะฝัะฐ ะฝะฐะฑะปัะดะฐัั ะทะฐ safe house ะะะฏะะ ะกะะะงะะก:

๐ ะะฒัะพะผะพะฑะธะปั:
   - Lada Granta, ัััะฝะฐั
   - ะะพะผะตั: X999XX77 (ัะตะณะธะพะฝ 77 = ะะพัะบะฒะฐ)
   - ะขะพะฝะธัะพะฒะบะฐ (ะฝะตะทะฐะบะพะฝะฝะฐั, ะฝะพ ะธะผ ะผะพะถะฝะพ)

๐ ะะพะทะธัะธั:
   - 100 ะผะตััะพะฒ ะพั ัะฒะพะตะณะพ ะฟะพะดัะตะทะดะฐ
   - ะฃะณะพะป ัะปะธัั (ัะพัะพัะธะน ะพะฑะทะพั)
   - ะะฐะผะตัะฐ ะฝะฐะฟัะฐะฒะปะตะฝะฐ ะฝะฐ ะฒัะพะด

โฐ ะะตะถะธะผ:
   - ะกะผะตะฝะฐ ะฐะณะตะฝัะพะฒ ะบะฐะถะดัะต 6 ัะฐัะพะฒ
   - ะกะตะนัะฐั: 20:20 โ ัะปะตะดัััะฐั ัะผะตะฝะฐ ะฒ 02:00
   - ะะฝะธ ะะ ะกะะฏะข (ะฟัะพัะตััะธะพะฝะฐะปั!)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ๏ธ ะะะะขะะงะะ:

ะะ ะะซะฅะะะ ะะ SAFE HOUSE!

ะะฝะธ ะถะดัั ัะฒะพะธั ะดะตะนััะฒะธะน.
ะะดะธะฝ ัะฐะณ ะฝะฐ ัะปะธัั = ะทะฐะดะตัะถะฐะฝะธะต.

ะััะปะพะฒ ะฟัะธะบะฐะทะฐะป: "Capture alive" (ะฒะทััั ะถะธะฒัะผ).
ะขั ะธะผ ะฝัะถะตะฝ ะดะปั ะดะพะฟัะพัะฐ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะะ ะะะะะะะะะะฆะะ:

1. ะะะะะะะะะ PACKET SNIFFING
   ะฃะทะฝะฐะน ะฒัั ััะพ ะผะพะถะตัั
   ะะฝัะพัะผะฐัะธั = ัะธะปะฐ

2. ะะกะะะะฌะะฃะ ะะะฉะะขะฃ:
   โ VPN (ะฐะบัะธะฒะธััะน ะกะะะงะะก!)
   โ Tor Browser (ะตัะปะธ ะพัะฟัะฐะฒะปัะตัั ััะพ-ัะพ ะฒ ัะตัั)
   โ ะจะธััะพะฒะฐะฝะธะต (ะฒัะตะณะดะฐ!)
   
   ะะตะทะฐัะธััะพะฒะฐะฝะฝัะน ััะฐัะธะบ = ะพะฝะธ ะฒะธะดัั ะะกะ!

3. ะะ ะะะะะ ะะ ะะะซะงะะะ ะกะะฏะะ
   ะกะะะ (ัะธััะตะผะฐ ะฟัะพัะปััะบะธ) ะฐะบัะธะฒะฝะฐ
   ะัะต ะทะฒะพะฝะบะธ ะทะฐะฟะธััะฒะฐัััั
   
   ะัะฟะพะปัะทัะน ัะพะปัะบะพ:
   - Signal (E2E encryption)
   - Telegram Secret Chat
   - PGP email

4. ะะะขะะะฌะกะฏ ะ ะญะะะะฃะะฆะะ
   ะะธะบัะพั ะพัะณะฐะฝะธะทัะตั ะฒัััะตัั
   ะะพ ะะะะะ โ ั ะฝะต ะทะฝะฐั
   
   ะัะดั ะณะพัะพะฒ ัะนัะธ ะฒ ะปัะฑะพะน ะผะพะผะตะฝั

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Morpheus, ั ะฝะฐ ัะฒะพะตะน ััะพัะพะฝะต.

ะะธะบัะพั ะฟะพะผะพะณ ะผะฝะต 2 ะณะพะดะฐ ะฝะฐะทะฐะด ะบะพะณะดะฐ ะผะตะฝั ะฟััะฐะปะธัั
ะดะธัะบัะตะดะธัะธัะพะฒะฐัั. ะฏ ะตะผั ะพะฑัะทะฐะฝะฐ.

ะขะตะฟะตัั ั ะฟะพะผะพะณะฐั ะะะ.

ะัะดั ะพััะพัะพะถะตะฝ. ะััะปะพะฒ โ ะพะฟะฐัะฝัะน ะฟัะพัะธะฒะฝะธะบ.
ะะพ Ghost (ะะปะตะบั) ะทะฝะฐะตั ะตะณะพ ัะปะฐะฑะพััะธ.
ะะผะตััะต ัะฟัะฐะฒะธะผัั.

ะฃะดะฐัะธ!

โ ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ
  Forensics Specialist"

[ะะฒะพะฝะพะบ ะทะฐะฒะตัััะฝ: 20:22]
```

**ะงัะพ ะฒั ัะทะฝะฐะปะธ ะพั ะะฝะฝั:**
- โ ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ ะะะงะะ ััะบะพะฒะพะดะธั ะพะฟะตัะฐัะธะตะน "ะะะะคะะ" (ะฒั!)
- โ Lada Granta X999XX77 ะฝะฐะฑะปัะดะฐะตั ะทะฐ safe house
- โ 100ะผ ะพั ะฟะพะดัะตะทะดะฐ, ัะผะตะฝะฐ ะบะฐะถะดัะต 6 ัะฐัะพะฒ
- โ "Capture alive" โ ะฒะฐั ะฝัะถะฝั ะถะธะฒัะผ ะดะปั ะดะพะฟัะพัะฐ
- โ ะกะะะ ะฐะบัะธะฒะฝะฐ (ะฒัะต ะทะฒะพะฝะบะธ ะฟัะพัะปััะธะฒะฐัััั!)
- โ ะะฝะฝะฐ ะฝะฐ ะฒะฐัะตะน ััะพัะพะฝะต (ะดะพะปะณ ะฟะตัะตะด ะะธะบัะพัะพะผ)

ะั ัะผะพััะธัะต ะฒ ะพะบะฝะพ. ะะดะต-ัะพ ัะฐะผ, ะฒ 100 ะผะตััะฐั, ัััะฝัะน ัะตะดะฐะฝ. ะะณะตะฝัั ะถะดัั.

ะะพ ัะตะฟะตัั ะฒั ะทะฝะฐะตัะต. ะ ะทะฝะฐะฝะธะต โ ัะธะปะฐ.

ะะพะทะฒัะฐัะฐะตัะตัั ะบ packet sniffer. ะัะถะฝะพ ัะทะฝะฐัั ะฑะพะปััะต.

---

## ๐ THEORY BLOCK 3: Hex Dump ะธ ะธะทะฒะปะตัะตะฝะธะต payload

> *"Payload โ ััะพ ะดััะฐ ะฟะฐะบะตัะฐ. ะะฐะณะพะปะพะฒะบะธ โ ะฟัะพััะพ ัะฟะฐะบะพะฒะบะฐ."* โ Ghost

```c
// IP ะฒ network byte order โ ัััะพะบะฐ
struct in_addr src_addr, dst_addr;
src_addr.s_addr = ip->saddr;
dst_addr.s_addr = ip->daddr;

char src_ip[INET_ADDRSTRLEN], dst_ip[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &src_addr, src_ip, INET_ADDRSTRLEN);
inet_ntop(AF_INET, &dst_addr, dst_ip, INET_ADDRSTRLEN);

printf("From: %s:%d\n", src_ip, ntohs(tcp->source));
printf("To:   %s:%d\n", dst_ip, ntohs(tcp->dest));
```

---

### 6. Hex Dump

```c
void hex_dump(unsigned char *data, int len) {
    printf("Offset   Hex                                            ASCII\n");
    printf("-------- ---------------------------------------------- ----------------\n");
    
    for (int i = 0; i < len; i += 16) {
        printf("%08X ", i);
        
        // Hex
        for (int j = 0; j < 16; j++) {
            if (i + j < len) {
                printf("%02X ", data[i + j]);
            } else {
                printf("   ");
            }
        }
        
        printf(" ");
        
        // ASCII
        for (int j = 0; j < 16 && i + j < len; j++) {
            unsigned char c = data[i + j];
            printf("%c", (c >= 32 && c <= 126) ? c : '.');
        }
        
        printf("\n");
    }
}
```

---

### 7. ะคะธะปัััะฐัะธั ะฟะฐะบะตัะพะฒ

```c
// ะคะธะปัััะพะฒะฐัั ัะพะปัะบะพ TCP (protocol = 6)
if (ip->protocol != IPPROTO_TCP) {
    continue;
}

// ะคะธะปัััะพะฒะฐัั ะฟะพ ะฟะพััั
uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

if (dst_port == 9999 || src_port == 9999) {
    printf("MOONLIGHT traffic detected!\n");
    // ะะฝะฐะปะธะทะธัะพะฒะฐัั payload
}
```

---

### 8. Promiscuous Mode (ะพะฟัะธะพะฝะฐะปัะฝะพ)

**ะะฑััะฝัะน ัะตะถะธะผ**: ัะตัะตะฒะฐั ะบะฐััะฐ ะพัะฑัะฐััะฒะฐะตั ะฟะฐะบะตัั ะฝะต ะดะปั ะฝะฐั.  
**Promiscuous mode**: ะบะฐััะฐ ะฟัะธะฝะธะผะฐะตั **ะฒัะต** ะฟะฐะบะตัั ะฒ ัะตัะธ.

```c
#include <sys/ioctl.h>
#include <net/if.h>

struct ifreq ifr;
strncpy(ifr.ifr_name, "eth0", IFNAMSIZ);

// ะะพะปััะธัั ัะตะบััะธะต ัะปะฐะณะธ
ioctl(sockfd, SIOCGIFFLAGS, &ifr);

// ะฃััะฐะฝะพะฒะธัั promiscuous mode
ifr.ifr_flags |= IFF_PROMISC;
ioctl(sockfd, SIOCSIFFLAGS, &ifr);
```

**ะััะพัะพะถะฝะพ**: ะ promiscuous mode ะฒั ะฒะธะดะธัะต **ะฒะตัั** ััะฐัะธะบ ัะตะณะผะตะฝัะฐ ัะตัะธ!

**ะะปััะตะฒัะต ะบะพะฝัะตะฟัะธะธ THEORY BLOCK 3:**
- `inet_ntop()` โ ะบะพะฝะฒะตััะฐัะธั IP ะฒ ัััะพะบั
- `hex_dump()` โ ะฒัะฒะพะด payload ะฒ HEX + ASCII
- ะคะธะปัััะฐัะธั ะฟะพ ะฟะพััั (9999 ะดะปั ะฐะณะตะฝัะพะฒ Z.)
- Promiscuous mode โ ะฒะธะดะตัั ะะกะ

---

## ๐ค ะะะะขะะะะฌะะซะ ะะะะะะกะซ (ะะปะพะบ 3)

ะัะพะฒะตัััะต ะฟะพะฝะธะผะฐะฝะธะต hex dump ะธ payload:

**7. ะงัะพ ะดะตะปะฐะตั ััะฝะบัะธั `hex_dump()` ะธ ะฟะพัะตะผั ะพะฝะฐ ะฟะพะปะตะทะฝะฐ ะฟัะธ ะฐะฝะฐะปะธะทะต ะฟะฐะบะตัะพะฒ ะฐะณะตะฝัะพะฒ Z.?**

<details>
<summary>ะัะฒะตั</summary>

**Hex dump ะฒัะฒะพะดะธั ะดะฐะฝะฝัะต ะฒ HEX + ASCII ัะพัะผะฐัะต ะดะปั ัะดะพะฑะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ!**

**ะคัะฝะบัะธั:**
```c
void hex_dump(unsigned char *data, int len) {
    printf("Offset   Hex                                            ASCII\n");
    printf("-------- ---------------------------------------------- ----------------\n");
    
    for (int i = 0; i < len; i += 16) {  // ะะพ 16 ะฑะฐะนั ะฝะฐ ัััะพะบั
        printf("%08X ", i);  // Offset
        
        // Hex ัะฐััั:
        for (int j = 0; j < 16; j++) {
            if (i + j < len) {
                printf("%02X ", data[i + j]);  // ะะฐะนั ะฒ HEX
            } else {
                printf("   ");  // ะะฐะฟะพะปะฝะธัะตะปั
            }
        }
        
        printf(" ");
        
        // ASCII ัะฐััั:
        for (int j = 0; j < 16 && i + j < len; j++) {
            unsigned char c = data[i + j];
            printf("%c", (c >= 32 && c <= 126) ? c : '.');  // ะะตัะฐัะฝัะน ัะธะผะฒะพะป ะธะปะธ ัะพัะบะฐ
        }
        
        printf("\n");
    }
}
```

**ะัะธะผะตั ะฒัะฒะพะดะฐ (ะฟะตัะตัะฒะฐัะตะฝะฝัะน ะฟะฐะบะตั ะฒ 19:47):**
```
Offset   Hex                                            ASCII
-------- ---------------------------------------------- ----------------
00000000 43 6F 6F 72 64 69 6E 61 74 65 73 3A 20 35 35  Coordinates: 55
00000010 2E 37 35 32 30 C2 B0 4E 20 33 37 2E 36 31 37  .7520ยฐN 37.617
00000020 35 C2 B0 45                                    5ยฐE
```

**ะะพัะตะผั ะฟะพะปะตะทะฝะพ:**

1. **ะะธะดะฝะพ ััััะต ะดะฐะฝะฝัะต:**
   - HEX: ัะพัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะฑะฐะนัะพะฒ
   - ASCII: ัะธัะฐะตะผัะน ัะตะบัั (ะตัะปะธ ะตััั)

2. **ะะตัะธัะฐะตะผัะต ัะธะผะฒะพะปั ะฒะธะดะฝั:**
   ```
   00000000 54 61 72 67 65 74 00 FF 0A 63 6F 6E 66 69 72  Target...confir
   00000010 6D 65 64                                    med
              โ     โ  โ
           0x00  0xFF 0x0A (ะฝะตัะธัะฐะตะผัะต = ัะพัะบะธ)
   ```

3. **ะะธะฝะฐัะฝัะต ะดะฐะฝะฝัะต:**
   ะัะปะธ payload ะทะฐัะธััะพะฒะฐะฝ โ HEX ะฟะพะบะฐะทัะฒะฐะตั ะฒัั!

4. **ะะตะฑะฐะณะณะธะฝะณ:**
   ะะธะดะฝะพ ะบะฐะถะดัะน ะฑะฐะนั โ ะปะตะณะบะพ ะฝะฐะนัะธ ะฟัะพะฑะปะตะผั

**ะ ะผะธััะธะธ:**
```c
// ะะตัะตัะฒะฐัะธะปะธ ะฟะฐะบะตั ะฐะณะตะฝัะพะฒ Z.:
unsigned char *payload = buffer + ip_len + tcp_len;
int payload_len = ntohs(ip->tot_len) - ip_len - tcp_len;

printf("=== PAYLOAD ===\n");
hex_dump(payload, payload_len);

// ะัะฒะพะด:
// 43 6F 6F 72... = "Coordinates: 55.7520ยฐN 37.6175ยฐE"
// ะะซ ะะะะะขะ ะะะะะะะะะขะซ SAFE HOUSE!
```

**ะฃัะพะบ:** Hex dump = ัะตะฝัะณะตะฝ ะดะฐะฝะฝัั. ะะธะดะฝะพ ะะกะ: ัะตะบัั, ะฑะธะฝะฐัะฝัะต ะดะฐะฝะฝัะต, ะฝะตัะธัะฐะตะผัะต ัะธะผะฒะพะปั!
</details>

**8. ะ payload ะฟะฐะบะตัะฐ (19:48) ะพะฑะฝะฐััะถะตะฝะฐ ัััะพะบะฐ "Order: Continue monitoring". ะะฐะบ ะตั ะธะทะฒะปะตัั ะธะท hex dump?**

<details>
<summary>ะัะฒะตั</summary>

**ะัะพััะพ ะฟัะพัะธัะฐัั ASCII ะบะพะปะพะฝะบั ะธะปะธ ะบะพะฝะฒะตััะธัะพะฒะฐัั HEX ะฒ ัะธะผะฒะพะปั!**

**ะะตัะพะด 1: ะงะธัะฐัั ASCII ะบะพะปะพะฝะบั hex_dump:**
```
Offset   Hex                                            ASCII
-------- ---------------------------------------------- ----------------
00000000 4F 72 64 65 72 3A 20 43 6F 6E 74 69 6E 75 65  Order: Continue
00000010 20 6D 6F 6E 69 74 6F 72 69 6E 67 2E           monitoring.
         โ                                             โ
       HEX                                          ASCII (ัะธัะฐะตะผะพ!)
```

**ะะตัะพะด 2: ะะพะฝะฒะตััะธัะพะฒะฐัั HEX โ ASCII ะฒ ะบะพะดะต:**
```c
unsigned char payload[] = {
    0x4F, 0x72, 0x64, 0x65, 0x72, 0x3A, 0x20, 
    0x43, 0x6F, 0x6E, 0x74, 0x69, 0x6E, 0x75, 0x65, 0x20,
    0x6D, 0x6F, 0x6E, 0x69, 0x74, 0x6F, 0x72, 0x69, 0x6E, 0x67, 0x2E
};

// ะัะฒะตััะธ ะบะฐะบ ัััะพะบั:
for (int i = 0; i < sizeof(payload); i++) {
    printf("%c", payload[i]);
}
printf("\n");

// ะัะฒะพะด: "Order: Continue monitoring."
```

**ะะฒัะพะผะฐัะธัะตัะบะพะต ะธะทะฒะปะตัะตะฝะธะต ASCII:**
```c
void extract_ascii(unsigned char *data, int len) {
    printf("ASCII Text: ");
    for (int i = 0; i < len; i++) {
        unsigned char c = data[i];
        if (c >= 32 && c <= 126) {  // ะะตัะฐัะฝัะน ัะธะผะฒะพะป?
            printf("%c", c);
        } else {
            printf(".");  // ะะตัะธัะฐะตะผัะน โ ัะพัะบะฐ
        }
    }
    printf("\n");
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
extract_ascii(payload, payload_len);
// ะัะฒะพะด: "Order: Continue monitoring."
```

**ะ ะผะธััะธะธ (19:48):**
```c
// ะะตัะตัะฒะฐัะธะปะธ ััะตัะธะน ะฟะฐะบะตั:
struct iphdr *ip = (struct iphdr*)buffer;
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip->ihl * 4);

int ip_len = ip->ihl * 4;
int tcp_len = tcp->doff * 4;
unsigned char *payload = buffer + ip_len + tcp_len;
int payload_len = ntohs(ip->tot_len) - ip_len - tcp_len;

// Hex dump:
hex_dump(payload, payload_len);

// ASCII extraction:
extract_ascii(payload, payload_len);
// ะัะฒะพะด: "Order: Continue monitoring. Do not engage."

// ะะซ ะฃะะะะะ: ะะณะตะฝัั ะะ ะะขะะะฃะฎะข (yet)!
```

**ะฃัะพะบ:** Payload ะฒ plaintext = ัะธัะฐะตััั ะปะตะณะบะพ. ะัะพััะพ ะบะพะฝะฒะตััะธััะน HEX โ ASCII!
</details>

**9. ะะพัะตะผั ะฒ ะฟะตัะตัะฒะฐัะตะฝะฝะพะผ ะฟะฐะบะตัะต (20:30) `tcp->psh` ัะปะฐะณ ัััะฐะฝะพะฒะปะตะฝ ะธ ััะพ ััะพ ะทะฝะฐัะธั ะดะปั ะผะธััะธะธ?**

<details>
<summary>ะัะฒะตั</summary>

**PSH (Push) ัะปะฐะณ = "ะฝะตะผะตะดะปะตะฝะฝะพ ะพัะฟัะฐะฒะธัั ะดะฐะฝะฝัะต ะฟัะธะปะพะถะตะฝะธั"!**

**TCP ัะปะฐะณะธ:**
```c
struct tcphdr {
    ...
    uint16_t fin:1,  // ะะฐะบัััั ัะพะตะดะธะฝะตะฝะธะต
             syn:1,  // ะะฐัะฐัั ัะพะตะดะธะฝะตะฝะธะต
             rst:1,  // ะกะฑัะพัะธัั ัะพะตะดะธะฝะตะฝะธะต
             psh:1,  // PUSH (ะพัะฟัะฐะฒะธัั ัะตะนัะฐั!)
             ack:1,  // ะะพะดัะฒะตัะถะดะตะฝะธะต
             urg:1,  // ะกัะพัะฝัะต ะดะฐะฝะฝัะต
             ece:1, cwr:1;  // ECN ัะปะฐะณะธ
};
```

**ะงัะพ ะดะตะปะฐะตั PSH:**

ะะฑััะฝะพ TCP ะฑััะตัะธะทัะตั ะดะฐะฝะฝัะต:
```
ะัะธะปะพะถะตะฝะธะต ะพัะฟัะฐะฒะปัะตั: "Hello"
TCP: "ะะพะดะพะถะดั ะตัั ะดะฐะฝะฝัั..."
       "...ะผะพะถะตั ะตัั ะพัะฟัะฐะฒัั?"
       "...ัะพะฑะตัั ะฟะพะฑะพะปััะต ะฒ ะพะดะธะฝ ะฟะฐะบะตั"

ะะพัะปะต timeout ะธะปะธ ะทะฐะฟะพะปะฝะตะฝะธั ะฑััะตัะฐ:
TCP: "ะะบ, ะพัะฟัะฐะฒะปัั!"
```

ะก PSH ัะปะฐะณะพะผ:
```
ะัะธะปะพะถะตะฝะธะต: send("Hello", MSG_MORE=OFF)
TCP: "PSH ัััะฐะฝะพะฒะปะตะฝ โ ะะขะะะะะะขะฌ ะกะะะงะะก!"
     โ ะะฐะบะตั ััะพะดะธั ะฝะตะผะตะดะปะตะฝะฝะพ
```

**ะะพะด ะฟัะพะฒะตัะบะธ:**
```c
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_len);

if (tcp->psh) {
    printf("PSH ัะปะฐะณ ัััะฐะฝะพะฒะปะตะฝ โ ะดะฐะฝะฝัะต ะฒะฐะถะฝั!\n");
    // ะญัะพ ะธะฝัะตัะฐะบัะธะฒะฝะพะต ัะพะพะฑัะตะฝะธะต (SSH, chat, ะบะพะผะฐะฝะดะฐ)
}
```

**ะ ะผะธััะธะธ (20:30):**
```
ะะตัะตัะฒะฐัะตะฝ ะฟะฐะบะตั ะพั ะฐะณะตะฝัะพะฒ Z.:
  tcp->psh = 1  โ PSH ัััะฐะฝะพะฒะปะตะฝ!
  Payload: "Agent Krylov: En route to target location. ETA: 22:00"

ะะพัะตะผั PSH:
โโ ะญัะพ ะะะะขะะงะะกะะะ ัะพะพะฑัะตะฝะธะต
โโ ะะณะตะฝัั ะพัะฟัะฐะฒะธะปะธ ะะะะะะะะะะ (ะฝะต ะฑััะตัะธะทะพะฒะฐะปะธ)
โโ PSH = ะฟัะธะพัะธัะตั ะฒััะพะบะธะน!
โโ> ะญัะพ ะฝะต ัััะธะฝะฝะฐั ะบะพะผะผัะฝะธะบะฐัะธั โ ััะพ ะะะะะะ!
```

**PSH vs ะฝะตั PSH:**
```
ะะะ PSH (ัััะธะฝะฝัะน ััะฐัะธะบ):
  tcp->psh = 0
  "Status: All quiet. Monitoring continues."
  โ ะะฑััะฝะฐั ะฟัะพะฒะตัะบะฐ

ะก PSH (ะฒะฐะถะฝะพะต ัะพะพะฑัะตะฝะธะต):
  tcp->psh = 1
  "Agent Krylov: En route! ETA: 22:00"
  โ ะกะะะงะะ!
```

**ะัะธะทะฝะฐะบะธ ะธะฝัะตัะฐะบัะธะฒะฝะพะณะพ ััะฐัะธะบะฐ:**
- SSH ัะตััะธั โ ะบะฐะถะดะฐั ะบะพะผะฐะฝะดะฐ ั PSH
- Chat (Telegram, WhatsApp) โ ะบะฐะถะดะพะต ัะพะพะฑัะตะฝะธะต ั PSH
- HTTP POST โ ะพะฑััะฝะพ ั PSH
- Bulk transfer (ัะบะฐัะธะฒะฐะฝะธะต ัะฐะนะปะฐ) โ ะะะ PSH

**ะ ะฟะฐะบัะตั sniffer:**
```c
if (tcp->psh && ntohs(tcp->dest) == 9999) {
    printf("โ๏ธ ะะะะะะ ะกะะะะฉะะะะ ะะะะะขะะ Z.!\n");
    hex_dump(payload, payload_len);
    // ะญัะพ ะฝะต ัััะธะฝะฐ โ ะฐะฝะฐะปะธะทะธััะน!
}
```

**ะฃัะพะบ:** PSH = ะฟัะธะพัะธัะตั! ะัะปะธ ะฒะธะดะธัะต PSH ะฝะฐ ะฟะพััั 9999 โ ััะพ ะฒะฐะถะฝะพะต ัะพะพะฑัะตะฝะธะต ะฐะณะตะฝัะพะฒ!
</details>

---

## ๐ฌ ะกะฎะะะขะะะฏ ะกะฆะะะ: ะะตัะตัะฒะฐั ะฟะฐะบะตัะฐ ั ะััะปะพะฒัะผ โ ETA 22:00!

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะฏ:   20:30, ััะตะดะฐ, 1 ะพะบััะฑัั                       โ
โ  ะกะะะซะขะะ: ๐ก ะะะะขะะงะะกะะะ ะะะะะข ะะะะะฅะะะงะะ!              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะั ะฟัะพะดะพะปะถะฐะตัะต ะผะพะฝะธัะพัะธะฝะณ. Packet sniffer ัะฐะฑะพัะฐะตั. ะะฝะฝะฐ ะฟัะตะดัะฟัะตะดะธะปะฐ. Ghost ัะฐัะบััั. ะะพ ะฒะฝะตะทะฐะฟะฝะพ โ ะฝะพะฒัะน ะฟะฐะบะตั!

**ะขะตัะผะธะฝะฐะป:**

```bash
$ sudo ./packet_sniffer

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    MOONLIGHT PACKET SNIFFER v1.0
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Listening on all interfaces...
Filtering for port 9999...

[20:30:12] ๐ก TCP PACKET CAPTURED!

From: 127.0.0.1:9999
To:   127.0.0.1:54321
Protocol: TCP
Flags: PSH ACK  โ PSH ัััะฐะฝะพะฒะปะตะฝ! (ะฒะฐะถะฝะพะต ัะพะพะฑัะตะฝะธะต!)
Seq: 42000
Payload size: 128 bytes

=== PAYLOAD HEX DUMP ===

Offset   Hex                                            ASCII
-------- ---------------------------------------------- ----------------
00000000 41 67 65 6E 74 20 4B 72 79 6C 6F 76 3A 20 45  Agent Krylov: E
00000010 6E 20 72 6F 75 74 65 20 74 6F 20 74 61 72 67  n route to targ
00000020 65 74 20 6C 6F 63 61 74 69 6F 6E 2E 0A 45 54  et location..ET
00000030 41 3A 20 32 32 3A 30 30 20 28 32 20 68 6F 75  A: 22:00 (2 hou
00000040 72 73 29 2E 0A 0A 4F 72 64 65 72 73 3A 20 53  rs)...Orders: S
00000050 75 72 76 65 69 6C 6C 61 6E 63 65 20 6F 6E 6C  urveillance onl
00000060 79 2E 20 44 6F 20 6E 6F 74 20 65 6E 67 61 67  y. Do not engag
00000070 65 2E 0A 54 61 72 67 65 74 20 69 73 20 76 61  e..Target is va
00000080 6C 75 61 62 6C 65 2E 20 43 61 70 74 75 72 65  luable. Capture
00000090 20 61 6C 69 76 65 2E                           alive.

=== ASCII TEXT ===

Agent Krylov: En route to target location.
ETA: 22:00 (2 hours).

Orders: Surveillance only. Do not engage.
Target is valuable. Capture alive.

Safe house coordinates: 55.7520ยฐN 37.6175ยฐE

Next node: 10.0.0.1:4433
Protocol: Encrypted TCP
Objective: Intercept encrypted stream

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**๐ ะจะะ! ะะะะะะะะะ ะะะซะะะ ะะะะข ะ ะะะ!**

**ะั ัะผะพััะธัะต ะฝะฐ ัะบัะฐะฝ. ะฅะพะปะพะด ะฒะฝัััะธ.**

```
Agent Krylov: En route to target location.
ETA: 22:00 (2 hours).
```

**ะกะตะนัะฐั 20:30. ะงะตัะตะท 90 ะผะธะฝัั ะััะปะพะฒ ะฑัะดะตั ะะะะกะฌ!**

ะขะตะปะตัะพะฝ ะฒะธะฑัะธััะตั โ SMS ะพั Ghost (ะะปะตะบัะฐ ะกะพะบะพะปะพะฒะฐ):

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FROM: Ghost (ะะปะตะบั ะกะพะบะพะปะพะฒ)                 โ
โ  TIME: 20:32                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                              โ
โ  ะะธะดะตะป ะฟะตัะตัะฒะฐั.                             โ
โ  ะััะปะพะฒ ะฑัะดะตั ัะตัะตะท 75 ะผะธะฝัั.                โ
โ                                              โ
โ  ะฏ ะะะะฎ ะะะ ะขะะะขะะะฃ:                         โ
โ                                              โ
โ  ะะฝ ะฟัะธะตะดะตั ั 3-4 ะฐะณะตะฝัะฐะผะธ.                  โ
โ  ะะปะพะบะธััะตั ะฒัะต ะฒััะพะดั.                       โ
โ  ะะพััะตะฑัะตั ะดะพะฑัะพะฒะพะปัะฝะพะน ัะดะฐัะธ.               โ
โ                                              โ
โ  ะัะปะธ ะพัะบะฐะถะตัััั:                            โ
โ  - ะจัััะผ (ัะฟะตัะฝะฐะท)                           โ
โ  - ะกะปะตะทะพัะพัะธะฒัะน ะณะฐะท                          โ
โ  - ะะฐัะฒะฐั ัะธะปะพะน                              โ
โ                                              โ
โ  ะะ:                                         โ
โ                                              โ
โ  ะฃ ะฝะฐั ะตััั ะฟะปะฐะฝ.                            โ
โ  ะะธะบัะพั ะพัะณะฐะฝะธะทัะตั ะฒัััะตัั.                  โ
โ  ะะผะธััะธะน ะฟะพะผะพะณะฐะตั ั logistics.               โ
โ  ะะฝะฝะฐ ัะพะทะดะฐัั ะฟะพะผะตัะธ.                        โ
โ                                              โ
โ  ะะะะะะจะะ ะะะกะกะะฎ.                            โ
โ  ะะตัะตัะฒะฐัะธ ะฒัั ััะพ ะผะพะถะตัั.                   โ
โ  ะะฐัะตะผ ะณะพัะพะฒััั ะบ ัะฒะฐะบัะฐัะธะธ.                 โ
โ                                              โ
โ  ะะพะฒะตัััั ะฟัะพัะตััั.                          โ
โ  ะั ัะตะฑั ะฟัะธะบัะพะตะผ.                           โ
โ                                              โ
โ  โ A.S.                                      โ
โ                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะงัะพ ะฒั ัะทะฝะฐะปะธ:**
- โ ะััะปะพะฒ ะตะดะตั ะะะงะะ (ะฝะต ะฟัะพััะพ ะฐะณะตะฝัั ะฝะฐะฑะปัะดะตะฝะธั!)
- โ ETA 22:00 = ัะตัะตะท 90 ะผะธะฝัั
- โ ะขะฐะบัะธะบะฐ: ะฑะปะพะบะธัะพะฒะบะฐ โ ััะตะฑะพะฒะฐะฝะธะต โ ััััะผ (ะตัะปะธ ะพัะบะฐะท)
- โ "Capture alive" = ะดะปั ะดะพะฟัะพัะฐ (ะฝะต ัะฑััั!)
- โ ะะพะพัะดะธะฝะฐัั ัะปะตะดัััะตะณะพ ัะทะปะฐ: 10.0.0.1:4433 (Episode 12!)
- โ Ghost, ะะผะธััะธะน, ะะฝะฝะฐ ะณะพัะพะฒัั ะฟะปะฐะฝ ัะฒะฐะบัะฐัะธะธ

ะั ัะผะพััะธัะต ะฝะฐ ัะฐัั. **20:32.** ะัะตะผั ะธะดัั.

Packet sniffer ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัั. ะะฐะถะดัะน ะฟะฐะบะตั โ ัะตะฝะฝะฐั ะธะฝัะพัะผะฐัะธั. ะะฐะถะดะฐั ัะตะบัะฝะดะฐ โ ะฝะฐ ััะตัั.

**ะัะพัะฝะธะบ ััะฐะป ะดะพะฑััะตะน. ะะพ ะดะพะฑััะฐ ะทะฝะฐะตั, ััะพ ะพัะพัะฝะธะบ ะธะดัั.**

**ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ ะฟัะพะดะพะปะถะฐะตััั.**

---

## ๐ฏ ะะธััะธั: "Packet Sniffer"

### ะะตะณะตะฝะดะฐ

ะะณะตะฝัั ะฟัะพัะธะฒะฝะธะบะฐ ะพะฑะผะตะฝะธะฒะฐัััั ัะพะพะฑัะตะฝะธัะผะธ ะฝะฐ ะฟะพััั **9999**. V. ะฟะพะดะพะทัะตะฒะฐะตั, ััะพ ะฒ ะฟะฐะบะตัะฐั ัะบัััะฐ ะบะพะพัะดะธะฝะฐัะฐ ัะปะตะดัััะตะณะพ ัะทะปะฐ.

**ะะฐัะฐ ะทะฐะดะฐัะฐ**: ะฟะตัะตัะฒะฐัะธัั TCP ััะฐัะธะบ ะธ ะธะทะฒะปะตัั ัะบัััะพะต ัะพะพะฑัะตะฝะธะต.

**ะัะพัะพะบะพะป ะบะพะผะผัะฝะธะบะฐัะธะธ**:
```
Agent A โ Agent B: TCP 127.0.0.1:54321 โ 127.0.0.1:9999
Payload: [ะทะฐัะธััะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต]

Agent B โ Agent A: TCP 127.0.0.1:9999 โ 127.0.0.1:54321
Payload: [ะพัะฒะตั]
```

**ะกะบัััะพะต ัะพะพะฑัะตะฝะธะต**: ะธะทะฒะปะตะบะฐะตััั ะธะท **payload** ะบะฐะถะดะพะณะพ ะฟะฐะบะตัะฐ ะฝะฐ ะฟะพัั 9999.

---

### ะขะตัะฝะธัะตัะบะธะต ััะตะฑะพะฒะฐะฝะธั

**1. ะกะพะทะดะฐัั raw socket ะดะปั TCP**:
```c
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
```

**2. ะะตัะตัะฒะฐััะฒะฐัั ะฟะฐะบะตัั**:
```c
while (1) {
    recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
    // ะะฐััะธะฝะณ
}
```

**3. ะะทะฒะปะตัั ะธะฝัะพัะผะฐัะธั**:
- Source IP:Port
- Destination IP:Port
- TCP flags (SYN, ACK, PSH, FIN)
- Payload (ะดะฐะฝะฝัะต ะฟะพัะปะต TCP ะทะฐะณะพะปะพะฒะบะฐ)

**4. ะคะธะปัััะพะฒะฐัั ะฟะพ ะฟะพััั 9999**

**5. Hex dump payload**

**6. ะะทะฒะปะตัั ัะตะบัะตัะฝะพะต ัะพะพะฑัะตะฝะธะต** (ASCII ัะธะผะฒะพะปั ะธะท payload)

---

## ๐ ะกัััะบัััะฐ ัะฟะธะทะพะดะฐ

```
episode-11-packet-analysis/
โโโ README.md              โ ะั ะทะดะตัั
โโโ mission.md
โโโ starter.c              โ ะจะฐะฑะปะพะฝ packet sniffer
โโโ artifacts/
โ   โโโ packet_sniffer.c   โ ะกะพะทะดะฐะนัะต ััะพั ัะฐะนะป
โโโ solution/
โ   โโโ packet_sniffer_solution.c
โ   โโโ traffic_generator.c  โ ะะตะฝะตัะฐัะพั ัะตััะพะฒะพะณะพ ััะฐัะธะบะฐ
โโโ tests/
    โโโ test.sh
```

### ๐ก ะะฐะบ ัะฐะฑะพัะฐัั:

1. **ะะทััะธัะต** `starter.c` โ ัะฐะผ ะฑะฐะทะพะฒัะน raw socket ั TODO
2. **ะกะพะทะดะฐะนัะต** ัะฐะนะป `artifacts/packet_sniffer.c`
3. **ะะตะฐะปะธะทัะนัะต** packet sniffing:
   - ะกะพะทะดะฐะฝะธะต raw socket (`SOCK_RAW`, `IPPROTO_TCP`)
   - ะะฐััะธะฝะณ IP ะทะฐะณะพะปะพะฒะบะฐ (`struct iphdr`)
   - ะะฐััะธะฝะณ TCP ะทะฐะณะพะปะพะฒะบะฐ (`struct tcphdr`)
   - ะะทะฒะปะตัะตะฝะธะต payload
   - ะคะธะปัััะฐัะธั ะฟะพ ะฟะพััั 9999
   - Hex dump ะธ ASCII extraction
4. **ะกะบะพะผะฟะธะปะธััะนัะต**: `gcc -Wall -o packet_sniffer artifacts/packet_sniffer.c`
5. **ะะฐะฟัััะธัะต ั sudo**: `sudo ./packet_sniffer`

> ๐ก **ะะปั ัะตััะธัะพะฒะฐะฝะธั**: ะธัะฟะพะปัะทัะนัะต `solution/traffic_generator.c` ะดะปั ะณะตะฝะตัะฐัะธะธ ัะตััะพะฒัั ะฟะฐะบะตัะพะฒ!

---

### ะะพะดัะบะฐะทะบะธ

<details>
<summary>ะะฐะบ ัะพะทะดะฐัั raw socket?</summary>

```c
#include <sys/socket.h>
#include <netinet/ip.h>

int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
if (sockfd < 0) {
    perror("socket (are you root?)");
    exit(1);
}
```

**ะะฐะถะฝะพ**: ะทะฐะฟััะบะฐะนัะต ั `sudo`!
</details>

<details>
<summary>ะะฐะบ ะฟะฐััะธัั ะทะฐะณะพะปะพะฒะบะธ?</summary>

```c
unsigned char buffer[65536];
ssize_t size = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// IP header
struct iphdr *ip = (struct iphdr*)buffer;
int ip_len = ip->ihl * 4;

// TCP header (ะฟะพัะปะต IP)
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_len);
int tcp_len = tcp->doff * 4;

// Payload
unsigned char *payload = buffer + ip_len + tcp_len;
int payload_len = ntohs(ip->tot_len) - ip_len - tcp_len;
```
</details>

<details>
<summary>ะะฐะบ ัะธะปัััะพะฒะฐัั ะฟะพ ะฟะพััั?</summary>

```c
uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

if (dst_port == 9999 || src_port == 9999) {
    printf("Target traffic detected!\n");
    // ะะฑัะฐะฑะพัะฐัั
}
```
</details>

<details>
<summary>ะะฐะบ ะธะทะฒะปะตัั ASCII ะธะท payload?</summary>

```c
printf("ASCII: ");
for (int i = 0; i < payload_len; i++) {
    if (payload[i] >= 32 && payload[i] <= 126) {
        printf("%c", payload[i]);
    } else {
        printf(".");
    }
}
printf("\n");
```
</details>

---

## โ ะัะพะฒะตัะบะฐ

```bash
# ะะพะผะฟะธะปััะธั
gcc -Wall -o packet_sniffer artifacts/packet_sniffer.c

# ะ ะพะดะฝะพะผ ัะตัะผะธะฝะฐะปะต: ะณะตะฝะตัะฐัะพั ััะฐัะธะบะฐ
gcc -Wall -o traffic_gen solution/traffic_generator.c
./traffic_gen &

# ะ ะดััะณะพะผ ัะตัะผะธะฝะฐะปะต: sniffer (ั sudo!)
sudo ./packet_sniffer

# ะััะฐะฝะพะฒะธัั ะณะตะฝะตัะฐัะพั
pkill traffic_gen
```

**ะัะธัะตัะธะธ ััะฟะตัะฐ**:
- Raw socket ัะพะทะดะฐะฝ ััะฟะตัะฝะพ
- ะะฐััะธั IP ะธ TCP ะทะฐะณะพะปะพะฒะบะธ
- ะะทะฒะปะตะบะฐะตั payload
- ะคะธะปััััะตั ะฟะพ ะฟะพััั 9999
- ะัะฒะพะดะธั hex dump
- ะะทะฒะปะตะบะฐะตั ASCII ัะพะพะฑัะตะฝะธะต
- ะะฐัะพะดะธั ัะบัััะพะต ัะพะพะฑัะตะฝะธะต

---

## ๐ฌ DEBRIEFING

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะฆะะฏ: ะะฒะฐััะธัะฐ, ัะฐะนะพะฝ ะัะฑะฐั, ะะพัะบะฒะฐ                 โ
โ  ะะะะะฏ:   22:35, ััะตะดะฐ, 1 ะพะบััะฑัั                       โ
โ  ะกะขะะขะฃะก:  ๐ข MESSAGE INTERCEPTED                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

`packet_sniffer` ะทะฐะฟััะตะฝ ั sudo. ะะตัะตัะฒะฐั ะฝะฐัะฐั. ะะตะทัะปััะฐั:

```
=== PACKET SNIFFER ===
Listening on all interfaces...
Filtering for port 9999

[Packet #1]
From: 127.0.0.1:54321 โ 127.0.0.1:9999
Protocol: TCP
Flags: PSH ACK
Payload (24 bytes):

Offset   Hex                                  ASCII
-------- ------------------------------------ ----------------
00000000 54 68 65 20 6E 65 78 74 20 6E 6F 64 The next nod
00000010 65 3A 20 31 30 2E 30 2E 30 2E 31     e: 10.0.0.1

Decoded: "The next node: 10.0.0.1"

[Packet #2]
From: 127.0.0.1:9999 โ 127.0.0.1:54321
Protocol: TCP
Flags: PSH ACK
Payload (18 bytes):

Offset   Hex                                  ASCII
-------- ------------------------------------ ----------------
00000000 50 6F 72 74 3A 20 34 34 33 33 0A     Port: 4433.

๐ฏ HIDDEN MESSAGE EXTRACTED:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Next node: 10.0.0.1:4433               โ
โ  Protocol: Encrypted TCP                โ
โ  Mission: Episode 12                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะงัะพ ะฒั ัะทะฝะฐะปะธ:**
- **Raw sockets** ะดะฐัั ะฟะพะปะฝัะน ะบะพะฝััะพะปั ะฝะฐะด ะฟะฐะบะตัะฐะผะธ
- **IP ะธ TCP ะทะฐะณะพะปะพะฒะบะธ** ัะพะดะตัะถะฐั ะฒัั ะธะฝัะพัะผะฐัะธั ะพ ะบะพะผะผัะฝะธะบะฐัะธะธ
- **Payload** โ ััะพ ะดะฐะฝะฝัะต ะฟะพัะปะต ะทะฐะณะพะปะพะฒะบะพะฒ
- ะกะปะตะดัััะธะน ัะทะตะป: **10.0.0.1:4433** (ะทะฐัะธััะพะฒะฐะฝะฝัะน ะบะฐะฝะฐะป)

ะ 22:33 ัะธะฝะฐะปัะฝะพะต ัะพะพะฑัะตะฝะธะต ะพั V.:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FROM: V.                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ  ะขั ะฝะฐััะธะปัั ะฟะตัะตัะฒะฐััะฒะฐัั.             โ
โ  ะขะตะฟะตัั ัะธะฝะฐะป: ะะะกะจะะคะะะะะ.             โ
โ                                         โ
โ  Episode 12: Encrypted Communications   โ
โ  ะัะต ะทะฝะฐะฝะธั ัะพะฑะตััััั ะฒะพะตะดะธะฝะพ.          โ
โ                                         โ
โ  10.0.0.1:4433 ะถะดัั ัะตะฑั.               โ
โ                                         โ
โ  โ V.                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะธะดะตัั ะฟะฐะบะตัั โ ััะพ ัะธะปะฐ. ะะพะฝะธะผะฐัั ะธั โ ััะพ ะธัะบััััะฒะพ.**

### ๐๏ธ ะะฐะฒัะบ ัะฐะทะฑะปะพะบะธัะพะฒะฐะฝ:
**"Packet Master"** โ ะั ะฒะธะดะธัะต ัะตัั ะฝะฐ ััะพะฒะฝะต ะฑะฐะนัะพะฒ. Raw sockets ะฑะพะปััะต ะฝะต ัะฐะนะฝะฐ.

---

## ๐ ะะะะขะะะะฌะะซะ ะะะะะะกะซ

ะัะพะฒะตัััะต ะฟะพะฝะธะผะฐะฝะธะต Episode 11 (ะฒัะต ะฒะพะฟัะพัั ะพัะฝะพะฒะฐะฝั ะฝะฐ ััะถะตัะต ะบะพะฝัั-ัะปะตะถะบะธ):

### ๐ข ะะฐะทะพะฒะพะต ะฟะพะฝะธะผะฐะฝะธะต (4 ะฒะพะฟัะพัะฐ)

**1. ะ 19:47 ะฒั ะฟะตัะตัะฒะฐัะธะปะธ ะะขะะะะ ะะะะะข ั ะบะพะพัะดะธะฝะฐัะฐะผะธ "55.7520ยฐN 37.6175ยฐE". ะะพัะตะผั ััะพ ะฑัะป ัะพะบ?**

<details>
<summary>ะัะฒะตั</summary>

**ะญัะพ ะบะพะพัะดะธะฝะฐัั ะะะจะะะ safe house! ะะณะตะฝัั Z. ะทะฝะฐัั, ะณะดะต ะฒั ะฝะฐัะพะดะธัะตัั!**

**ะงัะพ ะฟัะพะธะทะพัะปะพ:**
```
19:47 โ ะัะพัะพะน ะฟะฐะบะตั (From: 127.0.0.1:9999 โ 127.0.0.1:54321)
        Payload: "Coordinates: 55.7520ยฐN 37.6175ยฐE"
                 "Status: Under surveillance"
                 "Agent count: 1"
```

**ะะฝะฐะปะธะท:**
- ะะพะพัะดะธะฝะฐัั ัะพัะฝะพ ัะบะฐะทัะฒะฐัั ะฝะฐ ะฒะฐัะต ัะฑะตะถะธัะต
- "Under surveillance" = ะฒะฐั ะฐะบัะธะฒะฝะพ ะพััะปะตะถะธะฒะฐัั
- "Agent count: 1" = ะพะฝะธ ะทะฝะฐัั, ััะพ ะฒั ะพะดะธะฝ

**ะขะตัะฝะธัะตัะบะธ:**
```c
// ะ packet_sniffer ะฒั ะธะทะฒะปะตะบะปะธ payload:
char *payload_start = (char*)(packet + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

// ะ ัะฒะธะดะตะปะธ:
// "Coordinates: 55.7520ยฐN 37.6175ยฐE"
```

**ะัะพะทะฝะฐะฝะธะต:** "ะัะพัะฝะธะบ ััะฐะป ะดะพะฑััะตะน" โ ะฒั ัะปะตะดะธะปะธ ะทะฐ ะฝะธะผะธ, ะฝะพ **ะะะ ัะพะถะต ัะปะตะดัั ะทะฐ ะะะะ**.

**ะฃัะพะบ:** Packet sniffing โ ะพะฑะพัะดะพะพััััะน ะผะตั. ะัะปะธ ะฒั ะผะพะถะตัะต ะฟะตัะตัะฒะฐััะฒะฐัั ััะฐัะธะบ, ัะพ ะธ ะฟัะพัะธะฒะฝะธะบ ะผะพะถะตั.
</details>

**2. ะะพัะตะผั ะดะปั ะทะฐะฟััะบะฐ packet_sniffer ะฝัะถะฝั ROOT ะฟัะฐะฒะฐ (sudo)?**

<details>
<summary>ะัะฒะตั</summary>

**ะะพัะพะผั ััะพ raw sockets ััะตะฑััั ะฟัะธะฒะธะปะตะณะธัะพะฒะฐะฝะฝะพะณะพ ะดะพัััะฟะฐ ะบ ัะตัะตะฒะพะผั ััะตะบั!**

**ะัะธัะธะฝะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ:**
```c
// ะกะพะทะดะฐะฝะธะต raw socket:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
// ^^^ ะขะพะปัะบะพ root ะผะพะถะตั ะดะตะปะฐัั ััะพ!

if (sockfd < 0) {
    perror("socket");  // "Operation not permitted" ะฑะตะท sudo
    exit(1);
}
```

**ะะพัะตะผั root?**
1. **Raw socket ะฒะธะดะธั ะะกะ ะฟะฐะบะตัั:**
   - ะะบะปััะฐั ะฟะฐะบะตัั ะดััะณะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
   - ะะบะปััะฐั ะทะฐัะธััะพะฒะฐะฝะฝัะต ัะพะตะดะธะฝะตะฝะธั
   - ะญัะพ ะฝะฐัััะตะฝะธะต ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝะพััะธ!

2. **ะะพะถะฝะพ ะฟะพะดะดะตะปะฐัั ะฟะฐะบะตัั:**
   - ะก ะปัะฑัะผ source IP
   - ะก ะปัะฑัะผ source port
   - ะกะฟััะธะฝะณ ะฐัะฐะบ, man-in-the-middle

3. **ะะฑัะพะด firewall:**
   - Raw sockets ัะฐะฑะพัะฐัั ะฝะฐ ััะพะฒะฝะต IP
   - ะะธะฝััั ะผะฝะพะณะธะต ะทะฐัะธัั

**ะ ะผะธััะธะธ:**
```bash
$ ./packet_sniffer
socket: Operation not permitted  โ ะะตะท sudo!

$ sudo ./packet_sniffer
Listening on all interfaces...  โ
```

**ะะปััะตัะฝะฐัะธะฒั (ะฑะตะท root):**
- `pcap` ะฑะธะฑะปะธะพัะตะบะฐ (ะฝะพ ะฝัะถะฝั ะฟัะฐะฒะฐ ะฝะฐ ะธะฝัะตััะตะนั)
- `tcpdump` ั setuid (ะฝะตะฑะตะทะพะฟะฐัะฝะพ)
- Docker ั capabilities (CAP_NET_RAW)

**ะฃัะพะบ:** Raw sockets = ะผะพัะฝัะน ะธะฝััััะผะตะฝั, ััะตะฑัะตั ะพัะฒะตัััะฒะตะฝะฝะพััะธ.
</details>

**3. ะ 20:00 ะฒั ะพัะพะทะฝะฐะปะธ, ััะพ ะฐะณะตะฝัั Z. ะขะะะ ะธัะฟะพะปัะทััั packet sniffing. ะะฐะบ ะพะฝะธ ะผะพะณะปะธ ะฟะตัะตัะฒะฐัะธัั ะฒะฐั ััะฐัะธะบ?**

<details>
<summary>ะัะฒะตั</summary>

**ะะฝะธ ะฝะฐ ัะพะผ ะถะต ัะตัะตะฒะพะผ ัะตะณะผะตะฝัะต ะธะปะธ ะธะผะตัั ะดะพัััะฟ ะบ ะผะฐัััััะธะทะฐัะพัั!**

**ะกัะตะฝะฐัะธะน 1: Shared network (WiFi, ะพะฑัะฐั ัะตัั):**
```
       ะะะจ ะะะะะฌะฎะขะะ              ะะะะะข Z.
           ๐ฑ                         ๐ค
            โ                         โ
            โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                     โ
                 [WiFi Router]
                 
โ ะะณะตะฝั Z. ะฒะบะปััะฐะตั promiscuous mode ะฝะฐ WiFi:
  sudo ifconfig wlan0 promisc
  sudo tcpdump -i wlan0
  
โ ะะธะดะธั ะะกะ ะฟะฐะบะตัั ะฒ WiFi ัะตัะธ, ะฒะบะปััะฐั ะฒะฐัะธ!
```

**ะกัะตะฝะฐัะธะน 2: Man-in-the-Middle (ARP spoofing):**
```c
// ะะณะตะฝั Z. ะพัะฟัะฐะฒะปัะตั ะฟะพะดะดะตะปัะฝัะต ARP ะฟะฐะบะตัั:
// "ะฏ โ ััะพ ะผะฐัััััะธะทะฐัะพั!"
// ะะตัั ััะฐัะธะบ ะธะดัั ัะตัะตะท ะฝะตะณะพ
```

**ะกัะตะฝะฐัะธะน 3: ะะพะผะฟัะพะผะตัะธัะพะฒะฐะฝะฝัะน ัะพััะตั:**
```
ะะณะตะฝัั Z. ะฒะทะปะพะผะฐะปะธ WiFi ัะพััะตั safe house
โ ะะฐัััะพะธะปะธ port mirroring
โ ะะตัั ััะฐัะธะบ ะบะพะฟะธััะตััั ะธะผ
```

**ะ ะผะธััะธะธ:**
- Safe house ะบะพะผะฟัะพะผะตัะธัะพะฒะฐะฝ
- ะะณะตะฝัั Z. ะธะผะตัั ะดะพัััะฟ ะบ ะปะพะบะฐะปัะฝะพะน ัะตัะธ
- ะะฝะธ ะทะฐะฟัััะธะปะธ ัะฒะพะน packet_sniffer
- ะะตัะตัะฒะฐััะฒะฐัั ะฒะฐัะธ ัะพะตะดะธะฝะตะฝะธั

**ะะฐัะธัะฐ:**
- VPN (ัะธััะพะฒะฐะฝะธะต ััะฐัะธะบะฐ)
- HTTPS (TLS)
- ะกะผะตะฝะธัั safe house (ัะธะทะธัะตัะบะฐั ะฑะตะทะพะฟะฐัะฝะพััั)

**ะฃัะพะบ:** ะะตะทะพะฟะฐัะฝะพััั ัะตัะธ = ะฑะตะทะพะฟะฐัะฝะพััั ัะธะทะธัะตัะบะฐั + ะบัะธะฟัะพะณัะฐัะธั.
</details>

**4. ะงัะพ ะพะทะฝะฐัะฐะตั ัะปะฐะณ "PSH ACK" ะฒ ะฟะตัะตัะฒะฐัะตะฝะฝัั TCP ะฟะฐะบะตัะฐั?**

<details>
<summary>ะัะฒะตั</summary>

**PSH = "Push" (ะฝะตะผะตะดะปะตะฝะฝะพ ะพัะฟัะฐะฒะธัั), ACK = "Acknowledgment" (ะฟะพะดัะฒะตัะถะดะตะฝะธะต)**

**ะะฐััะธััะพะฒะบะฐ:**
```c
struct tcphdr *tcp = (struct tcphdr*)(packet + ip_header_len);

if (tcp->psh) {
    printf("ะคะปะฐะณ PSH ัััะฐะฝะพะฒะปะตะฝ โ ะฝะตะผะตะดะปะตะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ\n");
    // ะะฐะฝะฝัะต ะะ ะฑััะตัะธะทััััั, ะพัะฟัะฐะฒะปััััั ััะฐะทั
}

if (tcp->ack) {
    printf("ะคะปะฐะณ ACK ัััะฐะฝะพะฒะปะตะฝ โ ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะฟะพะปััะตะฝะธั\n");
    printf("ACK number: %u\n", ntohl(tcp->ack_seq));
}
```

**PSH (Push):**
- ะัะธะปะพะถะตะฝะธะต ัะพัะตั ะพัะฟัะฐะฒะธัั ะดะฐะฝะฝัะต ะะะะะะะะะะ
- ะะต ะถะดะฐัั ะทะฐะฟะพะปะฝะตะฝะธั TCP ะฑััะตัะฐ
- ะขะธะฟะธัะฝะพ ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝะพะณะพ ััะฐัะธะบะฐ (SSH, telnet, chat)

**ACK (Acknowledgment):**
- ะะพะดัะฒะตัะถะดะฐั ะฟะพะปััะตะฝะธะต ะดะฐะฝะฝัั ั seq = ack_seq - 1
- ะัะธัััััะฒัะตั ะฟะพััะธ ะฒะพ ะฒัะตั TCP ะฟะฐะบะตัะฐั (ะบัะพะผะต ะฟะตัะฒะพะณะพ SYN)

**ะ ะผะธััะธะธ (ะะฐะบะตั #1):**
```
[Packet #1]
From: 127.0.0.1:54321 โ 127.0.0.1:9999
Flags: PSH ACK
Payload: "Target confirmed. Location: Safe house."
```

**ะะพัะตะผั PSH ACK?**
- ะะณะตะฝั Z. ะพัะฟัะฐะฒะธะป ัะพะพะฑัะตะฝะธะต
- PSH = "ะพัะฟัะฐะฒั ะฝะตะผะตะดะปะตะฝะฝะพ, ะฝะต ะฑััะตัะธะทัะน" (ััะพัะฝะพะต ัะพะพะฑัะตะฝะธะต!)
- ACK = "ะฟะพะดัะฒะตัะถะดะฐั ะฟะพะปััะตะฝะธะต ะฟัะตะดัะดััะธั ะดะฐะฝะฝัั"

**ะััะณะธะต ัะปะฐะณะธ:**
- SYN = ัััะฐะฝะพะฒะบะฐ ัะพะตะดะธะฝะตะฝะธั
- FIN = ะทะฐะฒะตััะตะฝะธะต ัะพะตะดะธะฝะตะฝะธั
- RST = ะฐะฒะฐัะธะนะฝัะน ัะฑัะพั
- URG = ััะพัะฝัะต ะดะฐะฝะฝัะต

**ะฃัะพะบ:** ะคะปะฐะณะธ ัะฐัะบััะฒะฐัั ัะฐัะฐะบัะตั ะบะพะผะผัะฝะธะบะฐัะธะธ (ััะพัะฝะพััั, ัะพััะพัะฝะธะต ัะตััะธะธ).
</details>

---

### ๐ก ะัะฐะบัะธะบะฐ (5 ะฒะพะฟัะพัะพะฒ)

**5. ะ ะบะพะดะต ะฒั ะธัะฟะพะปัะทัะตัะต `IPPROTO_TCP` ะดะปั ัะธะปัััะฐัะธะธ. ะะฐะบ ะฟะตัะตัะฒะฐัะธัั ะขะะะฌะะ UDP ะฟะฐะบะตัั?**

<details>
<summary>ะัะฒะตั</summary>

**ะกะพะทะดะฐัั raw socket ั `IPPROTO_UDP`:**

```c
// ะะปั TCP (ะธะท ะผะธััะธะธ):
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

// ะะปั UDP:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_UDP);

// ะะปั ะะกะะฅ ะฟัะพัะพะบะพะปะพะฒ:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_IP);
```

**UDP packet sniffer:**
```c
#include <netinet/udp.h>  // struct udphdr

// ...receive packet...

// ะะฐััะธะฝะณ IP ะทะฐะณะพะปะพะฒะบะฐ (ะฐะฝะฐะปะพะณะธัะฝะพ TCP)
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;

// ะะฐััะธะฝะณ UDP ะทะฐะณะพะปะพะฒะบะฐ
struct udphdr *udp = (struct udphdr*)(buffer + ip_header_len);

printf("UDP Source port: %u\n", ntohs(udp->source));
printf("UDP Dest port: %u\n", ntohs(udp->dest));
printf("UDP Length: %u\n", ntohs(udp->len));
printf("UDP Checksum: 0x%04X\n", ntohs(udp->check));

// Payload
int udp_header_len = sizeof(struct udphdr);  // ะัะตะณะดะฐ 8 ะฑะฐะนั
char *payload = (char*)(buffer + ip_header_len + udp_header_len);
int payload_len = ntohs(udp->len) - udp_header_len;
```

**ะัะปะธัะธั UDP vs TCP:**
```
TCP ะทะฐะณะพะปะพะฒะพะบ: 20+ ะฑะฐะนั (ะฟะตัะตะผะตะฝะฝัะน ัะฐะทะผะตั ะธะท-ะทะฐ ะพะฟัะธะน)
UDP ะทะฐะณะพะปะพะฒะพะบ: 8 ะฑะฐะนั (ัะธะบัะธัะพะฒะฐะฝะฝัะน)

TCP: seq, ack_seq, flags, window...
UDP: ัะพะปัะบะพ source, dest, len, checksum
```

**ะ ะผะธััะธะธ:**
- ะะณะตะฝัั Z. ะธัะฟะพะปัะทััั TCP (ะฟะพัั 9999)
- ะะพ ะผะพะณะปะธ ะฑั ะธัะฟะพะปัะทะพะฒะฐัั UDP (ะฑััััะตะต, ะผะตะฝััะต ัะปะตะดะพะฒ)
- ะะปั ะฟะตัะตัะฒะฐัะฐ UDP ะฝัะถะฝะพ ะธะทะผะตะฝะธัั ัะพะปัะบะพ `IPPROTO_TCP` โ `IPPROTO_UDP`

**ะฃัะพะบ:** Raw sockets ัะฐะฑะพัะฐัั ัะพ ะฒัะตะผะธ ะฟัะพัะพะบะพะปะฐะผะธ (TCP, UDP, ICMP, ...).
</details>

**6. ะะฐะบ ะพััะธะปัััะพะฒะฐัั ะฟะฐะบะตัั ะขะะะฌะะ ั ะฟะพััะฐ 9999, ะฐ ะฝะต ะฒัะตั ะฟะพััะพะฒ?**

<details>
<summary>ะัะฒะตั</summary>

**ะัะพะฒะตัะธัั source/dest port ะฒ TCP ะทะฐะณะพะปะพะฒะบะต:**

```c
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

// ะคะธะปััั: ัะพะปัะบะพ ะฟะพัั 9999
#define TARGET_PORT 9999

if (src_port == TARGET_PORT || dst_port == TARGET_PORT) {
    printf("[Packet on port 9999]\n");
    printf("From: %s:%u โ ", src_ip_str, src_port);
    printf("%s:%u\n", dst_ip_str, dst_port);
    
    // ะะฑัะฐะฑะพัะฐัั payload
    // ...
} else {
    // ะัะพะฟัััะธัั
    continue;
}
```

**ะ ะผะธััะธะธ:**
```c
// ะะตัะตัะฒะฐั ะะกะะฅ TCP ะฟะฐะบะตัะพะฒ:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

while (1) {
    // ะะพะปััะธัั ะฟะฐะบะตั
    recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
    
    // ะะฐััะธะฝะณ
    struct iphdr *ip = (struct iphdr*)buffer;
    struct tcphdr *tcp = (struct tcphdr*)(buffer + ip->ihl * 4);
    
    // ะคะะะฌะขะ ะฟะพ ะฟะพััั
    if (ntohs(tcp->source) == 9999 || ntohs(tcp->dest) == 9999) {
        printf("MATCHED! Port 9999 packet\n");
        // ะะทะฒะปะตัั payload ะฐะณะตะฝัะพะฒ Z.
    }
}
```

**ะะปััะตัะฝะฐัะธะฒะฐ: BPF (Berkeley Packet Filter):**
```c
// ะก libpcap ะผะพะถะฝะพ ะทะฐะดะฐัั ัะธะปััั:
pcap_compile(handle, &fp, "tcp port 9999", 0, PCAP_NETMASK_UNKNOWN);
pcap_setfilter(handle, &fp);
// Kernel ะฑัะดะตั ัะธะปัััะพะฒะฐัั ะฐะฒัะพะผะฐัะธัะตัะบะธ (ัััะตะบัะธะฒะฝะตะต!)
```

**ะฃัะพะบ:** ะคะธะปัััะฐัะธั ะฒ user space vs kernel space (BPF ะฑััััะตะต).
</details>

**7. ะ 19:46 ะฟะตัะฒัะน ะฟะฐะบะตั ัะพะดะตัะถะฐะป "Target confirmed". ะะฐะบ ะพะฟัะตะดะตะปะธัั, ะบะฐะบะพะน ะฟะฐะบะตั ะฟัะธััะป ะฟะตัะฒัะผ, ะตัะปะธ ะพะฝะธ ะฟะตัะตะผะตัะฐะฝั?**

<details>
<summary>ะัะฒะตั</summary>

**ะัะฟะพะปัะทะพะฒะฐัั TCP sequence numbers!**

```c
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

uint32_t seq = ntohl(tcp->seq);
uint32_t ack_seq = ntohl(tcp->ack_seq);

printf("SEQ: %u\n", seq);
printf("ACK: %u\n", ack_seq);
```

**ะกะพััะธัะพะฒะบะฐ ะฟะฐะบะตัะพะฒ:**
```c
typedef struct {
    uint32_t seq;
    char payload[1024];
    int payload_len;
} Packet;

Packet packets[100];
int packet_count = 0;

// ะัะธ ะฟะพะปััะตะฝะธะธ ะฟะฐะบะตัะฐ:
packets[packet_count].seq = ntohl(tcp->seq);
memcpy(packets[packet_count].payload, payload, payload_len);
packets[packet_count].payload_len = payload_len;
packet_count++;

// ะกะพััะธัะพะฒะบะฐ ะฟะพ SEQ:
qsort(packets, packet_count, sizeof(Packet), compare_seq);

int compare_seq(const void *a, const void *b) {
    Packet *pa = (Packet*)a;
    Packet *pb = (Packet*)b;
    
    if (pa->seq < pb->seq) return -1;
    if (pa->seq > pb->seq) return 1;
    return 0;
}

// ะขะตะฟะตัั packets[0] โ ะฟะตัะฒัะน ะฟะฐะบะตั!
```

**ะ ะผะธััะธะธ:**
```
[Packet #1] SEQ=1000: "Target confirmed. Location: Safe house."
[Packet #2] SEQ=1048: "Coordinates: 55.7520ยฐN 37.6175ยฐE"
[Packet #3] SEQ=1112: "Order: Continue monitoring."
```

**ะะพัะตะผั SEQ ะฒะฐะถะตะฝ:**
- ะะฐะบะตัั ะผะพะณัั ะฟัะธะนัะธ ะฒ ะปัะฑะพะผ ะฟะพััะดะบะต (routing, retransmit)
- SEQ ะพะฟัะตะดะตะปัะตั ะธััะธะฝะฝัะน ะฟะพััะดะพะบ
- ะกะปะตะดัััะธะน ะฟะฐะบะตั: SEQ = ะฟัะตะดัะดััะธะน SEQ + payload_len

**ะฃัะพะบ:** TCP sequence numbers = timestamp ะดะฐะฝะฝัั (ะดะปั ัะฟะพััะดะพัะธะฒะฐะฝะธั ะฟะพัะพะบะฐ).
</details>

**8. ะงัะพ ัะฐะบะพะต "promiscuous mode" ะธ ะทะฐัะตะผ ะพะฝ ะฝัะถะตะฝ ะดะปั packet sniffing?**

<details>
<summary>ะัะฒะตั</summary>

**Promiscuous mode = "ะฟัะธะฝะธะผะฐัั ะะกะ ะฟะฐะบะตัั, ะดะฐะถะต ะฝะต ะฐะดัะตัะพะฒะฐะฝะฝัะต ัะตะฑะต"**

**ะะพัะผะฐะปัะฝัะน ัะตะถะธะผ:**
```
ะกะตัะตะฒะฐั ะบะฐััะฐ ัะธะปััััะตั ะฟะฐะบะตัั:
โโ ะะฐะบะตัั ั ะฒะฐัะธะผ MAC โ ะฟัะธะฝััั
โโ Broadcast ะฟะฐะบะตัั โ ะฟัะธะฝััั
โโ ะััะฐะปัะฝัะต โ ะะขะะะะกะะขะฌ
```

**Promiscuous mode:**
```
ะกะตัะตะฒะฐั ะบะฐััะฐ ะฟัะธะฝะธะผะฐะตั ะะกะ:
โโ ะะฐะบะตัั ั ะฒะฐัะธะผ MAC โ ะฟัะธะฝััั
โโ ะะฐะบะตัั ั ััะถะธะผ MAC โ ะฟัะธะฝััั!
โโ Broadcast โ ะฟัะธะฝััั
โโ ะัั ะพััะฐะปัะฝะพะต โ ะฟัะธะฝััั!
```

**ะะบะปััะตะฝะธะต ะฒ ะบะพะดะต:**
```c
#include <sys/ioctl.h>
#include <net/if.h>

int sockfd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));

// ะะพะปััะธัั ะธะผั ะธะฝัะตััะตะนัะฐ
struct ifreq ifr;
strncpy(ifr.ifr_name, "eth0", IFNAMSIZ);

// ะะบะปััะธัั promiscuous mode
ioctl(sockfd, SIOCGIFFLAGS, &ifr);
ifr.ifr_flags |= IFF_PROMISC;
ioctl(sockfd, SIOCSIFFLAGS, &ifr);

printf("Promiscuous mode enabled on eth0\n");
```

**ะ ะผะธััะธะธ:**
- ะะตะท promiscuous: ะฒะธะดะธัะต ัะพะปัะบะพ ัะฒะพะธ ะฟะฐะบะตัั
- ะก promiscuous: ะฒะธะดะธัะต ะฟะฐะบะตัั ะฐะณะตะฝัะพะฒ Z. (ะฟะพัั 9999)

**ะะฐ WiFi:**
- ะัั ัะปะพะถะฝะตะต (Monitor mode)
- ะัะถะฝะพ ะฒะธะดะตัั ะฟะฐะบะตัั ะดััะณะธั ััััะพะนััะฒ
- `airmon-ng start wlan0`

**ะะตะณะฐะปัะฝะพััั:**
โ๏ธ ะ ัะฒะพะตะน ัะตัะธ: OK  
โ๏ธ ะ ััะถะพะน ัะตัะธ: ะะะะะะะะะ (ะฟะตัะตัะฒะฐั ััะถะพะณะพ ััะฐัะธะบะฐ)

**ะฃัะพะบ:** Promiscuous mode = ะพัะฝะพะฒะฐ ะฒัะตั ัะตัะตะฒัั ะฐะฝะฐะปะธะทะฐัะพัะพะฒ (Wireshark, tcpdump).
</details>

**9. ะะฐะบ ะฒััะธัะปะธัั ะดะปะธะฝั payload ะฒ ะฟะตัะตัะฒะฐัะตะฝะฝะพะผ ะฟะฐะบะตัะต?**

<details>
<summary>ะัะฒะตั</summary>

**`total_len - ip_header_len - tcp_header_len`:**

```c
// 1. ะะพะปััะธัั ะฟะฐะบะตั
char buffer[65536];
ssize_t total_len = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// 2. ะะฐััะธะฝะณ IP ะทะฐะณะพะปะพะฒะบะฐ
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;  // ihl ะฒ 32-bit ัะปะพะฒะฐั
// ihl=5 โ 5*4=20 ะฑะฐะนั (ะผะธะฝะธะผะฐะปัะฝัะน IP ะทะฐะณะพะปะพะฒะพะบ)

// 3. ะะฐััะธะฝะณ TCP ะทะฐะณะพะปะพะฒะบะฐ
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);
int tcp_header_len = tcp->doff * 4;  // doff ะฒ 32-bit ัะปะพะฒะฐั
// doff=5 โ 5*4=20 ะฑะฐะนั (ะผะธะฝะธะผะฐะปัะฝัะน TCP ะทะฐะณะพะปะพะฒะพะบ)

// 4. ะััะธัะปะธัั payload
char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

if (payload_len > 0) {
    printf("Payload (%d bytes):\n", payload_len);
    for (int i = 0; i < payload_len; i++) {
        printf("%c", payload[i]);
    }
    printf("\n");
}
```

**ะัะธะผะตั (ะะฐะบะตั #1 ะธะท ะผะธััะธะธ):**
```
total_len = 84 ะฑะฐะนั (ะพั recvfrom)
ip_header_len = 20 ะฑะฐะนั (ััะฐะฝะดะฐััะฝัะน)
tcp_header_len = 20 ะฑะฐะนั (ะฑะตะท ะพะฟัะธะน)

payload_len = 84 - 20 - 20 = 44 ะฑะฐะนั
payload = "Target confirmed. Location: Safe house.\n"
```

**ะะฐะถะฝะพ:**
- `ihl` ะธ `doff` โ ะฒ 32-bit ัะปะพะฒะฐั, ะะ ะฑะฐะนัะฐั!
- ะะธะฝะธะผัะผ: IP=20 ะฑะฐะนั, TCP=20 ะฑะฐะนั
- ะะฐะบัะธะผัะผ: IP=60 ะฑะฐะนั (ั ะพะฟัะธัะผะธ), TCP=60 ะฑะฐะนั
- Payload ะผะพะถะตั ะฑััั 0 (ACK ะฑะตะท ะดะฐะฝะฝัั)

**ะัะพะฒะตัะบะฐ:**
```c
if (payload_len < 0) {
    fprintf(stderr, "Invalid packet (negative payload)\n");
    continue;
}
```

**ะฃัะพะบ:** Payload = "ัะพ, ัะฐะดะธ ัะตะณะพ ะฒัั ััะพ" (ัะตะฐะปัะฝัะต ะดะฐะฝะฝัะต ะฟัะธะปะพะถะตะฝะธั).
</details>

---

### ๐ด ะะฝะฐะปะธะท ะบะพะดะฐ (3 ะฒะพะฟัะพัะฐ)

**10. ะะฐะนะดะธัะต ะพัะธะฑะบั ะฒ ััะพะผ ะบะพะดะต ะธะทะฒะปะตัะตะฝะธั payload:**

```c
struct iphdr *ip = (struct iphdr*)buffer;
struct tcphdr *tcp = (struct tcphdr*)(buffer + 20);  // โ ะะจะะะะ?
char *payload = (char*)(buffer + 40);
int payload_len = total_len - 40;
```

<details>
<summary>ะัะฒะตั</summary>

**ะัะธะฑะบะฐ: hardcoded ัะฐะทะผะตัั ะทะฐะณะพะปะพะฒะบะพะฒ!**

**ะัะพะฑะปะตะผั:**

1. **IP ะทะฐะณะพะปะพะฒะพะบ ะฝะต ะฒัะตะณะดะฐ 20 ะฑะฐะนั:**
   ```c
   struct tcphdr *tcp = (struct tcphdr*)(buffer + 20);  // โ
   ```
   - ะะพะถะตั ะฑััั 20-60 ะฑะฐะนั (IP ะพะฟัะธะธ!)
   - ะัะถะฝะพ: `ip->ihl * 4`

2. **TCP ะทะฐะณะพะปะพะฒะพะบ ะฝะต ะฒัะตะณะดะฐ 20 ะฑะฐะนั:**
   ```c
   char *payload = (char*)(buffer + 40);  // โ (20+20)
   ```
   - ะะพะถะตั ะฑััั 20-60 ะฑะฐะนั (TCP ะพะฟัะธะธ!)
   - ะัะถะฝะพ: `tcp->doff * 4`

3. **Payload offset ะฝะตะฟัะฐะฒะธะปัะฝัะน:**
   ```c
   int payload_len = total_len - 40;  // โ
   ```

**ะัะฐะฒะธะปัะฝัะน ะบะพะด:**
```c
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;  // โ ะะธะฝะฐะผะธัะตัะบะธะน!

struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);
int tcp_header_len = tcp->doff * 4;  // โ ะะธะฝะฐะผะธัะตัะบะธะน!

char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;
```

**ะงัะพ ะฟัะพะธะทะพะนะดัั ะฟัะธ ะพัะธะฑะบะต:**
- ะะฐะบะตั ั IP ะพะฟัะธัะผะธ (ihl=6, 24 ะฑะฐะนัะฐ)
- `buffer + 20` โ ะฝะตะฟัะฐะฒะธะปัะฝัะน offset
- ะงะธัะฐะตะผ ะผััะพั ะฒะผะตััะพ TCP ะทะฐะณะพะปะพะฒะบะฐ
- Payload ัะพะดะตัะถะธั ัะฐััั TCP ะทะฐะณะพะปะพะฒะบะฐ
- ะะตะฒะพะทะผะพะถะฝะพ ะดะตะบะพะดะธัะพะฒะฐัั ะดะฐะฝะฝัะต ะฐะณะตะฝัะพะฒ Z.!

**ะฃัะพะบ:** ะะธะบะพะณะดะฐ ะฝะต hardcode ัะฐะทะผะตัั ะฟัะพัะพะบะพะปัะฝัั ะทะฐะณะพะปะพะฒะบะพะฒ!
</details>

**11. ะะพัะตะผั ััะพั ะบะพะด ะผะพะถะตั ัะธัะฐัั ะผััะพั?**

```c
char buffer[1024];
int n = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
printf("Payload: %s\n", (char*)(buffer + 40));  // โ ะะะะะะะะ?
```

<details>
<summary>ะัะฒะตั</summary>

**ะัะพะฑะปะตะผะฐ: `%s` ััะตะฑัะตั null-terminated ัััะพะบั, ะฐ payload ะผะพะถะตั ะฝะต ะธะผะตัั `\0`!**

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```c
printf("Payload: %s\n", (char*)(buffer + 40));
```

- `%s` ัะธัะฐะตั ะดะพ `\0`
- Payload ะฐะณะตะฝัะพะฒ Z. ะผะพะถะตั ะะ ะธะผะตัั `\0` ะฒ ะบะพะฝัะต
- `printf` ะฟัะพะดะพะปะถะธั ัะธัะฐัั ะทะฐ ะฟัะตะดะตะปั payload
- โ ะงัะตะฝะธะต ะผััะพัะฐ, ะฒะพะทะผะพะถะฝะพ segfault!

**ะัะธะผะตั (ะฑะตะทะพะฟะฐัะฝัะน ะฒัะฒะพะด):**
```c
char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

// ะะฐัะธะฐะฝั 1: ะฟะพัะธะผะฒะพะปัะฝะพ
for (int i = 0; i < payload_len; i++) {
    printf("%c", payload[i]);
}
printf("\n");

// ะะฐัะธะฐะฝั 2: ัะพะทะดะฐัั null-terminated ะบะพะฟะธั
char safe_payload[1024];
memcpy(safe_payload, payload, payload_len);
safe_payload[payload_len] = '\0';  // ะะพะฑะฐะฒะธัั \0
printf("Payload: %s\n", safe_payload);

// ะะฐัะธะฐะฝั 3: precision ะฒ printf
printf("Payload: %.*s\n", payload_len, payload);
//                ^^^ ะฟะตัะฐัะฐัั ัะพะปัะบะพ payload_len ัะธะผะฒะพะปะพะฒ
```

**ะ ะผะธััะธะธ:**
```
Payload (ะฑะตะท \0): "Target confirmed. Location: Safe house."
ะกะปะตะดัััะธะต ะฑะฐะนัั ะฒ ะฟะฐะผััะธ: [random garbage]

printf("%s") โ "Target confirmed...Safe house.[ะผััะพั][ะผััะพั]..."
```

**ะฃัะพะบ:** ะกะตัะตะฒัะต ะดะฐะฝะฝัะต โ ััะพ ะฑะฐะนัั, ะะ C-ัััะพะบะธ!
</details>

**12. ะ ััะผ ะฟัะพะฑะปะตะผะฐ ััะพะณะพ ัะธะปัััะฐ ะฟะพ IP?**

```c
struct iphdr *ip = (struct iphdr*)buffer;

if (ip->saddr == inet_addr("127.0.0.1")) {  // โ ะะจะะะะ?
    printf("From localhost\n");
}
```

<details>
<summary>ะัะฒะตั</summary>

**ะัะธะฑะบะฐ: ััะฐะฒะฝะตะฝะธะต network byte order ั host byte order!**

**ะัะพะฑะปะตะผะฐ:**
```c
if (ip->saddr == inet_addr("127.0.0.1")) {  // โ
```

- `ip->saddr` โ ะฒ **network byte order** (big-endian)
- `inet_addr()` โ ะฒะพะทะฒัะฐัะฐะตั **host byte order** ะฝะฐ ะฝะตะบะพัะพััั ัะธััะตะผะฐั (ะะ portable!)
- ะกัะฐะฒะฝะตะฝะธะต ะผะพะถะตั ะฟัะพะฒะฐะปะธัััั!

**ะัะฐะฒะธะปัะฝัะน ะฒะฐัะธะฐะฝั:**
```c
// ะะฐัะธะฐะฝั 1: ะะพะฝะฒะตััะธัะพะฒะฐัั ะฒ ัััะพะบั ะธ ััะฐะฒะฝะธะฒะฐัั
char src_ip_str[INET_ADDRSTRLEN];
struct in_addr src_addr;
src_addr.s_addr = ip->saddr;  // ะฃะถะต ะฒ network byte order
inet_ntop(AF_INET, &src_addr, src_ip_str, INET_ADDRSTRLEN);

if (strcmp(src_ip_str, "127.0.0.1") == 0) {
    printf("From localhost\n");
}

// ะะฐัะธะฐะฝั 2: ะัะฟะพะปัะทะพะฒะฐัั inet_pton
struct in_addr expected;
inet_pton(AF_INET, "127.0.0.1", &expected);  // โ network byte order

if (ip->saddr == expected.s_addr) {  // โ ะะฑะฐ ะฒ network byte order
    printf("From localhost\n");
}

// ะะฐัะธะฐะฝั 3: ะััะผะพะต ััะฐะฒะฝะตะฝะธะต ั ััััะพะผ byte order
if (ntohl(ip->saddr) == 0x7F000001) {  // 127.0.0.1
    printf("From localhost\n");
}
```

**ะ ะผะธััะธะธ (ะบะพััะตะบัะฝัะน ะบะพะด):**
```c
struct in_addr src_addr;
src_addr.s_addr = ip->saddr;
char src_ip[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &src_addr, src_ip, INET_ADDRSTRLEN);

// ะขะตะฟะตัั ะผะพะถะฝะพ ััะฐะฒะฝะธะฒะฐัั ัััะพะบะธ
printf("From: %s\n", src_ip);
```

**ะฃัะพะบ:** ะัะตะณะดะฐ ะธัะฟะพะปัะทัะนัะต `inet_ntop`/`inet_pton` ะดะปั ะบะพะฝะฒะตััะฐัะธะธ IP!
</details>

---

### ๐ฏ ะกัะถะตั (2 ะฒะพะฟัะพัะฐ)

**13. ะ 20:15 V. ะฝะฐะฟะธัะฐะป: "ะะฝะธ ัะปะตะดัั ะทะฐ ัะพะฑะพะน. ะะพ ัะตะฟะตัั ะขะซ ัะปะตะดะธัั ะทะฐ ะฝะธะผะธ." ะะฐะบ ััะพ ะฒะพะทะผะพะถะฝะพ โ ะฒะทะฐะธะผะฝัะน ะฟะตัะตัะฒะฐั?**

<details>
<summary>ะัะฒะตั</summary>

**ะะฑะฐ ะธัะฟะพะปัะทััั packet sniffing ะฒ ะพะดะฝะพะน ัะตัะธ = ะฒะทะฐะธะผะฝะฐั ะฟัะพะทัะฐัะฝะพััั!**

**ะกัะตะฝะฐัะธะน:**
```
         SAFE HOUSE NETWORK
         
    ะะซ                      ะะะะะขะซ Z.
    ๐ฑ                         ๐ค
     โ                         โ
     โโโ> packet_sniffer       โโโ> packet_sniffer
     โ    (ะฟะตัะตัะฒะฐั ะฟะพััะฐ 9999)โ    (ะฟะตัะตัะฒะฐั ะะกะะฅ ะฟะพััะพะฒ)
     โ                         โ
     โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
              โ
          [WiFi Router]
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**

1. **ะะณะตะฝัั Z. ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจ ััะฐัะธะบ:**
   - ะะธะดัั ะฒะฐัะธ ะฟะพะดะบะปััะตะฝะธั ะบ ัะตัะฒะตัั V. (Episode 10)
   - ะฃะทะฝะฐัั ะฒะฐัะธ ะบะพะพัะดะธะฝะฐัั ัะตัะตะท GPS ะฒ IP
   - ะััะปะตะถะธะฒะฐัั ะฒะฐัะธ ะดะตะนััะฒะธั

2. **ะะซ ะฟะตัะตัะฒะฐััะฒะฐะตัะต ะะฅ ััะฐัะธะบ:**
   - ะะธะดะธัะต ะธั ะบะพะผะผัะฝะธะบะฐัะธั ะฝะฐ ะฟะพััั 9999
   - ะฃะทะฝะฐััะต, ััะพ ะพะฝะธ ะทะฝะฐัั ะพ ะฒะฐั
   - ะะพะปััะฐะตัะต ะธะฝัะต ะพ ัะปะตะดัััะตะผ ัะทะปะต

**ะขะตัะฝะธัะตัะบะธ:**
```c
// ะะฐั sniffer:
if (ntohs(tcp->source) == 9999 || ntohs(tcp->dest) == 9999) {
    // ะะฐะบะตัั ะฐะณะตะฝัะพะฒ Z.!
}

// ะั sniffer:
if (ntohs(tcp->source) == 31337 || ntohs(tcp->dest) == 31337) {
    // ะะฐะบะตัั ะบ ัะตัะฒะตัั V.!
}
```

**ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั:**
- Shared medium (WiFi, Ethernet hub)
- Promiscuous mode ะฒะธะดะธั ะฒัั
- ะจะธััะพะฒะฐะฝะธั ะฝะตั โ ะฒัั ะฒ plaintext

**ะะฐัะธัะฐ:**
- VPN (ะทะฐัะธัััะตั ะฒะตัั ััะฐัะธะบ)
- TLS/SSL (Episode 12)
- ะคะธะทะธัะตัะบะฐั ะธะทะพะปััะธั (ะดััะณะฐั ัะตัั)

**ะฃัะพะบ:** ะ ะพัะบัััะพะน ัะตัะธ ะฒัะต ะฒะธะดัั ะฒัะตั. ะจะธััะพะฒะฐะฝะธะต ะพะฑัะทะฐัะตะปัะฝะพ.
</details>

**14. ะั ะฟะตัะตัะฒะฐัะธะปะธ "Next node: 10.0.0.1:4433" ะฒ ะฟะฐะบะตัะต ะฐะณะตะฝัะพะฒ Z. ะะพัะตะผั ััะพ ะฒะฐะถะฝะพ ะดะปั Episode 12?**

<details>
<summary>ะัะฒะตั</summary>

**ะญัะพ ะะะะขะะะะะะะะะ ะฐะดัะตัะฐ ัะปะตะดัััะตะณะพ ัะทะปะฐ ะพั V.!**

**ะงัะพ ะฟัะพะธะทะพัะปะพ:**

**Episode 10:**
```
10:51 โ ะะพะดะบะปััะธะปะธัั ะบ ัะตัะฒะตัั V. (203.0.113.42:31337)
        ะะพะปััะธะปะธ: "ะกะปะตะดัััะธะน ัะทะตะป: 10.0.0.1:4433"
```

**Episode 11:**
```
20:30 โ ะะตัะตัะฒะฐัะธะปะธ ะฟะฐะบะตั ะฐะณะตะฝัะพะฒ Z.:
        "Next node: 10.0.0.1:4433"
        "Protocol: Encrypted TCP"
        "Objective: Intercept encrypted stream"
```

**ะะฝะฐะปะธะท:**
1. **V. ะดะฐะป ะฐะดัะตั:** 10.0.0.1:4433
2. **ะะณะตะฝัั Z. ะขะะะ ะทะฝะฐัั ะฐะดัะตั:** 10.0.0.1:4433
3. **ะะฝะฐัะธั:** ะะฝะธ ัะพะถะต ะฟััะฐัััั ะฟะพะดะบะปััะธัััั!

**ะะพัะตะผั ะฒะฐะถะฝะพ:**
- ะะพะดัะฒะตัะถะดะตะฝะธะต: ะฐะดัะตั ะฟัะฐะฒะธะปัะฝัะน
- ะะฟะฐัะฝะพััั: ะฐะณะตะฝัั Z. ะฝะฐ ัะพะผ ะถะต ะฟััะธ
- ะะฐะดะฐัะฐ Episode 12: ะฟะตัะตัะฒะฐัะธัั ะทะฐัะธััะพะฒะฐะฝะฝัะน ะฟะพัะพะบ ะะซะกะขะะะ ะฝะธั

**ะ Episode 12:**
```
02:12 โ V.: "ะะตัะตัะฒะฐัะธัั TCP-ะฟะพัะพะบ ะฝะฐ 10.0.0.1:4433"
        "ะะฐััะธััะพะฒะฐัั XOR"
        "ะฃะทะฝะฐัั ะบะพะพัะดะธะฝะฐัั ะฒัััะตัะธ"
        
โ ะั ะดะพะปะถะฝั ััะฟะตัั ะะ ะฐะณะตะฝัะพะฒ Z.!
```

**ะกัะถะตัะฝะฐั ะปะธะฝะธั:**
```
Episode 09: ะะฐัะปะธ IP 203.0.113.42 (GPS โ ะัะฐัะฝะฐั ะฟะปะพัะฐะดั)
Episode 10: ะะพะดะบะปััะธะปะธัั ะบ 203.0.113.42:31337 (ะฟะพะปััะธะปะธ ัะทะตะป 2)
Episode 11: ะะพะดัะฒะตัะดะธะปะธ ัะทะตะป 2 ัะตัะตะท ะฟะตัะตัะฒะฐั ะฐะณะตะฝัะพะฒ Z.
Episode 12: ะะฐััะธัััะตัะต ัะทะตะป 2 โ ะฒัััะตัะฐ ั V. ะฝะฐ ะัะฐัะฝะพะน ะฟะปะพัะฐะดะธ
```

**ะฃัะพะบ:** Packet sniffing ะดะฐัั ัะฐะทะฒะตะดะดะฐะฝะฝัะต ะพ ะฟะปะฐะฝะฐั ะฟัะพัะธะฒะฝะธะบะฐ.
</details>

---

### ๐ ะัะพะดะฒะธะฝัััะต (1 ะฒะพะฟัะพั)

**15. ะ ััะถะตัะต ะฐะณะตะฝัั Z. ะทะฝะฐัั ะบะพะพัะดะธะฝะฐัั safe house (55.7520ยฐN 37.6175ยฐE). ะะพะณะปะธ ะปะธ ะพะฝะธ ะฒััะธัะปะธัั ััะพ ะธะท ะฟะตัะตัะฒะฐัะตะฝะฝัั ะฟะฐะบะตัะพะฒ?**

<details>
<summary>ะัะฒะตั</summary>

**ะะฐ! ะงะตัะตะท ะบะพััะตะปััะธั ััะฐัะธะบะฐ, timing ะฐะฝะฐะปะธะท ะธ geolocation!**

**ะกะฟะพัะพะฑั:**

**1. GPS ะฒ ะฟะฐะบะตัะฐั (ะตัะปะธ ะฒั ะธั ะพัะฟัะฐะฒะปัะปะธ):**
```c
// ะะฐั ะบะพะด (ะณะธะฟะพัะตัะธัะตัะบะธ):
char msg[100];
snprintf(msg, sizeof(msg), "Status: Active at %f,%f", lat, lon);
send(sockfd, msg, strlen(msg), 0);

// ะะณะตะฝัั Z. ะฟะตัะตัะฒะฐััะฒะฐัั โ ะฒะธะดัั ะบะพะพัะดะธะฝะฐัั!
```

**2. Timing analysis (ะทะฐะดะตัะถะบะธ ะฟะฐะบะตัะพะฒ):**
```
ะั โ ะกะตัะฒะตั V. (203.0.113.42)
ะะฐะดะตัะถะบะฐ RTT: 45 ms

ะะณะตะฝัั Z. ะฐะฝะฐะปะธะทะธัััั:
- RTT 45ms โ ะฟัะธะผะตัะฝะพ 1000 ะบะผ ะพั ัะตัะฒะตัะฐ
- ะกะตัะฒะตั ะฒ ะะพัะบะฒะต โ ะฒั ัะพะถะต ะฒ ะะพัะบะฒะต
- ะกัะถะตะฝะธะต ะบััะณะฐ ะฟะพะธัะบะฐ
```

**3. WiFi triangulation:**
```bash
# ะะณะตะฝัั Z. ัะบะฐะฝะธัััั WiFi:
$ iwlist wlan0 scan

ESSID: "SafeHouse_Guest"
MAC: AA:BB:CC:DD:EE:FF
Signal: -45 dBm  โ ะัะตะฝั ะฑะปะธะทะบะพ!

# Trilateration ั ะฝะตัะบะพะปัะบะธั ัะพัะตะบ:
โ ะััะธัะปััั ะผะตััะพะฟะพะปะพะถะตะฝะธะต ัะพััะตัะฐ
โ ะะพะพัะดะธะฝะฐัั safe house
```

**4. IP Geolocation:**
```bash
$ curl "http://ip-api.com/json/YOUR_PUBLIC_IP"

{
  "lat": 55.7520,
  "lon": 37.6175,
  "city": "Moscow",
  "district": "Arbat"
}
```

**5. Traffic correlation:**
```
19:46 โ ะะฐั ะฟะฐะบะตั ะบ V.: ะพัะฟัะฐะฒะปะตะฝ
19:46 โ ะะฐะบะตั Z.: "Target confirmed. Location: Safe house."

ะะพััะตะปััะธั ะฒัะตะผะตะฝะธ โ ะฒั ะฒ safe house!
```

**6. MAC ะฐะดัะตั ะฒะฐัะตะณะพ ััััะพะนััะฒะฐ:**
```c
// ะ Ethernet frame:
struct ether_header {
    uint8_t ether_dhost[6];  // MAC ะฝะฐะทะฝะฐัะตะฝะธั
    uint8_t ether_shost[6];  // ะะะจ MAC!
    uint16_t ether_type;
};

// ะะณะตะฝัั Z. ะฒะธะดัั ะฒะฐั MAC
// โ ะะฐะทะฐ ะดะฐะฝะฝัั ะฟัะพะธะทะฒะพะดะธัะตะปะตะน
// โ ะะพะดะตะปั ััััะพะนััะฒะฐ
// โ ะะพะทะผะพะถะฝะพ, ะธััะพัะธั ะฟะตัะตะผะตัะตะฝะธะน (ะตัะปะธ WiFi)
```

**ะะฐัะธัะฐ:**

```c
// 1. VPN (ัะบััะฒะฐะตั ัะตะฐะปัะฝัะน IP)
sudo openvpn moonlight.ovpn

// 2. Tor (ะฐะฝะพะฝะธะผะฝะพััั)
torify ./moonlight_client

// 3. MAC randomization
sudo ifconfig wlan0 hw ether DE:AD:BE:EF:CA:FE

// 4. ะจะธััะพะฒะฐะฝะธะต (TLS/SSL)
// ะะพะพัะดะธะฝะฐัั ะฝะต ะฒะธะดะฝั ะฒ plaintext

// 5. ะคะธะทะธัะตัะบะฐั ัะผะตะฝะฐ ะปะพะบะฐัะธะธ
// ะะตัะตะตัะฐัั ะธะท safe house!
```

**ะ ะผะธััะธะธ:**
- ะั ะะ ะธัะฟะพะปัะทะพะฒะฐะปะธ VPN
- ะะณะตะฝัั Z. ะฒ ัะพะน ะถะต ัะตัะธ
- Perะตัะฒะฐัะธะปะธ ััะฐัะธะบ โ ะฒััะธัะปะธะปะธ ะบะพะพัะดะธะฝะฐัั
- **ะะตะทัะปััะฐั:** Safe house ัะบะพะผะฟัะพะผะตัะธัะพะฒะฐะฝ

**ะฃัะพะบ:** ะะตัะฐะดะฐะฝะฝัะต (timing, geolocation, MAC) ะผะพะณัั ัะฐัะบัััั ะผะตััะพะฟะพะปะพะถะตะฝะธะต ะดะฐะถะต ะฑะตะท GPS ะฒ payload.
</details>

---

**๐ ะัะตะฝะบะฐ:**
- **13-15 ะฟัะฐะฒะธะปัะฝัั** โ Packet Master! ะะพัะพะฒั ะบ Episode 12 โ
- **10-12 ะฟัะฐะฒะธะปัะฝัั** โ ะฅะพัะพัะพ, ะฝะพ ะฟะพะฒัะพัะธัะต promiscuous mode ๐
- **< 10 ะฟัะฐะฒะธะปัะฝัั** โ ะะตัะตัะธัะฐะนัะต Episode 11 ะธ ะฟะพะฟัะพะฑัะนัะต packet sniffer ๐

---

## ๐ฅ Easter Eggs

<details>
<summary>๐ ะัััะปะบะธ ะธ ัะตะบัะตัั</summary>

**ะะตััะพะฝะฐะถะธ ะธ ััะถะตั:**

1. **"ะัะธะทัะฐะบ" = ะะปะตะบั ะกะพะบะพะปะพะฒ** (20:18) โ ะกะะะะ ะะะะะะ ัะฐัะบัััะธะต Season 3!
   - Ex-FSB, ะฃะฟัะฐะฒะปะตะฝะธะต 'K' (ะบะพะฝัััะฐะทะฒะตะดะบะฐ) โ ัะตะฐะปัะฝะพะต ะฟะพะดัะฐะทะดะตะปะตะฝะธะต ะคะกะ
   - 5 ะปะตั ะธัะบะฐะป ะะธะบัะพัะฐ โ 6 ะผะตัััะตะฒ ะฝะฐะทะฐะด ะฟะตัะตััะป ะฝะฐ ะตะณะพ ััะพัะพะฝั
   - ะขะตะฟะตัั ัะฐััั ะบะพะผะฐะฝะดั (Season 4-10!)

2. **ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ** (20:20) โ forensics specialist:
   - ะะฐะฑะพัะฐะปะฐ ั ะะธะบัะพัะพะผ 2 ะณะพะดะฐ ะฝะฐะทะฐะด (ะดะพ ัะพะฑััะธะน Season 1)
   - ะะตัะฐะปะธ ัะปะตะถะบะธ: Lada Granta X999XX77 (ัะตะฐะปะธััะธัะฝัะน ะฝะพะผะตั)
   - 100ะผ ะพั ะฟะพะดัะตะทะดะฐ, ัะผะตะฝะฐ ะบะฐะถะดัะต 6 ัะฐัะพะฒ (ะฟัะพัะตััะธะพะฝะฐะปัะฝะฐั ัะปะตะถะบะฐ)

3. **ะะพะปะบะพะฒะฝะธะบ ะััะปะพะฒ** โ ะฟะตัะฒะพะต ะะะฏะะะ ะฟัะพัะธะฒะพััะพัะฝะธะต:
   - ะัะฒัะธะน ะฝะฐัะฐะปัะฝะธะบ ะะปะตะบัะฐ (ะปะธัะฝะฐั ะดัะฐะผะฐ!)
   - ETA 22:00 = 2 ัะฐัะฐ ะดะพ ะฟัะธะฑััะธั (deadline!)
   - "Capture alive" = ะฒั ัะตะฝะฝั ะดะปั ะฝะธั (ะฝะต ัะฑััั!)

4. **ะะพะพัะดะธะฝะฐัั 55.7520ยฐN 37.6175ยฐE** โ ะะะจะ ะะะะะฆะะฏ:
   - ะะฐัััะพัะฝะธะต ะพั Episode 09 (55.7558ยฐN 37.6173ยฐE = ะัะฐัะฝะฐั ะฟะปะพัะฐะดั): ~500ะผ!
   - Safe house ััะดะพะผ ั ะัะฐัะฝะพะน ะฟะปะพัะฐะดัั (ัะตะฝัั ะะพัะบะฒั)
   - ะััะปะพะฒ ะทะฝะฐะตั ัะพัะฝะพะต ะผะตััะพะฟะพะปะพะถะตะฝะธะต!

5. **ะะทะฐะธะผะฝะฐั ัะปะตะถะบะฐ** โ "ะัะพัะฝะธะบ ััะฐะฝะพะฒะธััั ะดะพะฑััะตะน":
   - ะั ะฟะตัะตัะฒะฐััะฒะฐะตัะต ะะฅ ะฟะฐะบะตัั
   - ะะะ ะฟะตัะตัะฒะฐััะฒะฐัั ะะะจะ ะฟะฐะบะตัั
   - ะะฝัะพัะผะฐัะธะพะฝะฝะฐั ะฒะพะนะฝะฐ (ะบัะพ ะบะพะณะพ ะฟะตัะตะธะณัะฐะตั?)

**ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ:**

6. **Raw sockets** โ ะพัะฝะพะฒะฐ Wireshark, tcpdump, Snort (ัะตะฐะปัะฝัะต ะธะฝััััะผะตะฝัั)
7. **Port 9999** โ ัะฐััะพ ะฒ ะผะฐะปะฒะฐัะฐั (backdoor port)
8. **10.0.0.1** โ private IP ะบะปะฐััะฐ A, ะฒะฝัััะตะฝะฝัั ัะตัั
9. **Promiscuous mode** โ ัะตัะผะธะฝ ะธะท ัะฐะดะธะพะฟะตัะตัะฒะฐัะฐ (ะฟัะธะฝะธะผะฐัั ะฒัั)
10. **struct iphdr** โ ะฟััะผะพะน ะดะพัััะฟ ะบ ัะตัะตะฒะพะผั ััะตะบั Linux
11. **PSH flag** โ "push", ะฝะตะผะตะดะปะตะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ (ะธะฝัะตัะฐะบัะธะฒะฝัะน ััะฐัะธะบ)
12. **ะกะะะ** โ ัะตะฐะปัะฝะฐั ัะพััะธะนัะบะฐั ัะธััะตะผะฐ ะพะฟะตัะฐัะธะฒะฝะพ-ัะพะทััะบะฝัั ะผะตัะพะฟัะธััะธะน (SORM)
13. **ะฃะฟัะฐะฒะปะตะฝะธะต 'K'** โ ัะตะฐะปัะฝะพะต ะฟะพะดัะฐะทะดะตะปะตะฝะธะต ะคะกะ (ะบะพะฝัััะฐะทะฒะตะดะบะฐ)
14. **Hex dump format** โ ะบะปะฐััะธัะตัะบะธะน ัะพัะผะฐั ะธะท `hexdump -C`
15. **ETA 22:00** โ 2 ัะฐัะฐ = ัะพัะฝัะน timing ะดะปั ัะฒะฐะบัะฐัะธะธ ะฒ Episode 12!

**ะกัะถะตัะฝัะต ัะฒัะทะธ:**

16. **ะะปะตะบั ะกะพะบะพะปะพะฒ** โ ะฑัะดะตั ะบะปััะตะฒัะผ ะฒ Season 4-10:
   - Season 4: ะฟะพะผะพัั ั ะบัะธะฟัะพะณัะฐัะธะตะน (ex-FSB ะพะฟัั)
   - Season 6: ะฐะฒะธะพะฝะธะบะฐ + embedded (ัะฒัะทั ั ะะผะธััะธะตะผ!)
   - Season 10: ัะธะฝะฐะปัะฝะฐั ะพะฟะตัะฐัะธั (ะฒัะต ัะพัะทะฝะธะบะธ ะฒะผะตััะต!)

17. **ะััะปะพะฒ vs ะัะธะทัะฐะบ** โ ะปะธัะฝะฐั ะฒะตะฝะดะตััะฐ:
   - ะัะฒัะธะน ะฝะฐัะฐะปัะฝะธะบ vs ะฑัะฒัะธะน ะฟะพะดัะธะฝัะฝะฝัะน
   - ะัะดะตั ัะฐะทะฒะธะฒะฐัััั ะฒ Season 4-10

18. **ะะฝะฝะฐ** โ ะฟะพัะฒะธััั ัะฝะพะฒะฐ:
   - Season 2 Ep08 (?) โ ะฒะพะทะผะพะถะฝะพ ัะฟะพะผะธะฝะฐะฝะธะต
   - Season 4+ โ forensics ัะบัะฟะตัั ะบะพะผะฐะฝะดั

**ะคะธะปะพัะพัะธั ัะฟะธะทะพะดะฐ**: *"ะกะตัั ะฟัะพะทัะฐัะฝะฐ ะดะปั ัะตั, ะบัะพ ะทะฝะฐะตั, ะบะฐะบ ัะผะพััะตัั. Raw socket โ ััะพ ัะตะฝัะณะตะฝ. ะะพ ะบะฐะถะดัะน ะพัะพัะฝะธะบ ะผะพะถะตั ััะฐัั ะดะพะฑััะตะน."*

**Accumulating Cast:**
- Season 1 โ ะะธะบัะพั, ะะผะธััะธะน, "ะัะธะทัะฐะบ" (UNKNOWN), ะััะปะพะฒ (ัะฟะพะผะธะฝะฐะฝะธะต)
- Season 2 โ ะะธะบัะพั, ะะผะธััะธะน, ะะฝะฝะฐ ะะพะฒะฐะปัะฒะฐ (?)
- Season 3 Ep11 โ "ะัะธะทัะฐะบ" ะะะกะะะซะข! + ะะฝะฝะฐ + ะััะปะพะฒ (ะฐะบัะธะฒะฝะฐั ัะพะปั)
- ะะตััะพะฝะฐะถะธ ะฝะฐะบะฐะฟะปะธะฒะฐัััั ะธ ะฒะพะทะฒัะฐัะฐัััั!

</details>

---

## ๐ ะะฐะฒะธะณะฐัะธั

- [โ Episode 10: Socket Programming](../episode-10-socket-programming/README.md)
- [โ Episode 12: Encrypted Communications](../episode-12-encrypted-communications/README.md)
- [๐ Season 3: Networks](../README.md)
- [๐ ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ](../../README.md)

---

> *"In the network, everything is visible. You just need to know where to look."* โ V.