# Episode 11: "Packet Analysis" üì°

> *"Every packet tells a story. Learn to listen."*

---

## üé¨ BRIEFING

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  –õ–û–ö–ê–¶–ò–Ø: Safe House (–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–¥—Ä–µ—Å), –ú–æ—Å–∫–≤–∞        ‚ïë
‚ïë  –í–†–ï–ú–Ø:   18:20, —Å—Ä–µ–¥–∞, 1 –æ–∫—Ç—è–±—Ä—è                       ‚ïë
‚ïë  –°–¢–ê–¢–£–°:  üî¥ COUNTER-SURVEILLANCE DETECTED!              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É V., –≤—ã –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø.  
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞: `10.0.0.1:4433`.

**–ù–æ –≤ 18:17 —Å–∏—Ç—É–∞—Ü–∏—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è.**

–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç V.:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FROM: V. (ENCRYPTED CHANNEL)               ‚îÇ
‚îÇ  TIME: 18:17:42 UTC                         ‚îÇ
‚îÇ  PRIORITY: üî¥ CRITICAL                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                             ‚îÇ
‚îÇ  –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è ‚Äî —ç—Ç–æ –ø–æ–ª–¥–µ–ª–∞.                ‚îÇ
‚îÇ  –ù–∞—Å—Ç–æ—è—â–∞—è –∏–≥—Ä–∞ ‚Äî –ü–ï–†–ï–•–í–ê–¢.                 ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ù–∞ —Ç–≤–æ—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏–¥—ë—Ç —Ç—Ä–∞—Ñ–∏–∫.           ‚îÇ
‚îÇ  –ê–≥–µ–Ω—Ç—ã Z. –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ 9999.    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚ö†Ô∏è –û–ü–ê–°–ù–û–°–¢–¨:                              ‚îÇ
‚îÇ  –û–Ω–∏ –¢–û–ñ–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç packet sniffing!       ‚îÇ
‚îÇ  –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ —É–∂–µ –∑–Ω–∞—é—Ç –æ safe house.      ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ó–ê–î–ê–ß–ê:                                    ‚îÇ
‚îÇ  –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏—Ö TCP –ø–∞–∫–µ—Ç—ã –Ω–∞ –ø–æ—Ä—Ç—É 9999    ‚îÇ
‚îÇ  –ò–∑–≤–ª–µ—á—å payload –∏–∑ –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞          ‚îÇ
‚îÇ  –ù–∞–π—Ç–∏: —á—Ç–æ –æ–Ω–∏ –∑–Ω–∞—é—Ç –æ —Ç–µ–±–µ?               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ò—Å–ø–æ–ª—å–∑—É–π RAW SOCKETS.                     ‚îÇ
‚îÇ  –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∏–¥–µ—Ç—å –í–°–Å.        ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è ROOT –ø—Ä–∞–≤–∞ (sudo)             ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω. –û—Ö–æ—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å        ‚îÇ
‚îÇ  –¥–æ–±—ã—á–µ–π.                                   ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚Äî V.                                       ‚îÇ
‚îÇ                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‚è±Ô∏è –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

```
18:17 ‚Üí üìß –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç V.: –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∞–≥–µ–Ω—Ç–æ–≤ Z.
        –ü–æ—Ä—Ç 9999 ‚Äî –∏—Ö –∫–∞–Ω–∞–ª –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
        
18:20 ‚Üí üîç –ó–∞–ø—É—Å–∫ netstat –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        $ netstat -an | grep 9999
        
        Active Internet connections:
        TCP  127.0.0.1:9999   127.0.0.1:54321  ESTABLISHED
        TCP  127.0.0.1:54321  127.0.0.1:9999   ESTABLISHED
        
        üí° –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: –ê–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è!
        
18:25 ‚Üí üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ packet sniffer
        –ò–∑—É—á–µ–Ω–∏–µ raw sockets, struct iphdr, struct tcphdr
        
19:45 ‚Üí üöÄ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ packet_sniffer
        $ sudo ./packet_sniffer
        
        Listening on all interfaces...
        Filtering for port 9999
        
19:46 ‚Üí üì° –ü–ï–†–í–´–ô –ü–ê–ö–ï–¢ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω!
        From: 127.0.0.1:54321 ‚Üí 127.0.0.1:9999
        Protocol: TCP, Flags: PSH ACK
        Payload (48 bytes):
        "Target confirmed. Location: Safe house."
        
19:47 ‚Üí üö® –í–¢–û–†–û–ô –ü–ê–ö–ï–¢ ‚Äî –®–û–ö–ò–†–£–Æ–©–ï–ï –°–û–î–ï–†–ñ–ê–ù–ò–ï!
        From: 127.0.0.1:9999 ‚Üí 127.0.0.1:54321
        Payload (64 bytes):
        "Coordinates: 55.7520¬∞N 37.6175¬∞E"
        "Status: Under surveillance"
        "Agent count: 1"
        
        üíÄ –≠–¢–û –ö–û–û–†–î–ò–ù–ê–¢–´ –í–ê–®–ï–ì–û SAFE HOUSE!!!
        
19:48 ‚Üí ‚ö†Ô∏è –¢–†–ï–¢–ò–ô –ü–ê–ö–ï–¢:
        "Order: Continue monitoring. Do not engage."
        "Report to HQ every 30 minutes."
        
20:00 ‚Üí üí° –û–°–û–ó–ù–ê–ù–ò–ï:
        –ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ Z. –¢–û–ñ–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç packet sniffing!
        –û–Ω–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –í–ê–® —Ç—Ä–∞—Ñ–∏–∫!
        "–û—Ö–æ—Ç–Ω–∏–∫" —Å—Ç–∞–ª "–¥–æ–±—ã—á–µ–π"...
        
20:15 ‚Üí üìû SMS –æ—Ç V.:
        "–û–Ω–∏ —Å–ª–µ–¥—è—Ç –∑–∞ —Ç–æ–±–æ–π.
         –ù–æ —Ç–µ–ø–µ—Ä—å –¢–´ —Å–ª–µ–¥–∏—à—å –∑–∞ –Ω–∏–º–∏.
         –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–æ–π–Ω–∞.
         –ü—Ä–æ–¥–æ–ª–∂–∞–π –ø–µ—Ä–µ—Ö–≤–∞—Ç."
         
20:30 ‚Üí üéØ –ß–ï–¢–í–Å–†–¢–´–ô –ü–ê–ö–ï–¢ ‚Äî –ö–õ–Æ–ß–ï–í–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
        "Next node: 10.0.0.1:4433"
        "Protocol: Encrypted TCP"
        "Objective: Intercept encrypted stream"
        
        ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞!
        (–¢–æ—Ç –∂–µ –∞–¥—Ä–µ—Å, —á—Ç–æ –¥–∞–ª V. ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!)
        
22:35 ‚Üí ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç –∑–∞–≤–µ—Ä—à—ë–Ω
        –ò–∑–≤–ª–µ—á–µ–Ω–æ: 127 –ø–∞–∫–µ—Ç–æ–≤
        –°–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ
        Episode 11 Complete
```

–í—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ `netstat`:

```
Active Internet connections
Proto Local Address    Foreign Address    State
TCP   127.0.0.1:9999   127.0.0.1:54321   ESTABLISHED
TCP   127.0.0.1:54321  127.0.0.1:9999    ESTABLISHED
```

**–ß—Ç–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ:**
- –ù–∞ –ø–æ—Ä—Ç—É **9999** –∏–¥—ë—Ç –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è **–∞–≥–µ–Ω—Ç–æ–≤ Z.**
- –û–±—ã—á–Ω—ã–µ —Å–æ–∫–µ—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ **–≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- **Raw sockets** –≤–∏–¥—è—Ç **–≤—Å–µ –ø–∞–∫–µ—Ç—ã** –Ω–∞ —Å–µ—Ç–µ–≤–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ù—É–∂–Ω–æ **–ø–∞—Ä—Å–∏—Ç—å IP –∏ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∏** –≤—Ä—É—á–Ω—É—é
- –ò–∑–≤–ª–µ—á—å **payload** (–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
- **–ö–†–ò–¢–ò–ß–ù–û**: –í –ø–∞–∫–µ—Ç–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –í–ê–®–ï–ú –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏!
- **"–û—Ö–æ—Ç–Ω–∏–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ–±—ã—á–µ–π"** ‚Äî –≤–∑–∞–∏–º–Ω–∞—è —Å–ª–µ–∂–∫–∞

–≠—Ç–æ –º–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã. –í—Ä–µ–º—è —Å—Ç–∞—Ç—å **packet sniffer** –∏ —É–∑–Ω–∞—Ç—å, —á—Ç–æ –≤—Ä–∞–≥–∏ –∑–Ω–∞—é—Ç –æ –≤–∞—Å.

### üéØ –ó–ê–î–ê–ß–ê

–°–æ–∑–¥–∞—Ç—å **`packet_sniffer`** ‚Äî –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–µ—Ç–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å raw socket (SOCK_RAW)
2. ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ TCP –ø–∞–∫–µ—Ç—ã
3. ‚úÖ –ü–∞—Ä—Å–∏—Ç—å IP –∑–∞–≥–æ–ª–æ–≤–æ–∫ (source, dest, protocol)
4. ‚úÖ –ü–∞—Ä—Å–∏—Ç—å TCP –∑–∞–≥–æ–ª–æ–≤–æ–∫ (ports, flags, seq)
5. ‚úÖ –ò–∑–≤–ª–µ–∫–∞—Ç—å payload (–¥–∞–Ω–Ω—ã–µ)
6. ‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä—Ç—É 9999
7. ‚úÖ Hex dump –ø–∞–∫–µ—Ç–æ–≤
8. ‚úÖ –ù–∞–π—Ç–∏ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ Hard  
**–ù–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏:** Raw sockets, packet sniffing, header parsing, hex dump

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  [!] –í–ù–ò–ú–ê–ù–ò–ï:                               ‚ïë
‚ïë  Raw sockets ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.            ‚ïë
‚ïë  –í—ã –≤–∏–¥–∏—Ç–µ –í–°–Å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.    ‚ïë
‚ïë  –¢—Ä–µ–±—É–µ—Ç—Å—è sudo (root –ø—Ä–∞–≤–∞).                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üé≠ –ú–ï–¢–ê–§–û–†–ê: Packet Sniffing = –ü–æ–¥—Å–ª—É—à–∏–≤–∞—é—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

**–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ:**  
–í—ã —Å–∏–¥–∏—Ç–µ –≤ –∫–∞—Ñ–µ. –í–æ–∫—Ä—É–≥ –º–Ω–æ–≥–æ –ª—é–¥–µ–π, –∏ –≤—Å–µ –æ–Ω–∏ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç. –û–±—ã—á–Ω–æ –≤—ã —Å–ª—ã—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ–ª–æ—Å–∞ ‚Äî —Ñ–æ–Ω–æ–≤—ã–π —à—É–º.

**–ù–û:** –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å **–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω** (–ø–æ–¥—Å–ª—É—à–∏–≤–∞—é—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ), –≤—ã –º–æ–∂–µ—Ç–µ:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å—Å—è –Ω–∞ **–ª—é–±–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä** –≤ –∫–∞—Ñ–µ
- –°–ª—ã—à–∞—Ç—å **–≤–µ—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä** —Ü–µ–ª–∏–∫–æ–º
- **–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å** –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ
- **–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å** –ø–æ –≥–æ–ª–æ—Å—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –º—É–∂—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞)

**–í —Å–µ—Ç–∏:**

```
–û–±—ã—á–Ω—ã–π TCP —Å–æ–∫–µ—Ç (socket()):
‚îú‚îÄ –í—ã ‚Üí –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ (203.0.113.42:31337)
‚îî‚îÄ –°–ª—ã—à–∏—Ç–µ –¢–û–õ–¨–ö–û –≤–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä
   ‚ùå –î—Ä—É–≥–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –Ω–µ –≤–∏–¥–Ω—ã

Raw socket (SOCK_RAW):
‚îú‚îÄ –í—ã ‚Üí –í–°–Ø –°–ï–¢–¨
‚îú‚îÄ –°–ª—ã—à–∏—Ç–µ –í–°–ï —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –Ω–∞ –≤–∞—à–µ–º —Å–µ–≥–º–µ–Ω—Ç–µ —Å–µ—Ç–∏!
‚îÇ   ‚îú‚îÄ 192.168.1.50 ‚Üí 8.8.8.8:53 (DNS –∑–∞–ø—Ä–æ—Å)
‚îÇ   ‚îú‚îÄ 192.168.1.100 ‚Üí 203.0.113.42:31337 (–≤–∞—à —Ç—Ä–∞—Ñ–∏–∫)
‚îÇ   ‚îî‚îÄ 192.168.1.150 ‚Üí 10.0.0.1:9999 (–∞–≥–µ–Ω—Ç—ã Z.!)
‚îî‚îÄ ‚úÖ –ú–æ–∂–µ—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ IP/–ø–æ—Ä—Ç—É/–ø—Ä–æ—Ç–æ–∫–æ–ª—É
```

**ASCII-–¥–∏–∞–≥—Ä–∞–º–º–∞:**

```
         –ö–ê–§–ï (–°–ï–¢–¨ 192.168.1.0/24)
         
  [–°—Ç–æ–ª 1]        [–°—Ç–æ–ª 2]        [–°—Ç–æ–ª 3]
  A ‚Üî B           C ‚Üî D           –í–´ ‚Üî V.
  (DNS)           (HTTPS)         (TCP:31337)
    ‚Üì               ‚Üì               ‚Üì
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
            [–ü–æ–¥—Å–ª—É—à–∏–≤–∞—é—â–µ–µ
             —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ]
             (Raw socket)
                    ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ  –í—ã —Å–ª—ã—à–∏—Ç–µ:    ‚îÇ
           ‚îÇ  ‚úì A ‚Üí B        ‚îÇ
           ‚îÇ  ‚úì C ‚Üí D        ‚îÇ
           ‚îÇ  ‚úì –í–´ ‚Üî V.      ‚îÇ
           ‚îÇ  ‚úì –ê–≥–µ–Ω—Ç—ã Z.!   ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ù–û! –ê–≥–µ–Ω—Ç—ã Z. —Ç–æ–∂–µ –∏–º–µ—é—Ç –ø–æ–¥—Å–ª—É—à–∏–≤–∞—é—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
  ‚Üí –û–Ω–∏ —Å–ª—ã—à–∞—Ç –í–ê–® —Ç—Ä–∞—Ñ–∏–∫!
  ‚Üí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–æ–π–Ω–∞ (–≤–∑–∞–∏–º–Ω—ã–π sniffing)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **Ethernet = —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞:**
   - –í—Å–µ –ø–∞–∫–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è **–≤—Å–µ–º** —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–µ
   - –û–±—ã—á–Ω–æ: –≤–∞—à–∞ —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ **–æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç** —á—É–∂–∏–µ –ø–∞–∫–µ—Ç—ã
   - Raw socket: –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–µ **–ù–ï –æ—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å** ‚Üí –≤–∏–¥–∏—Ç–µ –≤—Å—ë!

2. **Promiscuous mode:**
   ```c
   // –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:
   NIC: "–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –Ω–µ –¥–ª—è –º–µ–Ω—è (dest MAC != –º–æ–π MAC) ‚Üí –æ—Ç–±—Ä–æ—Å–∏—Ç—å"
   
   // Promiscuous mode:
   NIC: "–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –Ω–µ –¥–ª—è –º–µ–Ω—è ‚Üí –í–°–Å –†–ê–í–ù–û –ü–†–ò–ù–Ø–¢–¨ –∏ –æ—Ç–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é!"
   ```

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
   ```c
   // –í—Å–µ –ø–∞–∫–µ—Ç—ã ‚Üí —Ñ–∏–ª—å—Ç—Ä ‚Üí —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ
   if (tcp->dest == htons(9999)) {  // –ê–≥–µ–Ω—Ç—ã Z. –Ω–∞ –ø–æ—Ä—Ç—É 9999
       printf("–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤!\n");
   }
   ```

**–í –º–∏—Å—Å–∏–∏:**
```
18:20 ‚Üí –ê–≥–µ–Ω—Ç—ã Z. –æ–±—â–∞—é—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 9999
        –í–´ (192.168.1.100) –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ packet_sniffer
        
19:15 ‚Üí –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω –ø–∞–∫–µ—Ç:
        Source: 192.168.1.150 (–∞–≥–µ–Ω—Ç Z.)
        Dest:   10.0.0.1:9999
        Payload: "Coordinates: 55.7520¬∞N 37.6175¬∞E"
        
19:16 ‚Üí –í–´ –£–ó–ù–ê–õ–ò –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã safe house!
        –ê–≥–µ–Ω—Ç—ã Z. –∑–Ω–∞—é—Ç, –≥–¥–µ –≤—ã!
        
–ù–û:
        –ê–≥–µ–Ω—Ç—ã Z. –¢–ê–ö–ñ–ï –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –í–ê–® —Ç—Ä–∞—Ñ–∏–∫!
        ‚Üí –í–∑–∞–∏–º–Ω—ã–π sniffing
        ‚Üí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–æ–π–Ω–∞
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç sniffing:**
- ‚úÖ **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** (TLS/SSL) ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—è—Ç, –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä—É—é—Ç
- ‚úÖ **VPN** ‚Äî —Ç—É–Ω–Ω–µ–ª—å, —Å–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- ‚úÖ **–§–∏–∑–∏—á–µ—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç —Å–µ—Ç–∏
- ‚ùå **Plaintext** ‚Äî –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å (–∫–∞–∫ –≤ –º–∏—Å—Å–∏–∏!)

---

## üìö –¢–µ–æ—Ä–∏—è: Raw Sockets –∏ Packet Sniffing

### üí° –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏?

**Packet sniffing** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
- üîç **Network debugging**: Wireshark, tcpdump
- üõ°Ô∏è **Intrusion Detection**: Snort, Suricata
- üìä **Traffic analysis**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
- üîê **Security research**: –∞–Ω–∞–ª–∏–∑ –∞—Ç–∞–∫
- üéÆ **Protocol reverse engineering**: –∏–≥—Ä–æ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

**–≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.**

---

### 1. Raw Sockets ‚Äî —á—Ç–æ —ç—Ç–æ?

**–û–±—ã—á–Ω—ã–π —Å–æ–∫–µ—Ç** (SOCK_STREAM):
- –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ **–≤–∞—à–µ–≥–æ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –Ø–¥—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –£–¥–æ–±–Ω–æ, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ

**Raw —Å–æ–∫–µ—Ç** (SOCK_RAW):
- –í–∏–¥–∏—Ç **–≤—Å–µ –ø–∞–∫–µ—Ç—ã** –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ü–æ–ª—É—á–∞–µ—Ç–µ **–ø–æ–ª–Ω—ã–π** –ø–∞–∫–µ—Ç (—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏!)
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –Ω–æ –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å —Å–∞–º–æ–º—É

```c
#include <sys/socket.h>
#include <netinet/ip.h>
#include <netinet/tcp.h>
#include <arpa/inet.h>

// –°–æ–∑–¥–∞–Ω–∏–µ raw socket –¥–ª—è TCP –ø–∞–∫–µ—Ç–æ–≤
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

// ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç root!
if (sockfd < 0) {
    perror("socket (are you root?)");
    exit(1);
}
```

**–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω root?** –ü–æ—Ç–æ–º—É —á—Ç–æ raw socket –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å **–ª—é–±–æ–π** —Ç—Ä–∞—Ñ–∏–∫ (—É–≥—Ä–æ–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏).

---

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ IP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (IPv4)

```c
#include <netinet/ip.h>

struct iphdr {
    uint8_t  ihl:4;        // IP Header Length (–≤ 32-bit —Å–ª–æ–≤–∞—Ö)
    uint8_t  version:4;    // –í–µ—Ä—Å–∏—è (4 –¥–ª—è IPv4)
    uint8_t  tos;          // Type of Service
    uint16_t tot_len;      // Total Length (–≤–µ—Å—å –ø–∞–∫–µ—Ç)
    uint16_t id;           // Identification
    uint16_t frag_off;     // Fragment Offset
    uint8_t  ttl;          // Time To Live
    uint8_t  protocol;     // Protocol (6=TCP, 17=UDP, 1=ICMP)
    uint16_t check;        // Header Checksum
    uint32_t saddr;        // Source Address
    uint32_t daddr;        // Destination Address
};
```

**–í–∞–∂–Ω–æ**:
- `ihl` ‚Äî –¥–ª–∏–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ **32-bit —Å–ª–æ–≤–∞—Ö** (–æ–±—ã—á–Ω–æ 5 = 20 –±–∞–π—Ç)
- `protocol` ‚Äî —Ç–∏–ø –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (TCP=6, UDP=17)
- `saddr/daddr` ‚Äî –≤ **network byte order** (–Ω—É–∂–µ–Ω `ntohl()`)

---

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞

```c
#include <netinet/tcp.h>

struct tcphdr {
    uint16_t source;       // Source port
    uint16_t dest;         // Destination port
    uint32_t seq;          // Sequence number
    uint32_t ack_seq;      // Acknowledgment number
    uint16_t res1:4;       // Reserved
    uint16_t doff:4;       // Data offset (–¥–ª–∏–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞)
    uint16_t fin:1, syn:1, rst:1, psh:1,
             ack:1, urg:1, ece:1, cwr:1;  // Flags
    uint16_t window;       // Window size
    uint16_t check;        // Checksum
    uint16_t urg_ptr;      // Urgent pointer
};
```

**TCP Flags**:
- `SYN` ‚Äî –Ω–∞—á–∞–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `ACK` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `FIN` ‚Äî –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `RST` ‚Äî —Å–±—Ä–æ—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `PSH` ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

### 4. –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞–∫–µ—Ç–∞

```c
unsigned char buffer[65536];  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä IP –ø–∞–∫–µ—Ç–∞

// –ü–æ–ª—É—á–∏—Ç—å –ø–∞–∫–µ—Ç
ssize_t size = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// 1. –ü–∞—Ä—Å–∏—Ç—å IP –∑–∞–≥–æ–ª–æ–≤–æ–∫
struct iphdr *ip = (struct iphdr*)buffer;

// –†–∞–∑–º–µ—Ä IP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–≤ –±–∞–π—Ç–∞—Ö)
int ip_header_len = ip->ihl * 4;

// 2. –ü–∞—Ä—Å–∏—Ç—å TCP –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–æ—Å–ª–µ IP)
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

// –†–∞–∑–º–µ—Ä TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–≤ –±–∞–π—Ç–∞—Ö)
int tcp_header_len = tcp->doff * 4;

// 3. Payload (–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
unsigned char *payload = buffer + ip_header_len + tcp_header_len;
int payload_len = ntohs(ip->tot_len) - ip_header_len - tcp_header_len;

printf("Payload: ");
for (int i = 0; i < payload_len; i++) {
    printf("%02X ", payload[i]);
}
printf("\n");
```

---

### 5. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤

```c
// IP –≤ network byte order ‚Üí —Å—Ç—Ä–æ–∫–∞
struct in_addr src_addr, dst_addr;
src_addr.s_addr = ip->saddr;
dst_addr.s_addr = ip->daddr;

char src_ip[INET_ADDRSTRLEN], dst_ip[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &src_addr, src_ip, INET_ADDRSTRLEN);
inet_ntop(AF_INET, &dst_addr, dst_ip, INET_ADDRSTRLEN);

printf("From: %s:%d\n", src_ip, ntohs(tcp->source));
printf("To:   %s:%d\n", dst_ip, ntohs(tcp->dest));
```

---

### 6. Hex Dump

```c
void hex_dump(unsigned char *data, int len) {
    printf("Offset   Hex                                            ASCII\n");
    printf("-------- ---------------------------------------------- ----------------\n");
    
    for (int i = 0; i < len; i += 16) {
        printf("%08X ", i);
        
        // Hex
        for (int j = 0; j < 16; j++) {
            if (i + j < len) {
                printf("%02X ", data[i + j]);
            } else {
                printf("   ");
            }
        }
        
        printf(" ");
        
        // ASCII
        for (int j = 0; j < 16 && i + j < len; j++) {
            unsigned char c = data[i + j];
            printf("%c", (c >= 32 && c <= 126) ? c : '.');
        }
        
        printf("\n");
    }
}
```

---

### 7. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤

```c
// –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ TCP (protocol = 6)
if (ip->protocol != IPPROTO_TCP) {
    continue;
}

// –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä—Ç—É
uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

if (dst_port == 9999 || src_port == 9999) {
    printf("MOONLIGHT traffic detected!\n");
    // –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å payload
}
```

---

### 8. Promiscuous Mode (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º**: —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –Ω–µ –¥–ª—è –Ω–∞—Å.  
**Promiscuous mode**: –∫–∞—Ä—Ç–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **–≤—Å–µ** –ø–∞–∫–µ—Ç—ã –≤ —Å–µ—Ç–∏.

```c
#include <sys/ioctl.h>
#include <net/if.h>

struct ifreq ifr;
strncpy(ifr.ifr_name, "eth0", IFNAMSIZ);

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ñ–ª–∞–≥–∏
ioctl(sockfd, SIOCGIFFLAGS, &ifr);

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å promiscuous mode
ifr.ifr_flags |= IFF_PROMISC;
ioctl(sockfd, SIOCSIFFLAGS, &ifr);
```

**–û—Å—Ç–æ—Ä–æ–∂–Ω–æ**: –í promiscuous mode –≤—ã –≤–∏–¥–∏—Ç–µ **–≤–µ—Å—å** —Ç—Ä–∞—Ñ–∏–∫ —Å–µ–≥–º–µ–Ω—Ç–∞ —Å–µ—Ç–∏!

---

## üéØ –ú–∏—Å—Å–∏—è: "Packet Sniffer"

### –õ–µ–≥–µ–Ω–¥–∞

–ê–≥–µ–Ω—Ç—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –Ω–∞ –ø–æ—Ä—Ç—É **9999**. V. –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ—Ç, —á—Ç–æ –≤ –ø–∞–∫–µ—Ç–∞—Ö —Å–∫—Ä—ã—Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞.

**–í–∞—à–∞ –∑–∞–¥–∞—á–∞**: –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å TCP —Ç—Ä–∞—Ñ–∏–∫ –∏ –∏–∑–≤–ª–µ—á—å —Å–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

**–ü—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏**:
```
Agent A ‚Üí Agent B: TCP 127.0.0.1:54321 ‚Üí 127.0.0.1:9999
Payload: [–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]

Agent B ‚Üí Agent A: TCP 127.0.0.1:9999 ‚Üí 127.0.0.1:54321
Payload: [–æ—Ç–≤–µ—Ç]
```

**–°–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ **payload** –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –Ω–∞ –ø–æ—Ä—Ç 9999.

---

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**1. –°–æ–∑–¥–∞—Ç—å raw socket –¥–ª—è TCP**:
```c
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
```

**2. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã**:
```c
while (1) {
    recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
    // –ü–∞—Ä—Å–∏–Ω–≥
}
```

**3. –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é**:
- Source IP:Port
- Destination IP:Port
- TCP flags (SYN, ACK, PSH, FIN)
- Payload (–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞)

**4. –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä—Ç—É 9999**

**5. Hex dump payload**

**6. –ò–∑–≤–ª–µ—á—å —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** (ASCII —Å–∏–º–≤–æ–ª—ã –∏–∑ payload)

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–ø–∏–∑–æ–¥–∞

```
episode-11-packet-analysis/
‚îú‚îÄ‚îÄ README.md              ‚Üê –í—ã –∑–¥–µ—Å—å
‚îú‚îÄ‚îÄ mission.md
‚îú‚îÄ‚îÄ starter.c              ‚Üê –®–∞–±–ª–æ–Ω packet sniffer
‚îú‚îÄ‚îÄ artifacts/
‚îÇ   ‚îî‚îÄ‚îÄ packet_sniffer.c   ‚Üê –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ solution/
‚îÇ   ‚îú‚îÄ‚îÄ packet_sniffer_solution.c
‚îÇ   ‚îî‚îÄ‚îÄ traffic_generator.c  ‚Üê –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test.sh
```

### üí° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å:

1. **–ò–∑—É—á–∏—Ç–µ** `starter.c` ‚Äî —Ç–∞–º –±–∞–∑–æ–≤—ã–π raw socket —Å TODO
2. **–°–æ–∑–¥–∞–π—Ç–µ** —Ñ–∞–π–ª `artifacts/packet_sniffer.c`
3. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ** packet sniffing:
   - –°–æ–∑–¥–∞–Ω–∏–µ raw socket (`SOCK_RAW`, `IPPROTO_TCP`)
   - –ü–∞—Ä—Å–∏–Ω–≥ IP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (`struct iphdr`)
   - –ü–∞—Ä—Å–∏–Ω–≥ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (`struct tcphdr`)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ payload
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ—Ä—Ç—É 9999
   - Hex dump –∏ ASCII extraction
4. **–°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ**: `gcc -Wall -o packet_sniffer artifacts/packet_sniffer.c`
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo**: `sudo ./packet_sniffer`

> üí° **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `solution/traffic_generator.c` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤!

---

### –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å raw socket?</summary>

```c
#include <sys/socket.h>
#include <netinet/ip.h>

int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
if (sockfd < 0) {
    perror("socket (are you root?)");
    exit(1);
}
```

**–í–∞–∂–Ω–æ**: –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å `sudo`!
</details>

<details>
<summary>–ö–∞–∫ –ø–∞—Ä—Å–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏?</summary>

```c
unsigned char buffer[65536];
ssize_t size = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// IP header
struct iphdr *ip = (struct iphdr*)buffer;
int ip_len = ip->ihl * 4;

// TCP header (–ø–æ—Å–ª–µ IP)
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_len);
int tcp_len = tcp->doff * 4;

// Payload
unsigned char *payload = buffer + ip_len + tcp_len;
int payload_len = ntohs(ip->tot_len) - ip_len - tcp_len;
```
</details>

<details>
<summary>–ö–∞–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä—Ç—É?</summary>

```c
uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

if (dst_port == 9999 || src_port == 9999) {
    printf("Target traffic detected!\n");
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å
}
```
</details>

<details>
<summary>–ö–∞–∫ –∏–∑–≤–ª–µ—á—å ASCII –∏–∑ payload?</summary>

```c
printf("ASCII: ");
for (int i = 0; i < payload_len; i++) {
    if (payload[i] >= 32 && payload[i] <= 126) {
        printf("%c", payload[i]);
    } else {
        printf(".");
    }
}
printf("\n");
```
</details>

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
gcc -Wall -o packet_sniffer artifacts/packet_sniffer.c

# –í –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—Ä–∞—Ñ–∏–∫–∞
gcc -Wall -o traffic_gen solution/traffic_generator.c
./traffic_gen &

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: sniffer (—Å sudo!)
sudo ./packet_sniffer

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
pkill traffic_gen
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞**:
- Raw socket —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
- –ü–∞—Ä—Å–∏—Ç IP –∏ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç payload
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –ø–æ—Ä—Ç—É 9999
- –í—ã–≤–æ–¥–∏—Ç hex dump
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç ASCII —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ù–∞—Ö–æ–¥–∏—Ç —Å–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## üé¨ DEBRIEFING

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  –õ–û–ö–ê–¶–ò–Ø: –ö–≤–∞—Ä—Ç–∏—Ä–∞, —Ä–∞–π–æ–Ω –ê—Ä–±–∞—Ç, –ú–æ—Å–∫–≤–∞                 ‚ïë
‚ïë  –í–†–ï–ú–Ø:   22:35, —Å—Ä–µ–¥–∞, 1 –æ–∫—Ç—è–±—Ä—è                       ‚ïë
‚ïë  –°–¢–ê–¢–£–°:  üü¢ MESSAGE INTERCEPTED                         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

`packet_sniffer` –∑–∞–ø—É—â–µ–Ω —Å sudo. –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–∞—á–∞—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
=== PACKET SNIFFER ===
Listening on all interfaces...
Filtering for port 9999

[Packet #1]
From: 127.0.0.1:54321 ‚Üí 127.0.0.1:9999
Protocol: TCP
Flags: PSH ACK
Payload (24 bytes):

Offset   Hex                                  ASCII
-------- ------------------------------------ ----------------
00000000 54 68 65 20 6E 65 78 74 20 6E 6F 64 The next nod
00000010 65 3A 20 31 30 2E 30 2E 30 2E 31     e: 10.0.0.1

Decoded: "The next node: 10.0.0.1"

[Packet #2]
From: 127.0.0.1:9999 ‚Üí 127.0.0.1:54321
Protocol: TCP
Flags: PSH ACK
Payload (18 bytes):

Offset   Hex                                  ASCII
-------- ------------------------------------ ----------------
00000000 50 6F 72 74 3A 20 34 34 33 33 0A     Port: 4433.

üéØ HIDDEN MESSAGE EXTRACTED:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Next node: 10.0.0.1:4433               ‚îÇ
‚îÇ  Protocol: Encrypted TCP                ‚îÇ
‚îÇ  Mission: Episode 12                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ß—Ç–æ –≤—ã —É–∑–Ω–∞–ª–∏:**
- **Raw sockets** –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–∞–∫–µ—Ç–∞–º–∏
- **IP –∏ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∏** —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- **Payload** ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –°–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: **10.0.0.1:4433** (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª)

–í 22:33 —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç V.:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FROM: V.                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  –¢—ã –Ω–∞—É—á–∏–ª—Å—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å.             ‚îÇ
‚îÇ  –¢–µ–ø–µ—Ä—å —Ñ–∏–Ω–∞–ª: –†–ê–°–®–ò–§–†–û–í–ö–ê.             ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Episode 12: Encrypted Communications   ‚îÇ
‚îÇ  –í—Å–µ –∑–Ω–∞–Ω–∏—è —Å–æ–±–µ—Ä—É—Ç—Å—è –≤–æ–µ–¥–∏–Ω–æ.          ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  10.0.0.1:4433 –∂–¥—ë—Ç —Ç–µ–±—è.               ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚Äî V.                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∏–¥–µ—Ç—å –ø–∞–∫–µ—Ç—ã ‚Äî —ç—Ç–æ —Å–∏–ª–∞. –ü–æ–Ω–∏–º–∞—Ç—å –∏—Ö ‚Äî —ç—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–æ.**

### üéñÔ∏è –ù–∞–≤—ã–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
**"Packet Master"** ‚Äî –í—ã –≤–∏–¥–∏—Ç–µ —Å–µ—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–π—Ç–æ–≤. Raw sockets –±–æ–ª—å—à–µ –Ω–µ —Ç–∞–π–Ω–∞.

---

## üìù –ö–û–ù–¢–†–û–õ–¨–ù–´–ï –í–û–ü–†–û–°–´

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ Episode 11 (–≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Å—é–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä-—Å–ª–µ–∂–∫–∏):

### üü¢ –ë–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ (4 –≤–æ–ø—Ä–æ—Å–∞)

**1. –í 19:47 –≤—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏–ª–∏ –í–¢–û–†–û–ô –ü–ê–ö–ï–¢ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ "55.7520¬∞N 37.6175¬∞E". –ü–æ—á–µ–º—É —ç—Ç–æ –±—ã–ª —à–æ–∫?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–≠—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –í–ê–®–ï–ì–û safe house! –ê–≥–µ–Ω—Ç—ã Z. –∑–Ω–∞—é—Ç, –≥–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å!**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
```
19:47 ‚Üí –í—Ç–æ—Ä–æ–π –ø–∞–∫–µ—Ç (From: 127.0.0.1:9999 ‚Üí 127.0.0.1:54321)
        Payload: "Coordinates: 55.7520¬∞N 37.6175¬∞E"
                 "Status: Under surveillance"
                 "Agent count: 1"
```

**–ê–Ω–∞–ª–∏–∑:**
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–Ω–æ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–∞—à–µ —É–±–µ–∂–∏—â–µ
- "Under surveillance" = –≤–∞—Å –∞–∫—Ç–∏–≤–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç
- "Agent count: 1" = –æ–Ω–∏ –∑–Ω–∞—é—Ç, —á—Ç–æ –≤—ã –æ–¥–∏–Ω

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
```c
// –í packet_sniffer –≤—ã –∏–∑–≤–ª–µ–∫–ª–∏ payload:
char *payload_start = (char*)(packet + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

// –ò —É–≤–∏–¥–µ–ª–∏:
// "Coordinates: 55.7520¬∞N 37.6175¬∞E"
```

**–û—Å–æ–∑–Ω–∞–Ω–∏–µ:** "–û—Ö–æ—Ç–Ω–∏–∫ —Å—Ç–∞–ª –¥–æ–±—ã—á–µ–π" ‚Äî –≤—ã —Å–ª–µ–¥–∏–ª–∏ –∑–∞ –Ω–∏–º–∏, –Ω–æ **–û–ù–ò —Ç–æ–∂–µ —Å–ª–µ–¥—è—Ç –∑–∞ –í–ê–ú–ò**.

**–£—Ä–æ–∫:** Packet sniffing ‚Äî –æ–±–æ—é–¥–æ–æ—Å—Ç—Ä—ã–π –º–µ—á. –ï—Å–ª–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫, —Ç–æ –∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ –º–æ–∂–µ—Ç.
</details>

**2. –ü–æ—á–µ–º—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ packet_sniffer –Ω—É–∂–Ω—ã ROOT –ø—Ä–∞–≤–∞ (sudo)?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–ü–æ—Ç–æ–º—É —á—Ç–æ raw sockets —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç–µ–≤–æ–º—É —Å—Ç–µ–∫—É!**

**–ü—Ä–∏—á–∏–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
```c
// –°–æ–∑–¥–∞–Ω–∏–µ raw socket:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
// ^^^ –¢–æ–ª—å–∫–æ root –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —ç—Ç–æ!

if (sockfd < 0) {
    perror("socket");  // "Operation not permitted" –±–µ–∑ sudo
    exit(1);
}
```

**–ü–æ—á–µ–º—É root?**
1. **Raw socket –≤–∏–¥–∏—Ç –í–°–ï –ø–∞–∫–µ—Ç—ã:**
   - –í–∫–ª—é—á–∞—è –ø–∞–∫–µ—Ç—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í–∫–ª—é—á–∞—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –≠—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏!

2. **–ú–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å –ø–∞–∫–µ—Ç—ã:**
   - –° –ª—é–±—ã–º source IP
   - –° –ª—é–±—ã–º source port
   - –°–ø—É—Ñ–∏–Ω–≥ –∞—Ç–∞–∫, man-in-the-middle

3. **–û–±—Ö–æ–¥ firewall:**
   - Raw sockets —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ IP
   - –ú–∏–Ω—É—é—Ç –º–Ω–æ–≥–∏–µ –∑–∞—â–∏—Ç—ã

**–í –º–∏—Å—Å–∏–∏:**
```bash
$ ./packet_sniffer
socket: Operation not permitted  ‚Üê –ë–µ–∑ sudo!

$ sudo ./packet_sniffer
Listening on all interfaces...  ‚úì
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–±–µ–∑ root):**
- `pcap` –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- `tcpdump` —Å setuid (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- Docker —Å capabilities (CAP_NET_RAW)

**–£—Ä–æ–∫:** Raw sockets = –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
</details>

**3. –í 20:00 –≤—ã –æ—Å–æ–∑–Ω–∞–ª–∏, —á—Ç–æ –∞–≥–µ–Ω—Ç—ã Z. –¢–û–ñ–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç packet sniffing. –ö–∞–∫ –æ–Ω–∏ –º–æ–≥–ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –≤–∞—à —Ç—Ä–∞—Ñ–∏–∫?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–û–Ω–∏ –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ç–µ–≤–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –∏–ª–∏ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—É!**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Shared network (WiFi, –æ–±—â–∞—è —Å–µ—Ç—å):**
```
       –í–ê–® –ö–û–ú–ü–¨–Æ–¢–ï–†              –ê–ì–ï–ù–¢ Z.
           üì±                         üë§
            ‚îÇ                         ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                 [WiFi Router]
                 
‚Üí –ê–≥–µ–Ω—Ç Z. –≤–∫–ª—é—á–∞–µ—Ç promiscuous mode –Ω–∞ WiFi:
  sudo ifconfig wlan0 promisc
  sudo tcpdump -i wlan0
  
‚Üí –í–∏–¥–∏—Ç –í–°–ï –ø–∞–∫–µ—Ç—ã –≤ WiFi —Å–µ—Ç–∏, –≤–∫–ª—é—á–∞—è –≤–∞—à–∏!
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: Man-in-the-Middle (ARP spoofing):**
```c
// –ê–≥–µ–Ω—Ç Z. –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ ARP –ø–∞–∫–µ—Ç—ã:
// "–Ø ‚Äî —ç—Ç–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä!"
// –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ –Ω–µ–≥–æ
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä:**
```
–ê–≥–µ–Ω—Ç—ã Z. –≤–∑–ª–æ–º–∞–ª–∏ WiFi —Ä–æ—É—Ç–µ—Ä safe house
‚Üí –ù–∞—Å—Ç—Ä–æ–∏–ª–∏ port mirroring
‚Üí –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–º
```

**–í –º–∏—Å—Å–∏–∏:**
- Safe house –∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω
- –ê–≥–µ–Ω—Ç—ã Z. –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
- –û–Ω–∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å–≤–æ–π packet_sniffer
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –≤–∞—à–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–ó–∞—â–∏—Ç–∞:**
- VPN (—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞)
- HTTPS (TLS)
- –°–º–µ–Ω–∏—Ç—å safe house (—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

**–£—Ä–æ–∫:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏ = –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è + –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è.
</details>

**4. –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ñ–ª–∞–≥ "PSH ACK" –≤ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö TCP –ø–∞–∫–µ—Ç–∞—Ö?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**PSH = "Push" (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å), ACK = "Acknowledgment" (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)**

**–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:**
```c
struct tcphdr *tcp = (struct tcphdr*)(packet + ip_header_len);

if (tcp->psh) {
    printf("–§–ª–∞–≥ PSH —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞\n");
    // –î–∞–Ω–Ω—ã–µ –ù–ï –±—É—Ñ–µ—Ä–∏–∑—É—é—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É
}

if (tcp->ack) {
    printf("–§–ª–∞–≥ ACK —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è\n");
    printf("ACK number: %u\n", ntohl(tcp->ack_seq));
}
```

**PSH (Push):**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö–æ—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ù–ï–ú–ï–î–õ–ï–ù–ù–û
- –ù–µ –∂–¥–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è TCP –±—É—Ñ–µ—Ä–∞
- –¢–∏–ø–∏—á–Ω–æ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (SSH, telnet, chat)

**ACK (Acknowledgment):**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å seq = ack_seq - 1
- –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ—á—Ç–∏ –≤–æ –≤—Å–µ—Ö TCP –ø–∞–∫–µ—Ç–∞—Ö (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ SYN)

**–í –º–∏—Å—Å–∏–∏ (–ü–∞–∫–µ—Ç #1):**
```
[Packet #1]
From: 127.0.0.1:54321 ‚Üí 127.0.0.1:9999
Flags: PSH ACK
Payload: "Target confirmed. Location: Safe house."
```

**–ü–æ—á–µ–º—É PSH ACK?**
- –ê–≥–µ–Ω—Ç Z. –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ
- PSH = "–æ—Ç–ø—Ä–∞–≤—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –±—É—Ñ–µ—Ä–∏–∑—É–π" (—Å—Ä–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!)
- ACK = "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö"

**–î—Ä—É–≥–∏–µ —Ñ–ª–∞–≥–∏:**
- SYN = —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- FIN = –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- RST = –∞–≤–∞—Ä–∏–π–Ω—ã–π —Å–±—Ä–æ—Å
- URG = —Å—Ä–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–£—Ä–æ–∫:** –§–ª–∞–≥–∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (—Å—Ä–æ—á–Ω–æ—Å—Ç—å, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏).
</details>

---

### üü° –ü—Ä–∞–∫—Ç–∏–∫–∞ (5 –≤–æ–ø—Ä–æ—Å–æ–≤)

**5. –í –∫–æ–¥–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `IPPROTO_TCP` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. –ö–∞–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –¢–û–õ–¨–ö–û UDP –ø–∞–∫–µ—Ç—ã?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–°–æ–∑–¥–∞—Ç—å raw socket —Å `IPPROTO_UDP`:**

```c
// –î–ª—è TCP (–∏–∑ –º–∏—Å—Å–∏–∏):
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

// –î–ª—è UDP:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_UDP);

// –î–ª—è –í–°–ï–• –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_IP);
```

**UDP packet sniffer:**
```c
#include <netinet/udp.h>  // struct udphdr

// ...receive packet...

// –ü–∞—Ä—Å–∏–Ω–≥ IP –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ TCP)
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;

// –ü–∞—Ä—Å–∏–Ω–≥ UDP –∑–∞–≥–æ–ª–æ–≤–∫–∞
struct udphdr *udp = (struct udphdr*)(buffer + ip_header_len);

printf("UDP Source port: %u\n", ntohs(udp->source));
printf("UDP Dest port: %u\n", ntohs(udp->dest));
printf("UDP Length: %u\n", ntohs(udp->len));
printf("UDP Checksum: 0x%04X\n", ntohs(udp->check));

// Payload
int udp_header_len = sizeof(struct udphdr);  // –í—Å–µ–≥–¥–∞ 8 –±–∞–π—Ç
char *payload = (char*)(buffer + ip_header_len + udp_header_len);
int payload_len = ntohs(udp->len) - udp_header_len;
```

**–û—Ç–ª–∏—á–∏—è UDP vs TCP:**
```
TCP –∑–∞–≥–æ–ª–æ–≤–æ–∫: 20+ –±–∞–π—Ç (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑-–∑–∞ –æ–ø—Ü–∏–π)
UDP –∑–∞–≥–æ–ª–æ–≤–æ–∫: 8 –±–∞–π—Ç (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

TCP: seq, ack_seq, flags, window...
UDP: —Ç–æ–ª—å–∫–æ source, dest, len, checksum
```

**–í –º–∏—Å—Å–∏–∏:**
- –ê–≥–µ–Ω—Ç—ã Z. –∏—Å–ø–æ–ª—å–∑—É—é—Ç TCP (–ø–æ—Ä—Ç 9999)
- –ù–æ –º–æ–≥–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UDP (–±—ã—Å—Ç—Ä–µ–µ, –º–µ–Ω—å—à–µ —Å–ª–µ–¥–æ–≤)
- –î–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ UDP –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ `IPPROTO_TCP` ‚Üí `IPPROTO_UDP`

**–£—Ä–æ–∫:** Raw sockets —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ (TCP, UDP, ICMP, ...).
</details>

**6. –ö–∞–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã –¢–û–õ–¨–ö–û —Å –ø–æ—Ä—Ç–∞ 9999, –∞ –Ω–µ –≤—Å–µ—Ö –ø–æ—Ä—Ç–æ–≤?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å source/dest port –≤ TCP –∑–∞–≥–æ–ª–æ–≤–∫–µ:**

```c
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

uint16_t src_port = ntohs(tcp->source);
uint16_t dst_port = ntohs(tcp->dest);

// –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç 9999
#define TARGET_PORT 9999

if (src_port == TARGET_PORT || dst_port == TARGET_PORT) {
    printf("[Packet on port 9999]\n");
    printf("From: %s:%u ‚Üí ", src_ip_str, src_port);
    printf("%s:%u\n", dst_ip_str, dst_port);
    
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å payload
    // ...
} else {
    // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
    continue;
}
```

**–í –º–∏—Å—Å–∏–∏:**
```c
// –ü–µ—Ä–µ—Ö–≤–∞—Ç –í–°–ï–• TCP –ø–∞–∫–µ—Ç–æ–≤:
int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);

while (1) {
    // –ü–æ–ª—É—á–∏—Ç—å –ø–∞–∫–µ—Ç
    recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
    
    // –ü–∞—Ä—Å–∏–Ω–≥
    struct iphdr *ip = (struct iphdr*)buffer;
    struct tcphdr *tcp = (struct tcphdr*)(buffer + ip->ihl * 4);
    
    // –§–ò–õ–¨–¢–† –ø–æ –ø–æ—Ä—Ç—É
    if (ntohs(tcp->source) == 9999 || ntohs(tcp->dest) == 9999) {
        printf("MATCHED! Port 9999 packet\n");
        // –ò–∑–≤–ª–µ—á—å payload –∞–≥–µ–Ω—Ç–æ–≤ Z.
    }
}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: BPF (Berkeley Packet Filter):**
```c
// –° libpcap –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä:
pcap_compile(handle, &fp, "tcp port 9999", 0, PCAP_NETMASK_UNKNOWN);
pcap_setfilter(handle, &fp);
// Kernel –±—É–¥–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ!)
```

**–£—Ä–æ–∫:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ user space vs kernel space (BPF –±—ã—Å—Ç—Ä–µ–µ).
</details>

**7. –í 19:46 –ø–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–ª "Target confirmed". –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π –ø–∞–∫–µ—Ç –ø—Ä–∏—à—ë–ª –ø–µ—Ä–≤—ã–º, –µ—Å–ª–∏ –æ–Ω–∏ –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TCP sequence numbers!**

```c
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);

uint32_t seq = ntohl(tcp->seq);
uint32_t ack_seq = ntohl(tcp->ack_seq);

printf("SEQ: %u\n", seq);
printf("ACK: %u\n", ack_seq);
```

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤:**
```c
typedef struct {
    uint32_t seq;
    char payload[1024];
    int payload_len;
} Packet;

Packet packets[100];
int packet_count = 0;

// –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–∞–∫–µ—Ç–∞:
packets[packet_count].seq = ntohl(tcp->seq);
memcpy(packets[packet_count].payload, payload, payload_len);
packets[packet_count].payload_len = payload_len;
packet_count++;

// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ SEQ:
qsort(packets, packet_count, sizeof(Packet), compare_seq);

int compare_seq(const void *a, const void *b) {
    Packet *pa = (Packet*)a;
    Packet *pb = (Packet*)b;
    
    if (pa->seq < pb->seq) return -1;
    if (pa->seq > pb->seq) return 1;
    return 0;
}

// –¢–µ–ø–µ—Ä—å packets[0] ‚Äî –ø–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç!
```

**–í –º–∏—Å—Å–∏–∏:**
```
[Packet #1] SEQ=1000: "Target confirmed. Location: Safe house."
[Packet #2] SEQ=1048: "Coordinates: 55.7520¬∞N 37.6175¬∞E"
[Packet #3] SEQ=1112: "Order: Continue monitoring."
```

**–ü–æ—á–µ–º—É SEQ –≤–∞–∂–µ–Ω:**
- –ü–∞–∫–µ—Ç—ã –º–æ–≥—É—Ç –ø—Ä–∏–π—Ç–∏ –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ (routing, retransmit)
- SEQ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ç–∏–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
- –°–ª–µ–¥—É—é—â–∏–π –ø–∞–∫–µ—Ç: SEQ = –ø—Ä–µ–¥—ã–¥—É—â–∏–π SEQ + payload_len

**–£—Ä–æ–∫:** TCP sequence numbers = timestamp –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞).
</details>

**8. –ß—Ç–æ —Ç–∞–∫–æ–µ "promiscuous mode" –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è packet sniffing?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**Promiscuous mode = "–ø—Ä–∏–Ω–∏–º–∞—Ç—å –í–°–ï –ø–∞–∫–µ—Ç—ã, –¥–∞–∂–µ –Ω–µ –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–±–µ"**

**–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º:**
```
–°–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–∞–∫–µ—Ç—ã:
‚îú‚îÄ –ü–∞–∫–µ—Ç—ã —Å –≤–∞—à–∏–º MAC ‚Üí –ø—Ä–∏–Ω—è—Ç—å
‚îú‚îÄ Broadcast –ø–∞–∫–µ—Ç—ã ‚Üí –ø—Ä–∏–Ω—è—Ç—å
‚îî‚îÄ –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –û–¢–ë–†–û–°–ò–¢–¨
```

**Promiscuous mode:**
```
–°–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –í–°–Å:
‚îú‚îÄ –ü–∞–∫–µ—Ç—ã —Å –≤–∞—à–∏–º MAC ‚Üí –ø—Ä–∏–Ω—è—Ç—å
‚îú‚îÄ –ü–∞–∫–µ—Ç—ã —Å —á—É–∂–∏–º MAC ‚Üí –ø—Ä–∏–Ω—è—Ç—å!
‚îú‚îÄ Broadcast ‚Üí –ø—Ä–∏–Ω—è—Ç—å
‚îî‚îÄ –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí –ø—Ä–∏–Ω—è—Ç—å!
```

**–í–∫–ª—é—á–µ–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```c
#include <sys/ioctl.h>
#include <net/if.h>

int sockfd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));

// –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
struct ifreq ifr;
strncpy(ifr.ifr_name, "eth0", IFNAMSIZ);

// –í–∫–ª—é—á–∏—Ç—å promiscuous mode
ioctl(sockfd, SIOCGIFFLAGS, &ifr);
ifr.ifr_flags |= IFF_PROMISC;
ioctl(sockfd, SIOCSIFFLAGS, &ifr);

printf("Promiscuous mode enabled on eth0\n");
```

**–í –º–∏—Å—Å–∏–∏:**
- –ë–µ–∑ promiscuous: –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø–∞–∫–µ—Ç—ã
- –° promiscuous: –≤–∏–¥–∏—Ç–µ –ø–∞–∫–µ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤ Z. (–ø–æ—Ä—Ç 9999)

**–ù–∞ WiFi:**
- –ï—â—ë —Å–ª–æ–∂–Ω–µ–µ (Monitor mode)
- –ù—É–∂–Ω–æ –≤–∏–¥–µ—Ç—å –ø–∞–∫–µ—Ç—ã –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `airmon-ng start wlan0`

**–õ–µ–≥–∞–ª—å–Ω–æ—Å—Ç—å:**
‚ö†Ô∏è –í —Å–≤–æ–µ–π —Å–µ—Ç–∏: OK  
‚ö†Ô∏è –í —á—É–∂–æ–π —Å–µ—Ç–∏: –ù–ï–ó–ê–ö–û–ù–ù–û (–ø–µ—Ä–µ—Ö–≤–∞—Ç —á—É–∂–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞)

**–£—Ä–æ–∫:** Promiscuous mode = –æ—Å–Ω–æ–≤–∞ –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ (Wireshark, tcpdump).
</details>

**9. –ö–∞–∫ –≤—ã—á–∏—Å–ª–∏—Ç—å –¥–ª–∏–Ω—É payload –≤ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω–æ–º –ø–∞–∫–µ—Ç–µ?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**`total_len - ip_header_len - tcp_header_len`:**

```c
// 1. –ü–æ–ª—É—á–∏—Ç—å –ø–∞–∫–µ—Ç
char buffer[65536];
ssize_t total_len = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);

// 2. –ü–∞—Ä—Å–∏–Ω–≥ IP –∑–∞–≥–æ–ª–æ–≤–∫–∞
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;  // ihl –≤ 32-bit —Å–ª–æ–≤–∞—Ö
// ihl=5 ‚Üí 5*4=20 –±–∞–π—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π IP –∑–∞–≥–æ–ª–æ–≤–æ–∫)

// 3. –ü–∞—Ä—Å–∏–Ω–≥ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞
struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);
int tcp_header_len = tcp->doff * 4;  // doff –≤ 32-bit —Å–ª–æ–≤–∞—Ö
// doff=5 ‚Üí 5*4=20 –±–∞–π—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π TCP –∑–∞–≥–æ–ª–æ–≤–æ–∫)

// 4. –í—ã—á–∏—Å–ª–∏—Ç—å payload
char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

if (payload_len > 0) {
    printf("Payload (%d bytes):\n", payload_len);
    for (int i = 0; i < payload_len; i++) {
        printf("%c", payload[i]);
    }
    printf("\n");
}
```

**–ü—Ä–∏–º–µ—Ä (–ü–∞–∫–µ—Ç #1 –∏–∑ –º–∏—Å—Å–∏–∏):**
```
total_len = 84 –±–∞–π—Ç (–æ—Ç recvfrom)
ip_header_len = 20 –±–∞–π—Ç (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
tcp_header_len = 20 –±–∞–π—Ç (–±–µ–∑ –æ–ø—Ü–∏–π)

payload_len = 84 - 20 - 20 = 44 –±–∞–π—Ç
payload = "Target confirmed. Location: Safe house.\n"
```

**–í–∞–∂–Ω–æ:**
- `ihl` –∏ `doff` ‚Äî –≤ 32-bit —Å–ª–æ–≤–∞—Ö, –ù–ï –±–∞–π—Ç–∞—Ö!
- –ú–∏–Ω–∏–º—É–º: IP=20 –±–∞–π—Ç, TCP=20 –±–∞–π—Ç
- –ú–∞–∫—Å–∏–º—É–º: IP=60 –±–∞–π—Ç (—Å –æ–ø—Ü–∏—è–º–∏), TCP=60 –±–∞–π—Ç
- Payload –º–æ–∂–µ—Ç –±—ã—Ç—å 0 (ACK –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```c
if (payload_len < 0) {
    fprintf(stderr, "Invalid packet (negative payload)\n");
    continue;
}
```

**–£—Ä–æ–∫:** Payload = "—Ç–æ, —Ä–∞–¥–∏ —á–µ–≥–æ –≤—Å—ë —ç—Ç–æ" (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).
</details>

---

### üî¥ –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ (3 –≤–æ–ø—Ä–æ—Å–∞)

**10. –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫—É –≤ —ç—Ç–æ–º –∫–æ–¥–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è payload:**

```c
struct iphdr *ip = (struct iphdr*)buffer;
struct tcphdr *tcp = (struct tcphdr*)(buffer + 20);  // ‚Üê –û–®–ò–ë–ö–ê?
char *payload = (char*)(buffer + 40);
int payload_len = total_len - 40;
```

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–û—à–∏–±–∫–∞: hardcoded —Ä–∞–∑–º–µ—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤!**

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **IP –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –≤—Å–µ–≥–¥–∞ 20 –±–∞–π—Ç:**
   ```c
   struct tcphdr *tcp = (struct tcphdr*)(buffer + 20);  // ‚ùå
   ```
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å 20-60 –±–∞–π—Ç (IP –æ–ø—Ü–∏–∏!)
   - –ù—É–∂–Ω–æ: `ip->ihl * 4`

2. **TCP –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –≤—Å–µ–≥–¥–∞ 20 –±–∞–π—Ç:**
   ```c
   char *payload = (char*)(buffer + 40);  // ‚ùå (20+20)
   ```
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å 20-60 –±–∞–π—Ç (TCP –æ–ø—Ü–∏–∏!)
   - –ù—É–∂–Ω–æ: `tcp->doff * 4`

3. **Payload offset –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
   ```c
   int payload_len = total_len - 40;  // ‚ùå
   ```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:**
```c
struct iphdr *ip = (struct iphdr*)buffer;
int ip_header_len = ip->ihl * 4;  // ‚úì –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π!

struct tcphdr *tcp = (struct tcphdr*)(buffer + ip_header_len);
int tcp_header_len = tcp->doff * 4;  // ‚úì –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π!

char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
- –ü–∞–∫–µ—Ç —Å IP –æ–ø—Ü–∏—è–º–∏ (ihl=6, 24 –±–∞–π—Ç–∞)
- `buffer + 20` ‚Üí –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π offset
- –ß–∏—Ç–∞–µ–º –º—É—Å–æ—Ä –≤–º–µ—Å—Ç–æ TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞
- Payload —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∞—Å—Ç—å TCP –∑–∞–≥–æ–ª–æ–≤–∫–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–æ–≤ Z.!

**–£—Ä–æ–∫:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ hardcode —Ä–∞–∑–º–µ—Ä—ã –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤!
</details>

**11. –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –∫–æ–¥ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –º—É—Å–æ—Ä?**

```c
char buffer[1024];
int n = recvfrom(sockfd, buffer, sizeof(buffer), 0, NULL, NULL);
printf("Payload: %s\n", (char*)(buffer + 40));  // ‚Üê –ü–†–û–ë–õ–ï–ú–ê?
```

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–ü—Ä–æ–±–ª–µ–º–∞: `%s` —Ç—Ä–µ–±—É–µ—Ç null-terminated —Å—Ç—Ä–æ–∫—É, –∞ payload –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å `\0`!**

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
```c
printf("Payload: %s\n", (char*)(buffer + 40));
```

- `%s` —á–∏—Ç–∞–µ—Ç –¥–æ `\0`
- Payload –∞–≥–µ–Ω—Ç–æ–≤ Z. –º–æ–∂–µ—Ç –ù–ï –∏–º–µ—Ç—å `\0` –≤ –∫–æ–Ω—Ü–µ
- `printf` –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —á–∏—Ç–∞—Ç—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã payload
- ‚Üí –ß—Ç–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞, –≤–æ–∑–º–æ–∂–Ω–æ segfault!

**–ü—Ä–∏–º–µ—Ä (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–≤–æ–¥):**
```c
char *payload = (char*)(buffer + ip_header_len + tcp_header_len);
int payload_len = total_len - ip_header_len - tcp_header_len;

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ
for (int i = 0; i < payload_len; i++) {
    printf("%c", payload[i]);
}
printf("\n");

// –í–∞—Ä–∏–∞–Ω—Ç 2: —Å–æ–∑–¥–∞—Ç—å null-terminated –∫–æ–ø–∏—é
char safe_payload[1024];
memcpy(safe_payload, payload, payload_len);
safe_payload[payload_len] = '\0';  // –î–æ–±–∞–≤–∏—Ç—å \0
printf("Payload: %s\n", safe_payload);

// –í–∞—Ä–∏–∞–Ω—Ç 3: precision –≤ printf
printf("Payload: %.*s\n", payload_len, payload);
//                ^^^ –ø–µ—á–∞—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ payload_len —Å–∏–º–≤–æ–ª–æ–≤
```

**–í –º–∏—Å—Å–∏–∏:**
```
Payload (–±–µ–∑ \0): "Target confirmed. Location: Safe house."
–°–ª–µ–¥—É—é—â–∏–µ –±–∞–π—Ç—ã –≤ –ø–∞–º—è—Ç–∏: [random garbage]

printf("%s") ‚Üí "Target confirmed...Safe house.[–º—É—Å–æ—Ä][–º—É—Å–æ—Ä]..."
```

**–£—Ä–æ–∫:** –°–µ—Ç–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —ç—Ç–æ –±–∞–π—Ç—ã, –ù–ï C-—Å—Ç—Ä–æ–∫–∏!
</details>

**12. –í —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞ —ç—Ç–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ IP?**

```c
struct iphdr *ip = (struct iphdr*)buffer;

if (ip->saddr == inet_addr("127.0.0.1")) {  // ‚Üê –û–®–ò–ë–ö–ê?
    printf("From localhost\n");
}
```

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–û—à–∏–±–∫–∞: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ network byte order —Å host byte order!**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```c
if (ip->saddr == inet_addr("127.0.0.1")) {  // ‚ùå
```

- `ip->saddr` ‚Äî –≤ **network byte order** (big-endian)
- `inet_addr()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **host byte order** –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (–ù–ï portable!)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è!

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:**
```c
// –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–æ–∫—É –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å
char src_ip_str[INET_ADDRSTRLEN];
struct in_addr src_addr;
src_addr.s_addr = ip->saddr;  // –£–∂–µ –≤ network byte order
inet_ntop(AF_INET, &src_addr, src_ip_str, INET_ADDRSTRLEN);

if (strcmp(src_ip_str, "127.0.0.1") == 0) {
    printf("From localhost\n");
}

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inet_pton
struct in_addr expected;
inet_pton(AF_INET, "127.0.0.1", &expected);  // ‚Üí network byte order

if (ip->saddr == expected.s_addr) {  // ‚úì –û–±–∞ –≤ network byte order
    printf("From localhost\n");
}

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä—è–º–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º byte order
if (ntohl(ip->saddr) == 0x7F000001) {  // 127.0.0.1
    printf("From localhost\n");
}
```

**–í –º–∏—Å—Å–∏–∏ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥):**
```c
struct in_addr src_addr;
src_addr.s_addr = ip->saddr;
char src_ip[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &src_addr, src_ip, INET_ADDRSTRLEN);

// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏
printf("From: %s\n", src_ip);
```

**–£—Ä–æ–∫:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `inet_ntop`/`inet_pton` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ IP!
</details>

---

### üéØ –°—é–∂–µ—Ç (2 –≤–æ–ø—Ä–æ—Å–∞)

**13. –í 20:15 V. –Ω–∞–ø–∏—Å–∞–ª: "–û–Ω–∏ —Å–ª–µ–¥—è—Ç –∑–∞ —Ç–æ–±–æ–π. –ù–æ —Ç–µ–ø–µ—Ä—å –¢–´ —Å–ª–µ–¥–∏—à—å –∑–∞ –Ω–∏–º–∏." –ö–∞–∫ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –≤–∑–∞–∏–º–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç packet sniffing –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ = –≤–∑–∞–∏–º–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å!**

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```
         SAFE HOUSE NETWORK
         
    –í–´                      –ê–ì–ï–ù–¢–´ Z.
    üì±                         üë§
     ‚îÇ                         ‚îÇ
     ‚îú‚îÄ‚îÄ> packet_sniffer       ‚îú‚îÄ‚îÄ> packet_sniffer
     ‚îÇ    (–ø–µ—Ä–µ—Ö–≤–∞—Ç –ø–æ—Ä—Ç–∞ 9999)‚îÇ    (–ø–µ—Ä–µ—Ö–≤–∞—Ç –í–°–ï–• –ø–æ—Ä—Ç–æ–≤)
     ‚îÇ                         ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
          [WiFi Router]
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **–ê–≥–µ–Ω—Ç—ã Z. –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –í–ê–® —Ç—Ä–∞—Ñ–∏–∫:**
   - –í–∏–¥—è—Ç –≤–∞—à–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É V. (Episode 10)
   - –£–∑–Ω–∞—é—Ç –≤–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ GPS –≤ IP
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è

2. **–í–´ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ –ò–• —Ç—Ä–∞—Ñ–∏–∫:**
   - –í–∏–¥–∏—Ç–µ –∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –Ω–∞ –ø–æ—Ä—Ç—É 9999
   - –£–∑–Ω–∞—ë—Ç–µ, —á—Ç–æ –æ–Ω–∏ –∑–Ω–∞—é—Ç –æ –≤–∞—Å
   - –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–Ω—Ç–µ –æ —Å–ª–µ–¥—É—é—â–µ–º —É–∑–ª–µ

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
```c
// –í–∞—à sniffer:
if (ntohs(tcp->source) == 9999 || ntohs(tcp->dest) == 9999) {
    // –ü–∞–∫–µ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤ Z.!
}

// –ò—Ö sniffer:
if (ntohs(tcp->source) == 31337 || ntohs(tcp->dest) == 31337) {
    // –ü–∞–∫–µ—Ç—ã –∫ —Å–µ—Ä–≤–µ—Ä—É V.!
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- Shared medium (WiFi, Ethernet hub)
- Promiscuous mode –≤–∏–¥–∏—Ç –≤—Å—ë
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç ‚Üí –≤—Å—ë –≤ plaintext

**–ó–∞—â–∏—Ç–∞:**
- VPN (–∑–∞—à–∏—Ñ—Ä—É–µ—Ç –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫)
- TLS/SSL (Episode 12)
- –§–∏–∑–∏—á–µ—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è (–¥—Ä—É–≥–∞—è —Å–µ—Ç—å)

**–£—Ä–æ–∫:** –í –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–µ—Ç–∏ –≤—Å–µ –≤–∏–¥—è—Ç –≤—Å–µ—Ö. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
</details>

**14. –í—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏–ª–∏ "Next node: 10.0.0.1:4433" –≤ –ø–∞–∫–µ—Ç–µ –∞–≥–µ–Ω—Ç–æ–≤ Z. –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è Episode 12?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–≠—Ç–æ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –∞–¥—Ä–µ—Å–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞ –æ—Ç V.!**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**

**Episode 10:**
```
10:51 ‚Üí –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É V. (203.0.113.42:31337)
        –ü–æ–ª—É—á–∏–ª–∏: "–°–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: 10.0.0.1:4433"
```

**Episode 11:**
```
20:30 ‚Üí –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏–ª–∏ –ø–∞–∫–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ Z.:
        "Next node: 10.0.0.1:4433"
        "Protocol: Encrypted TCP"
        "Objective: Intercept encrypted stream"
```

**–ê–Ω–∞–ª–∏–∑:**
1. **V. –¥–∞–ª –∞–¥—Ä–µ—Å:** 10.0.0.1:4433
2. **–ê–≥–µ–Ω—Ç—ã Z. –¢–û–ñ–ï –∑–Ω–∞—é—Ç –∞–¥—Ä–µ—Å:** 10.0.0.1:4433
3. **–ó–Ω–∞—á–∏—Ç:** –û–Ω–∏ —Ç–æ–∂–µ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è!

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: –∞–¥—Ä–µ—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –û–ø–∞—Å–Ω–æ—Å—Ç—å: –∞–≥–µ–Ω—Ç—ã Z. –Ω–∞ —Ç–æ–º –∂–µ –ø—É—Ç–∏
- –ó–∞–¥–∞—á–∞ Episode 12: –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –ë–´–°–¢–†–ï–ï –Ω–∏—Ö

**–í Episode 12:**
```
02:12 ‚Üí V.: "–ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å TCP-–ø–æ—Ç–æ–∫ –Ω–∞ 10.0.0.1:4433"
        "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å XOR"
        "–£–∑–Ω–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å—Ç—Ä–µ—á–∏"
        
‚Üí –í—ã –¥–æ–ª–∂–Ω—ã —É—Å–ø–µ—Ç—å –î–û –∞–≥–µ–Ω—Ç–æ–≤ Z.!
```

**–°—é–∂–µ—Ç–Ω–∞—è –ª–∏–Ω–∏—è:**
```
Episode 09: –ù–∞—à–ª–∏ IP 203.0.113.42 (GPS ‚Üí –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å)
Episode 10: –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ 203.0.113.42:31337 (–ø–æ–ª—É—á–∏–ª–∏ —É–∑–µ–ª 2)
Episode 11: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —É–∑–µ–ª 2 —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Ö–≤–∞—Ç –∞–≥–µ–Ω—Ç–æ–≤ Z.
Episode 12: –†–∞—Å—à–∏—Ñ—Ä—É–µ—Ç–µ —É–∑–µ–ª 2 ‚Üí –≤—Å—Ç—Ä–µ—á–∞ —Å V. –Ω–∞ –ö—Ä–∞—Å–Ω–æ–π –ø–ª–æ—â–∞–¥–∏
```

**–£—Ä–æ–∫:** Packet sniffing –¥–∞—ë—Ç —Ä–∞–∑–≤–µ–¥–¥–∞–Ω–Ω—ã–µ –æ –ø–ª–∞–Ω–∞—Ö –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.
</details>

---

### üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ (1 –≤–æ–ø—Ä–æ—Å)

**15. –í —Å—é–∂–µ—Ç–µ –∞–≥–µ–Ω—Ç—ã Z. –∑–Ω–∞—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã safe house (55.7520¬∞N 37.6175¬∞E). –ú–æ–≥–ª–∏ –ª–∏ –æ–Ω–∏ –≤—ã—á–∏—Å–ª–∏—Ç—å —ç—Ç–æ –∏–∑ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤?**

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**–î–∞! –ß–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é —Ç—Ä–∞—Ñ–∏–∫–∞, timing –∞–Ω–∞–ª–∏–∑ –∏ geolocation!**

**–°–ø–æ—Å–æ–±—ã:**

**1. GPS –≤ –ø–∞–∫–µ—Ç–∞—Ö (–µ—Å–ª–∏ –≤—ã –∏—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏):**
```c
// –í–∞—à –∫–æ–¥ (–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏):
char msg[100];
snprintf(msg, sizeof(msg), "Status: Active at %f,%f", lat, lon);
send(sockfd, msg, strlen(msg), 0);

// –ê–≥–µ–Ω—Ç—ã Z. –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç ‚Üí –≤–∏–¥—è—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã!
```

**2. Timing analysis (–∑–∞–¥–µ—Ä–∂–∫–∏ –ø–∞–∫–µ—Ç–æ–≤):**
```
–í—ã ‚Üí –°–µ—Ä–≤–µ—Ä V. (203.0.113.42)
–ó–∞–¥–µ—Ä–∂–∫–∞ RTT: 45 ms

–ê–≥–µ–Ω—Ç—ã Z. –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç:
- RTT 45ms ‚Üí –ø—Ä–∏–º–µ—Ä–Ω–æ 1000 –∫–º –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –°–µ—Ä–≤–µ—Ä –≤ –ú–æ—Å–∫–≤–µ ‚Üí –≤—ã —Ç–æ–∂–µ –≤ –ú–æ—Å–∫–≤–µ
- –°—É–∂–µ–Ω–∏–µ –∫—Ä—É–≥–∞ –ø–æ–∏—Å–∫–∞
```

**3. WiFi triangulation:**
```bash
# –ê–≥–µ–Ω—Ç—ã Z. —Å–∫–∞–Ω–∏—Ä—É—é—Ç WiFi:
$ iwlist wlan0 scan

ESSID: "SafeHouse_Guest"
MAC: AA:BB:CC:DD:EE:FF
Signal: -45 dBm  ‚Üê –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ!

# Trilateration —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ—á–µ–∫:
‚Üí –í—ã—á–∏—Å–ª—è—é—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
‚Üí –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã safe house
```

**4. IP Geolocation:**
```bash
$ curl "http://ip-api.com/json/YOUR_PUBLIC_IP"

{
  "lat": 55.7520,
  "lon": 37.6175,
  "city": "Moscow",
  "district": "Arbat"
}
```

**5. Traffic correlation:**
```
19:46 ‚Üí –í–∞—à –ø–∞–∫–µ—Ç –∫ V.: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
19:46 ‚Üí –ü–∞–∫–µ—Ç Z.: "Target confirmed. Location: Safe house."

–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –≤—ã –≤ safe house!
```

**6. MAC –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
```c
// –í Ethernet frame:
struct ether_header {
    uint8_t ether_dhost[6];  // MAC –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    uint8_t ether_shost[6];  // –í–ê–® MAC!
    uint16_t ether_type;
};

// –ê–≥–µ–Ω—Ç—ã Z. –≤–∏–¥—è—Ç –≤–∞—à MAC
// ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
// ‚Üí –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
// ‚Üí –í–æ–∑–º–æ–∂–Ω–æ, –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (–µ—Å–ª–∏ WiFi)
```

**–ó–∞—â–∏—Ç–∞:**

```c
// 1. VPN (—Å–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π IP)
sudo openvpn moonlight.ovpn

// 2. Tor (–∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å)
torify ./moonlight_client

// 3. MAC randomization
sudo ifconfig wlan0 hw ether DE:AD:BE:EF:CA:FE

// 4. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (TLS/SSL)
// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –≤–∏–¥–Ω—ã –≤ plaintext

// 5. –§–∏–∑–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –ª–æ–∫–∞—Ü–∏–∏
// –ü–µ—Ä–µ–µ—Ö–∞—Ç—å –∏–∑ safe house!
```

**–í –º–∏—Å—Å–∏–∏:**
- –í—ã –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ VPN
- –ê–≥–µ–Ω—Ç—ã Z. –≤ —Ç–æ–π –∂–µ —Å–µ—Ç–∏
- Per–µ—Ö–≤–∞—Ç–∏–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ ‚Üí –≤—ã—á–∏—Å–ª–∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Safe house —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω

**–£—Ä–æ–∫:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (timing, geolocation, MAC) –º–æ–≥—É—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∞–∂–µ –±–µ–∑ GPS –≤ payload.
</details>

---

**üéì –û—Ü–µ–Ω–∫–∞:**
- **13-15 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö** ‚Äî Packet Master! –ì–æ—Ç–æ–≤—ã –∫ Episode 12 ‚úÖ
- **10-12 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö** ‚Äî –•–æ—Ä–æ—à–æ, –Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ promiscuous mode üìñ
- **< 10 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö** ‚Äî –ü–µ—Ä–µ—á–∏—Ç–∞–π—Ç–µ Episode 11 –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ packet sniffer üîÑ

---

## ü•ö Easter Eggs

<details>
<summary>üîç –û—Ç—Å—ã–ª–∫–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã</summary>

1. **Raw sockets** ‚Äî –æ—Å–Ω–æ–≤–∞ Wireshark, tcpdump, Snort
2. **Port 9999** ‚Äî —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–∞–ª–≤–∞—Ä–∞—Ö (backdoor port)
3. **10.0.0.1** ‚Äî private IP –∫–ª–∞—Å—Å–∞ A, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
4. **Promiscuous mode** ‚Äî —Ç–µ—Ä–º–∏–Ω –∏–∑ —Ä–∞–¥–∏–æ–ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ (–ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Å—ë)
5. **struct iphdr** ‚Äî –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–µ–≤–æ–º—É —Å—Ç–µ–∫—É Linux
6. **PSH flag** ‚Äî "push", –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–ø—Ä–∏–∑–Ω–∞–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–∞—Ñ—Ñ–∏–∫–∞)
7. **V.'s timestamp 22:35** ‚Äî 0x5623 hex, –æ—Ç—Å—ã–ª–∫–∞ –∫ CVE-2022-5623 (network vulnerability)
8. **Hex dump format** ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –∏–∑ `hexdump -C`

**–§–∏–ª–æ—Å–æ—Ñ–∏—è —ç–ø–∏–∑–æ–¥–∞**: *"–°–µ—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–∞ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –∑–Ω–∞–µ—Ç, –∫–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å. Raw socket ‚Äî —ç—Ç–æ —Ä–µ–Ω—Ç–≥–µ–Ω."*

</details>

---

## üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [‚Üê Episode 10: Socket Programming](../episode-10-socket-programming/README.md)
- [‚Üí Episode 12: Encrypted Communications](../episode-12-encrypted-communications/README.md)
- [üìã Season 3: Networks](../README.md)
- [üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞](../../README.md)

---

> *"In the network, everything is visible. You just need to know where to look."* ‚Äî V.